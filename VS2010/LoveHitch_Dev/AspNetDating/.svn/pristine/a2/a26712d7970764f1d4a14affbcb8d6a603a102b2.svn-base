var fbsdkIsLoaded=false,fbIsInitialized=false,fbUserIsLoggedIn=false,fbUserIsAuthorized=false;window.fbAsyncInit=function(){fbsdkIsLoaded=true;FB.init({appId:facebookAppId,channelURL:"./Facebook/xd_receiver.htm",status:true,cookie:true,oauth:true,frictionlessRequests:true,xfbml:true});fbIsInitialized=true;var a=Sys.UI.DomElement.getBounds($get("layout")).height;jQuery(function(){FB.Canvas.setSize({width:960,height:a+30});FB.Canvas.setAutoGrow(1e3)});FB.Canvas.setDoneLoading();FB.Event.subscribe("xfbml.render",function(){window.setTimeout("showHeaderButton()",1e3)});fbTriesElapsed>0&&!fbUserIsAuthorized&&facebookLoginTry()};function showHeaderButton(){jQuery("td.facebookbtn").show()}jQuery(function(){(function(b){var a,c="facebook-jssdk";if(b.getElementById(c))return;a=b.createElement("script");a.id=c;a.async=true;a.src="//connect.facebook.net/en_US/all.js";b.getElementsByTagName("head")[0].appendChild(a)})(document)});function facebookLoginTry(){console.log("fb tries = "+fbTriesElapsed);fbTriesElapsed--;var a="./handlers/SetSessionState.ashx";$.get(a,{key:"FacebookConnectTriesElapsed",val:fbTriesElapsed},function(){});FB.getLoginStatus(function(a){if(a.status=="connected"){var c="./LoginThroughFacebook.aspx?access_token="+a.authResponse.accessToken+"&fbUserID="+a.authResponse.userID+"&signed="+a.authResponse.signedRequest;fbUserIsAuthorized=true;fbUserIsLoggedIn=true;if(window!=window.top||top!==self)window.location=c;else{var b=a.authResponse.userID;FB.api("/me",function(a){b=a.name;jQuery("#fbLoginModal").html("<br>Are you "+b+" ? <br/><br/>Do you want to login with this facebook account ?");jQuery("#fbLoginModal").dialog({resizable:false,height:250,width:600,modal:true,buttons:{"YES - Use Facebook":function(){$(this).dialog("close");window.location=c},"NO - Logout from Facebook":function(){FB.logout(function(){});$(this).dialog("close")},"CANCEL - Do Nothing":function(){$(this).dialog("close")}}})})}}else FB.login(function(a){if(a.authResponse)if(a.authResponse.accessToken){var b="./LoginThroughFacebook.aspx?access_token="+a.authResponse.accessToken+"&fbUserID="+a.authResponse.userID+"&signed="+a.authResponse.signedRequest;fbUserIsAuthorized=false;fbUserIsLoggedIn=true;if(window!=window.top)window.location=b}else window.location="./Login.aspx?facebook=0";else window.location="./Login.aspx?facebook=0"},{scope:fbBasicPermissionScope})})}function showResponse(a){var b="response.status = "+a.status+" \nresponse.authResponse.accessToken = "+a.authResponse.accessToken+"\nresponse.authResponse.userID = "+a.authResponse.userID;console.log(b)}function fbEnsureInit(a){if(!window.fbApiInit)setTimeout(function(){fbEnsureInit(a)},50);else a&&a()};