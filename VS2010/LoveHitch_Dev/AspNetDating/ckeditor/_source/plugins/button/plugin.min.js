CKEDITOR.plugins.add("button",{beforeInit:function(n){n.ui.addHandler(CKEDITOR.UI_BUTTON,CKEDITOR.ui.button.handler)}}),CKEDITOR.UI_BUTTON=1,CKEDITOR.ui.button=function(n){CKEDITOR.tools.extend(this,n,{title:n.label,className:n.className||n.command&&"cke_button_"+n.command||"",click:n.click||function(t){t.execCommand(n.command)}}),this._={}},CKEDITOR.ui.button.handler={create:function(n){return new CKEDITOR.ui.button(n)}},CKEDITOR.ui.button.prototype={canGroup:!0,render:function(n,t){var r=CKEDITOR.env,e=this._.id="cke_"+CKEDITOR.tools.getNextNumber(),s;this._.editor=n;var u={id:e,button:this,editor:n,focus:function(){var n=CKEDITOR.document.getById(e);n.focus()},execute:function(){this.button.click(n)}},h=CKEDITOR.tools.addFunction(u.execute,u),o=CKEDITOR.ui.button._.instances.push(u)-1,f="",i=this.command;if(this.modes)n.on("mode",function(){this.setState(this.modes[n.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)},this);else if(i&&(i=n.getCommand(i),i)){i.on("state",function(){this.setState(i.state)},this);f+="cke_"+(i.state==CKEDITOR.TRISTATE_ON?"on":i.state==CKEDITOR.TRISTATE_DISABLED?"disabled":"off")}return i||(f+="cke_off"),this.className&&(f+=" "+this.className),t.push('<span class="cke_button">','<a id="',e,'" class="',f,'" href="javascript:void(\'',(this.title||"").replace("'",""),'\')" title="',this.title,'" tabindex="-1" hidefocus="true"'),(r.opera||r.gecko&&r.mac)&&t.push(' onkeypress="return false;"'),r.gecko&&t.push(' onblur="this.style.cssText = this.style.cssText;"'),t.push(' onkeydown="return CKEDITOR.ui.button._.keydown(',o,', event);" onfocus="return CKEDITOR.ui.button._.focus(',o,', event);" onclick="CKEDITOR.tools.callFunction(',h,', this); return false;"><span class="cke_icon"'),this.icon&&(s=(this.iconOffset||0)*-16,t.push(' style="background-image:url(',CKEDITOR.getUrl(this.icon),");background-position:0 "+s+'px;"')),t.push('><\/span><span class="cke_label">',this.label,"<\/span>"),this.hasArrow&&t.push('<span class="cke_buttonarrow"><\/span>'),t.push("<\/a>","<\/span>"),this.onRender&&this.onRender(),u},setState:function(n){var t;if(this._.state!=n){if(t=CKEDITOR.document.getById(this._.id),t){t.setState(n);var i=this.title,r=this._.editor.lang.common.unavailable,u=t.getChild(1);n==CKEDITOR.TRISTATE_DISABLED&&(i=r.replace("%1",this.title)),u.setHtml(i)}this._.state=n}}},CKEDITOR.ui.button._={instances:[],keydown:function(n,t){var i=CKEDITOR.ui.button._.instances[n];if(i.onkey)return t=new CKEDITOR.dom.event(t),i.onkey(i,t.getKeystroke())!==!1},focus:function(n,t){var i=CKEDITOR.ui.button._.instances[n],r;return i.onfocus&&(r=i.onfocus(i,new CKEDITOR.dom.event(t))!==!1),CKEDITOR.env.gecko&&CKEDITOR.env.version<10900&&t.preventBubble(),r}},CKEDITOR.ui.prototype.addButton=function(n,t){this.add(n,CKEDITOR.UI_BUTTON,t)};