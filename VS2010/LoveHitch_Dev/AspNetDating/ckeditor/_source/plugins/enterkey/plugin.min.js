(function(){function e(n){return r(n,n.config.shiftEnterMode,!0)}function r(n,i,r){return n.mode!="wysiwyg"?!1:(i||(i=n.config.enterMode),setTimeout(function(){n.fire("saveSnapshot"),i==CKEDITOR.ENTER_BR||n.getSelection().getStartElement().hasAscendant("pre",!0)?f(n,i,null,r):t(n,i,null,r)},0),!0)}function u(n){for(var i=n.getSelection().getRanges(),t=i.length-1;t>0;t--)i[t].deleteContents();return i[0]}CKEDITOR.plugins.add("enterkey",{requires:["keystrokes","indent"],init:function(n){var t=n.specialKeys;t[13]=r,t[CKEDITOR.SHIFT+13]=e}}),CKEDITOR.plugins.enterkey={enterBlock:function(n,t,r,f){var s,a,w,d,c,b;r=r||u(n);var y=r.document,k=t==CKEDITOR.ENTER_DIV?"div":"p",l=r.splitBlock(k);if(l){var o=l.previousBlock,e=l.nextBlock,p=l.wasStartOfBlock,v=l.wasEndOfBlock,h;if(e?(h=e.getParent(),h.is("li")&&(e.breakParent(h),e.move(e.getNext(),!0))):o&&(h=o.getParent())&&h.is("li")&&(o.breakParent(h),r.moveToElementEditStart(o.getNext()),o.move(o.getPrevious())),p||v){if(p&&v&&o.is("li")){n.execCommand("outdent");return}if(o?f||i.test(o.getName())||(s=o.clone()):e&&(s=e.clone()),s||(s=y.createElement(k)),a=l.elementPath,a)for(w=0,d=a.elements.length;w<d;w++){if(c=a.elements[w],c.equals(a.block)||c.equals(a.blockLimit))break;CKEDITOR.dtd.$removeEmpty[c.getName()]&&(c=c.clone(),s.moveChildren(c),s.append(c))}CKEDITOR.env.ie||s.appendBogus(),r.insertNode(s),CKEDITOR.env.ie&&p&&(!v||!o.getChildCount())&&(r.moveToElementEditStart(v?o:s),r.select()),r.moveToElementEditStart(p&&!v?e:s)}else e.is("li")&&(h=e.getFirst(CKEDITOR.dom.walker.invisible(!0)))&&h.is&&h.is("ul","ol")&&(CKEDITOR.env.ie?y.createText(" "):y.createElement("br")).insertBefore(h),e&&r.moveToElementEditStart(e);CKEDITOR.env.ie||(e?(b=y.createElement("span"),b.setHtml("&nbsp;"),r.insertNode(b),b.scrollIntoView(),r.deleteContents()):s.scrollIntoView()),r.select()}},enterBr:function(n,r,f,e){var o,h;f=f||u(n);var s=f.document,p=r==CKEDITOR.ENTER_DIV?"div":"p",v=f.checkEndOfBlock(),y=new CKEDITOR.dom.elementPath(n.getSelection().getStartElement()),c=y.block,l=c&&y.block.getName(),a=!1;if(!e&&l=="li"){t(n,r,f,e);return}!e&&v&&i.test(l)?(s.createElement("br").insertAfter(c),CKEDITOR.env.gecko&&s.createText("").insertAfter(c),f.setStartAt(c.getNext(),CKEDITOR.env.ie?CKEDITOR.POSITION_BEFORE_START:CKEDITOR.POSITION_AFTER_START)):(a=l=="pre",o=a?s.createText(CKEDITOR.env.ie?"\r":"\n"):s.createElement("br"),f.deleteContents(),f.insertNode(o),CKEDITOR.env.ie||s.createText("﻿").insertAfter(o),v&&!CKEDITOR.env.ie&&o.getParent().appendBogus(),CKEDITOR.env.ie||(o.getNext().$.nodeValue=""),CKEDITOR.env.ie?f.setStartAt(o,CKEDITOR.POSITION_AFTER_END):f.setStartAt(o.getNext(),CKEDITOR.POSITION_AFTER_START),CKEDITOR.env.ie||(h=null,CKEDITOR.env.gecko?h=s.createElement("br"):(h=s.createElement("span"),h.setHtml("&nbsp;")),h.insertBefore(o.getNext()),h.scrollIntoView(),h.remove())),f.collapse(!0),f.select(a)}};var n=CKEDITOR.plugins.enterkey,f=n.enterBr,t=n.enterBlock,i=/^h[1-6]$/})();