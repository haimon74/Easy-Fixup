CKEDITOR.plugins.add("link",{init:function(n){n.addCommand("link",new CKEDITOR.dialogCommand("link")),n.addCommand("anchor",new CKEDITOR.dialogCommand("anchor")),n.addCommand("unlink",new CKEDITOR.unlinkCommand),n.ui.addButton("Link",{label:n.lang.link.toolbar,command:"link"}),n.ui.addButton("Unlink",{label:n.lang.unlink,command:"unlink"}),n.ui.addButton("Anchor",{label:n.lang.anchor.toolbar,command:"anchor"}),CKEDITOR.dialog.add("link",this.path+"dialogs/link.js"),CKEDITOR.dialog.add("anchor",this.path+"dialogs/anchor.js"),n.addCss("img.cke_anchor{background-image: url("+CKEDITOR.getUrl(this.path+"images/anchor.gif")+");background-position: center center;background-repeat: no-repeat;border: 1px solid #a9a9a9;width: 18px;height: 18px;}\na.cke_anchor{background-image: url("+CKEDITOR.getUrl(this.path+"images/anchor.gif")+");background-position: 0 center;background-repeat: no-repeat;border: 1px solid #a9a9a9;padding-left: 18px;}");n.on("selectionChange",function(t){var r=n.getCommand("unlink"),i=t.data.path.lastElement.getAscendant("a",!0);i&&i.getName()=="a"&&i.getAttribute("href")?r.setState(CKEDITOR.TRISTATE_OFF):r.setState(CKEDITOR.TRISTATE_DISABLED)});n.addMenuItems&&n.addMenuItems({anchor:{label:n.lang.anchor.menu,command:"anchor",group:"anchor"},link:{label:n.lang.link.menu,command:"link",group:"link",order:1},unlink:{label:n.lang.unlink,command:"unlink",group:"link",order:5}}),n.contextMenu&&n.contextMenu.addListener(function(n){if(!n)return null;var t=n.is("img")&&n.getAttribute("_cke_real_element_type")=="anchor";if(!t){if(!(n=n.getAscendant("a",!0)))return null;t=n.getAttribute("name")&&!n.getAttribute("href")}return t?{anchor:CKEDITOR.TRISTATE_OFF}:{link:CKEDITOR.TRISTATE_OFF,unlink:CKEDITOR.TRISTATE_OFF}})},afterInit:function(n){var t=n.dataProcessor,i=t&&t.dataFilter;i&&i.addRules({elements:{a:function(t){var i=t.attributes;if(i.name&&!i.href)return n.createFakeParserElement(t,"cke_anchor","anchor")}}})},requires:["fakeobjects"]}),CKEDITOR.unlinkCommand=function(){},CKEDITOR.unlinkCommand.prototype={exec:function(n){for(var i=n.getSelection(),e=i.createBookmarks(),r=i.getRanges(),f,u,t=0;t<r.length;t++)(f=r[t].getCommonAncestor(!0),u=f.getAscendant("a",!0),u)&&r[t].selectNodeContents(u);i.selectRanges(r),n.document.$.execCommand("unlink",!1,null),i.selectBookmarks(e)}},CKEDITOR.tools.extend(CKEDITOR.config,{linkShowAdvancedTab:!0,linkShowTargetTab:!0});