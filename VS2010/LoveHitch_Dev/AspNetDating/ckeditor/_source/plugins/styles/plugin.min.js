CKEDITOR.plugins.add("styles",{requires:["selection"]}),CKEDITOR.editor.prototype.attachStyleStateChange=function(n,t){var i=this._.styleStateChangeCallbacks;if(!i){i=this._.styleStateChangeCallbacks=[];this.on("selectionChange",function(n){for(var t,u,r=0;r<i.length;r++)t=i[r],u=t.style.checkActive(n.data.path)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF,t.state!==u&&(t.fn.call(this,u),t.state!==u)})}i.push({style:n,fn:t})},CKEDITOR.STYLE_BLOCK=1,CKEDITOR.STYLE_INLINE=2,CKEDITOR.STYLE_OBJECT=3,function(){function w(n){var l=n.document,d,y,p,i,e,nt,s,a,h,tt,c,w,f,o,b,k;if(n.collapsed){d=u(this,l),n.insertNode(d),n.moveToPosition(d,CKEDITOR.POSITION_BEFORE_END);return}var g=this.element,it=this._.definition,ut,ft=CKEDITOR.dtd[g]||(ut=!0,CKEDITOR.dtd.span),ot=n.createBookmark();n.enlarge(CKEDITOR.ENLARGE_ELEMENT),n.trim();var et=n.getBoundaryNodes(),v=et.startNode,r=et.endNode.getNextSourceNode(!0);for(r||(r=y=l.createText(""),r.insertAfter(n.endContainer)),p=r.getParent(),p&&p.getAttribute("_fck_bookmark")&&(r=p),r.equals(v)&&(r=r.getNextSourceNode(!0),r||(r=y=l.createText(""),r.insertAfter(v))),i=v;i;){if(s=!1,i.equals(r))i=null,s=!0;else{if(a=i.type,h=a==CKEDITOR.NODE_ELEMENT?i.getName():null,h&&i.getAttribute("_fck_bookmark")){i=i.getNextSourceNode(!0);continue}if(!h||ft[h]&&(i.getPosition(r)|CKEDITOR.POSITION_PRECEDING|CKEDITOR.POSITION_IDENTICAL|CKEDITOR.POSITION_IS_CONTAINED)==CKEDITOR.POSITION_PRECEDING+CKEDITOR.POSITION_IDENTICAL+CKEDITOR.POSITION_IS_CONTAINED)if(tt=i.getParent(),tt&&((tt.getDtd()||CKEDITOR.dtd.span)[g]||ut)){if(e||h&&CKEDITOR.dtd.$removeEmpty[h]&&(i.getPosition(r)|CKEDITOR.POSITION_PRECEDING|CKEDITOR.POSITION_IDENTICAL|CKEDITOR.POSITION_IS_CONTAINED)!=CKEDITOR.POSITION_PRECEDING+CKEDITOR.POSITION_IDENTICAL+CKEDITOR.POSITION_IS_CONTAINED||(e=new CKEDITOR.dom.range(l),e.setStartBefore(i)),a==CKEDITOR.NODE_TEXT||a==CKEDITOR.NODE_ELEMENT&&!i.getChildCount()){for(c=i;!c.$.nextSibling&&(w=c.getParent(),ft[w.getName()])&&(w.getPosition(v)|CKEDITOR.POSITION_FOLLOWING|CKEDITOR.POSITION_IDENTICAL|CKEDITOR.POSITION_IS_CONTAINED)==CKEDITOR.POSITION_FOLLOWING+CKEDITOR.POSITION_IDENTICAL+CKEDITOR.POSITION_IS_CONTAINED;)c=w;e.setEndAfter(c),c.$.nextSibling||(s=!0),nt||(nt=a!=CKEDITOR.NODE_TEXT||/[^\s\ufeff]/.test(i.getText()))}}else s=!0;else s=!0;i=i.getNextSourceNode()}if(s&&nt&&e&&!e.collapsed){for(f=u(this,l),o=e.getCommonAncestor();f&&o;){if(o.getName()==g){for(b in it.attributes)f.getAttribute(b)==o.getAttribute(b)&&f.removeAttribute(b);for(k in it.styles)f.getStyle(k)==o.getStyle(k)&&f.removeStyle(k);if(!f.hasAttributes()){f=null;break}}o=o.getParent()}f&&(e.extractContents().appendTo(f),rt(this,f),e.insertNode(f),t(f),CKEDITOR.env.ie||f.$.normalize()),e=null}}y&&y.remove(),n.moveToBookmark(ot)}function b(n){var v,o,c,l,s,f,w,b,y,h,p,k,u,a;if(n.enlarge(CKEDITOR.ENLARGE_ELEMENT),v=n.createBookmark(),o=v.startNode,n.collapsed){for(c=new CKEDITOR.dom.elementPath(o.getParent()),s=0;s<c.elements.length&&(f=c.elements[s]);s++){if(f==c.block||f==c.blockLimit)break;this.checkElementRemovable(f)&&(w=n.checkBoundaryOfElement(f,CKEDITOR.END),b=!w&&n.checkBoundaryOfElement(f,CKEDITOR.START),b||w?(l=f,l.match=b?"start":"end"):(t(f),r(this,f)))}if(l){for(y=o,s=0;;s++){if(h=c.elements[s],h.equals(l))break;else if(h.match)continue;else h=h.clone();h.append(y),y=h}y[l.match=="start"?"insertBefore":"insertAfter"](l)}}else{p=v.endNode,k=this;function n(){for(var i=new CKEDITOR.dom.elementPath(o.getParent()),r=new CKEDITOR.dom.elementPath(p.getParent()),u=null,f=null,n,t=0;t<i.elements.length;t++){if(n=i.elements[t],n==i.block||n==i.blockLimit)break;k.checkElementRemovable(n)&&(u=n)}for(t=0;t<r.elements.length;t++){if(n=r.elements[t],n==r.block||n==r.blockLimit)break;k.checkElementRemovable(n)&&(f=n)}f&&p.breakParent(f),u&&o.breakParent(u)}for(n(),u=o.getNext();!u.equals(p);)a=u.getNextSourceNode(),u.type==CKEDITOR.NODE_ELEMENT&&this.checkElementRemovable(u)&&(u.getName()==this.element?r(this,u):e(u,i(this)[u.getName()]),a.type==CKEDITOR.NODE_ELEMENT&&a.contains(o)&&(n(),a=o.getNext())),u=a}n.moveToBookmark(v)}function k(n){var e=n.createBookmark(!0),t=n.createIterator(),i,r,f;for(t.enforceRealBlocks=!0,r=n.document;i=t.getNextParagraph();)f=u(this,r),d(i,f);n.moveToBookmark(e)}function d(n,t){var i=t.is("pre"),r=n.is("pre"),u=i&&!r,f=!i&&r;u?t=it(n,t):f?t=tt(nt(n),t):n.moveChildren(t),t.replace(n),i&&g(t)}function g(t){var i,r;(i=t.getPreviousSourceNode(!0,CKEDITOR.NODE_ELEMENT))&&i.is&&i.is("pre")&&(r=n(i.getHtml(),/\n$/,"")+"\n\n"+n(t.getHtml(),/^\n/,""),CKEDITOR.env.ie?t.$.outerHTML="<pre>"+r+"<\/pre>":t.setHtml(r),i.remove())}function nt(t){var u=t.getName(),r=n(t.getOuterHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_fck_bookmark.*?\/span>))*\n(?!$)/gi,function(n,t,i){return t+"<\/pre>"+i+"<pre>"}),i=[];return r.replace(/<pre>([\s\S]*?)<\/pre>/gi,function(n,t){i.push(t)}),i}function n(n,t,i){var r="",u="";return n=n.replace(/(^<span[^>]+_fck_bookmark.*?\/span>)|(<span[^>]+_fck_bookmark.*?\/span>$)/gi,function(n,t,i){return t&&(r=t),i&&(u=i),""}),r+n.replace(t,i)+u}function tt(t,i){for(var e=new CKEDITOR.dom.documentFragment(i.getDocument()),r,f,u=0;u<t.length;u++)r=t[u],r=r.replace(/(\r\n|\r)/g,"\n"),r=n(r,/^[ \t]*\n/,""),r=n(r,/\n$/,""),r=n(r,/^[ \t]+|[ \t]+$/g,function(n,t){return n.length==1?"&nbsp;":t?" "+CKEDITOR.tools.repeat("&nbsp;",n.length-1):CKEDITOR.tools.repeat("&nbsp;",n.length-1)+" "}),r=r.replace(/\n/g,"<br>"),r=r.replace(/[ \t]{2,}/g,function(n){return CKEDITOR.tools.repeat("&nbsp;",n.length-1)+" "}),f=i.clone(),f.setHtml(r),e.append(f);return e}function it(t,i){var r=t.getHtml(),u;return r=n(r,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,""),r=r.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1"),r=r.replace(/([ \t\n\r]+|&nbsp;)/g," "),r=r.replace(/<br\b[^>]*>/gi,"\n"),CKEDITOR.env.ie?(u=t.getDocument().createElement("div"),u.append(i),i.$.outerHTML="<pre>"+r+"<\/pre>",i=u.getFirst().remove()):i.setHtml(r),i}function r(n,t){function f(){for(var n in r)(n!="class"||t.getAttribute(n)==r[n])&&t.removeAttribute(n)}var u=n._.definition,r=u.attributes,s=u.styles,h=i(n),e;f();for(e in s)t.removeStyle(e);r=h[t.getName()],r&&f(),o(t)}function rt(n,t){for(var s=n._.definition,l=s.attributes,a=s.styles,h=i(n),f=t.getElementsByTag(n.element),o,c,u=f.count();--u>=0;)r(n,f.getItem(u));for(o in h)if(o!=n.element)for(f=t.getElementsByTag(o),u=f.count()-1;u>=0;u--)c=f.getItem(u),e(c,h[o])}function e(n,t){var u=t&&t.attributes,r,f,e,i;if(u)for(r=0;r<u.length;r++)f=u[r][0],(e=n.getAttribute(f))&&(i=u[r][1],(i===null||i.test&&i.test(e)||typeof i=="string"&&e==i)&&n.removeAttribute(f));o(n)}function o(n){if(!n.hasAttributes()){var i=n.getFirst(),r=n.getLast();n.remove(!0),i&&(t(i),r&&!i.equals(r)&&t(r))}}function t(n){n&&n.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dtd.$removeEmpty[n.getName()]&&(s(n,n.getNext(),!0),s(n,n.getPrevious()))}function s(n,i,r){var u,f;i&&i.type==CKEDITOR.NODE_ELEMENT&&(u=i.getAttribute("_fck_bookmark"),u&&(i=r?i.getNext():i.getPrevious()),i&&i.type==CKEDITOR.NODE_ELEMENT&&n.isIdentical(i)&&(f=r?n.getLast():n.getFirst(),u&&(r?i.getPrevious():i.getNext()).move(n,!r),i.moveChildren(n,!r),i.remove(),f&&t(f)))}function u(n,t){var r,u=n._.definition,i=n.element;return i=="*"&&(i="span"),r=new CKEDITOR.dom.element(i,t),h(r,n)}function h(n,t){var u=t._.definition,i=u.attributes,f=CKEDITOR.style.getStyleText(u),r;if(i)for(r in i)n.setAttribute(r,i[r]);return f&&n.setAttribute("style",f),n}function l(n,t){for(var i in n)n[i]=n[i].replace(c,function(n,i){return t[i]})}function ut(n){var t=n._AC,i,r,u,f;if(t)return t;if(t={},i=0,r=n.attributes,r)for(u in r)i++,t[u]=r[u];return(f=CKEDITOR.style.getStyleText(n))&&(t.style||i++,t.style=f),t._length=i,n._AC=t}function i(n){var r,t,u,i,f,o,e,h,s;if(n._.overrides)return n._.overrides;if(r=n._.overrides={},t=n._.definition.overrides,t)for(CKEDITOR.tools.isArray(t)||(t=[t]),u=0;u<t.length;u++)if(i=t[u],typeof i=="string"?f=i.toLowerCase():(f=i.element?i.element.toLowerCase():n.element,e=i.attributes),o=r[f]||(r[f]={}),e){h=o.attributes=o.attributes||[];for(s in e)h.push([s.toLowerCase(),e[s]])}return r}function a(n,t){var i,r;return t!==!1?(r=new CKEDITOR.dom.element("span"),r.setAttribute("style",n),i=r.getAttribute("style")):i=n,i.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function v(n,t){for(var u=n.getSelection(),r=u.getRanges(),f=t?this.removeFromRange:this.applyToRange,i=0;i<r.length;i++)f.call(this,r[i]);u.selectRanges(r)}var y={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},p={a:1,embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,ul:1},f=/\s*(?:;\s*|$)/,c;CKEDITOR.style=function(n,t){t&&(n=CKEDITOR.tools.clone(n),l(n.attributes,t),l(n.styles,t));var i=this.element=(n.element||"*").toLowerCase();this.type=i=="#"||y[i]?CKEDITOR.STYLE_BLOCK:p[i]?CKEDITOR.STYLE_OBJECT:CKEDITOR.STYLE_INLINE,this._={definition:n}},CKEDITOR.style.prototype={apply:function(n){v.call(this,n,!1)},remove:function(n){v.call(this,n,!0)},applyToRange:function(n){return(this.applyToRange=this.type==CKEDITOR.STYLE_INLINE?w:this.type==CKEDITOR.STYLE_BLOCK?k:null).call(this,n)},removeFromRange:function(n){return(this.removeFromRange=this.type==CKEDITOR.STYLE_INLINE?b:null).call(this,n)},applyToObject:function(n){h(n,this)},checkActive:function(n){var r,t,i;switch(this.type){case CKEDITOR.STYLE_BLOCK:return this.checkElementRemovable(n.block||n.blockLimit,!0);case CKEDITOR.STYLE_INLINE:for(r=n.elements,t=0;t<r.length;t++)if((i=r[t],i!=n.block&&i!=n.blockLimit)&&this.checkElementRemovable(i,!0))return!0}return!1},checkElementRemovable:function(n,t){var c,r,u,s,h,f,o,e;if(!n)return!1;if(c=this._.definition,n.getName()==this.element){if(!t&&!n.hasAttributes())return!0;if(r=ut(c),r._length){for(u in r)if(u!="_length")if(s=n.getAttribute(u)||"",r[u]==(u=="style"?a(s,!1):s)){if(!t)return!0}else if(t)return!1;if(t)return!0}else return!0}if(h=i(this)[n.getName()],h){if(!(r=h.attributes))return!0;for(f=0;f<r.length;f++)if(u=r[f][0],o=n.getAttribute(u),o&&(e=r[f][1],e===null||typeof e=="string"&&o==e||e.test(o)))return!0}return!1}},CKEDITOR.style.getStyleText=function(n){var i=n._ST,t,r;if(i)return i;i=n.styles,t=n.attributes&&n.attributes.style||"",t.length&&(t=t.replace(f,";"));for(r in i)t+=(r+":"+i[r]).replace(f,";");return t.length&&(t=a(t)),n._ST=t},c=/#\((.+?)\)/g}(),CKEDITOR.styleCommand=function(n){this.style=n},CKEDITOR.styleCommand.prototype.exec=function(n){n.focus();var t=n.document;return t&&(this.state==CKEDITOR.TRISTATE_OFF?this.style.apply(t):this.state==CKEDITOR.TRISTATE_ON&&this.style.remove(t)),!!t};