CKEDITOR.dialog.add("link",function(n){function h(n){return n.replace(/\\'/g,"'")}function c(n){return n.replace(/'/g,"\\$&")}function rt(n){for(var o=e.name,u=e.params,r,f,t=[o,"("],i=0;i<u.length;i++)r=u[i].toLowerCase(),f=n[r],i>0&&t.push(","),t.push("'",f?c(encodeURIComponent(n[r])):"","'");return t.push(")"),t.join("")}function ut(n){for(var i,u=n.length,r=[],t=0;t<u;t++)i=n.charCodeAt(t),r.push(i);return"String.fromCharCode("+r.join(",")+")"}var l=function(){var u=this.getDialog(),t=u.getContentElement("target","popupFeatures"),i=u.getContentElement("target","linkTargetName"),r=this.getValue();t&&i&&(t=t.getElement(),r=="popup"?(t.show(),i.setLabel(n.lang.link.targetPopupName)):(t.hide(),i.setLabel(n.lang.link.targetFrameName),this.getDialog().setValueOf("target","linkTargetName",r.charAt(0)=="_"?r:"")))},a=function(){var t=this.getDialog(),u=["urlOptions","anchorOptions","emailOptions"],f=this.getValue(),e=t.definition.getContents("upload"),o=e&&e.hidden,r,i;for(f=="url"?(n.config.linkShowTargetTab&&t.showPage("target"),o||t.showPage("upload")):(t.hidePage("target"),o||t.hidePage("upload")),r=0;r<u.length;r++)(i=t.getContentElement("info",u[r]),i)&&(i=i.getElement().getParent().getParent(),u[r]==f+"Options"?i.show():i.hide())},v=/^mailto:([^?]+)(?:\?(.+))?$/,y=/subject=([^;?:@&=$,\/]*)/,p=/body=([^;?:@&=$,\/]*)/,w=/^#(.*)$/,b=/^(?!javascript)((?:http|https|ftp|news):\/\/)?(.*)$/,k=/^(_(?:self|top|parent|blank))$/,d=/^javascript:void\(location\.href='mailto:'\+String\.fromCharCode\(([^)]+)\)(?:\+'(.*)')?\)$/,g=/^javascript:([^(]+)\(([^)]+)\)$/,nt=/\s*window.open\(\s*this\.href\s*,\s*(?:'([^']*)'|null)\s*,\s*'([^']*)'\s*\)\s*;\s*return\s*false;*\s*/,tt=/(?:^|,)([^=]+)=(\d+|yes|no)/gi,it=function(n,t){var o=t?t.getAttribute("_cke_saved_href")||t.getAttribute("href"):"",ut,ht,ft,i={},et,ot,it,l,st,rt,s,ct,vt,u,r,c;if((ht=o.match(w))?(i.type="anchor",i.anchor={},i.anchor.name=i.anchor.id=ht[1]):o&&(ft=o.match(b))?(i.type="url",i.url={},i.url.protocol=ft[1],i.url.url=ft[2]):f&&f!="encode"?f?o.replace(g,function(n,t,r){var u;if(t==e.name){i.type="email";var f=i.email={},o=r.match(/[^,\s]+/g),l=o.length,s,c;for(u=0;u<l;u++)c=decodeURIComponent(h(o[u].replace(/(^')|('$)/g,""))),s=e.params[u].toLowerCase(),f[s]=c;f.address=[f.name,f.domain].join("@")}}):i.type="url":(f=="encode"&&(o=o.replace(d,function(n,t,i){return"mailto:"+String.fromCharCode.apply(String,t.split(","))+(i&&h(i))})),ut=o.match(v),ut&&(et=o.match(y),ot=o.match(p),i.type="email",it=i.email={},it.address=ut[1],et&&(it.subject=decodeURIComponent(et[1])),ot&&(it.body=decodeURIComponent(ot[1])))),t){if(l=t.getAttribute("target"),i.target={},i.adv={},l)ct=l.match(k),ct?i.target.type=i.target.name=l:(i.target.type="frame",i.target.name=l);else if(st=t.getAttribute("_cke_pa_onclick")||t.getAttribute("onclick"),rt=st&&st.match(nt),rt)for(i.target.type="popup",i.target.name=rt[1];s=tt.exec(rt[2]);)s[2]=="yes"||s[2]=="1"?i.target[s[1]]=!0:isFinite(s[2])&&(i.target[s[1]]=s[2]);vt=this,u=function(n,r){var u=t.getAttribute(r);u!==null&&(i.adv[n]=u||"")},u("advId","id"),u("advLangDir","dir"),u("advAccessKey","accessKey"),u("advName","name"),u("advLangCode","lang"),u("advTabIndex","tabindex"),u("advTitle","title"),u("advContentType","type"),u("advCSSClasses","class"),u("advCharset","charset"),u("advStyles","style")}var lt=n.document.getElementsByTag("img"),at=new CKEDITOR.dom.nodeList(n.document.$.anchors),a=i.anchors=[];for(r=0;r<lt.count();r++)c=lt.getItem(r),c.getAttribute("_cke_realelement")&&c.getAttribute("_cke_real_element_type")=="anchor"&&a.push(n.restoreRealElement(c));for(r=0;r<at.count();r++)a.push(at.getItem(r));for(r=0;r<a.length;r++)c=a[r],a[r]={name:c.getAttribute("name"),id:c.getAttribute("id")};return this._.selectedElement=t,i},o=function(n,t){t[n]&&this.setValue(t[n][this.id]||"")},t=function(n){return o.call(this,"target",n)},r=function(n){return o.call(this,"adv",n)},s=function(n,t){t[n]||(t[n]={}),t[n][this.id]=this.getValue()||""},i=function(n){return s.call(this,"target",n)},u=function(n){return s.call(this,"adv",n)},f=n.config.emailProtection||"",e;return f&&f!="encode"&&(e={},f.replace(/^([^(]+)\(([^)]+)\)$/,function(n,t,i){e.name=t,e.params=[],i.replace(/[^,\s]+/g,function(n){e.params.push(n)})})),{title:n.lang.link.title,minWidth:350,minHeight:230,contents:[{id:"info",label:n.lang.link.info,title:n.lang.link.info,elements:[{id:"linkType",type:"select",label:n.lang.link.type,"default":"url",items:[[n.lang.common.url,"url"],[n.lang.link.toAnchor,"anchor"],[n.lang.link.toEmail,"email"]],onChange:a,setup:function(n){n.type&&this.setValue(n.type)},commit:function(n){n.type=this.getValue()}},{type:"vbox",id:"urlOptions",children:[{type:"hbox",widths:["25%","75%"],children:[{id:"protocol",type:"select",label:n.lang.common.protocol,"default":"https://",style:"width : 100%;",items:[["https://"],["https://"],["ftp://"],["news://"],["<other>",""]],setup:function(n){n.url&&this.setValue(n.url.protocol||"")},commit:function(n){n.url||(n.url={}),n.url.protocol=this.getValue()}},{type:"text",id:"url",label:n.lang.common.url,onLoad:function(){this.allowOnChange=!0},onKeyUp:function(){var n=this;n.allowOnChange=!1;var r=n.getDialog().getContentElement("info","protocol"),t=n.getValue(),i=/^(http|https|ftp|news):\/\/(?=.)/gi.exec(t);i?(n.setValue(t.substr(i[0].length)),r.setValue(i[0].toLowerCase())):/^((javascript:)|[#\/\.])/gi.test(t)&&r.setValue(""),n.allowOnChange=!0},onChange:function(){this.allowOnChange&&this.onKeyUp()},validate:function(){var t=this.getDialog(),i;return t.getContentElement("info","linkType")&&t.getValueOf("info","linkType")!="url"?!0:this.getDialog().fakeObj?!0:(i=CKEDITOR.dialog.validate.notEmpty(n.lang.link.noUrl),i.apply(this))},setup:function(n){var t=this,i;t.allowOnChange=!1,n.url&&t.setValue(n.url.url),t.allowOnChange=!0,i=t.getDialog().getContentElement("info","linkType"),i&&i.getValue()=="url"&&t.select()},commit:function(n){n.url||(n.url={}),n.url.url=this.getValue(),this.allowOnChange=!1}}],setup:function(){this.getDialog().getContentElement("info","linkType")||this.getElement().show()}},{type:"button",id:"browse",hidden:"true",filebrowser:"info:url",label:n.lang.common.browseServer}]},{type:"vbox",id:"anchorOptions",width:260,align:"center",padding:0,children:[{type:"html",id:"selectAnchorText",html:CKEDITOR.tools.htmlEncode(n.lang.link.selectAnchor),setup:function(n){n.anchors.length>0?this.getElement().show():this.getElement().hide()}},{type:"html",id:"noAnchors",style:"text-align: center;",html:"<div>"+CKEDITOR.tools.htmlEncode(n.lang.link.noAnchors)+"<\/div>",setup:function(n){n.anchors.length<1?this.getElement().show():this.getElement().hide()}},{type:"hbox",id:"selectAnchor",children:[{type:"select",id:"anchorName","default":"",label:n.lang.link.anchorName,style:"width: 100%;",items:[[""]],setup:function(n){var t=this,i,r;for(t.clear(),t.add(""),i=0;i<n.anchors.length;i++)n.anchors[i].name&&t.add(n.anchors[i].name);n.anchor&&t.setValue(n.anchor.name),r=t.getDialog().getContentElement("info","linkType"),r&&r.getValue()=="email"&&t.focus()},commit:function(n){n.anchor||(n.anchor={}),n.anchor.name=this.getValue()}},{type:"select",id:"anchorId","default":"",label:n.lang.link.anchorId,style:"width: 100%;",items:[[""]],setup:function(n){var i=this,t;for(i.clear(),i.add(""),t=0;t<n.anchors.length;t++)n.anchors[t].id&&i.add(n.anchors[t].id);n.anchor&&i.setValue(n.anchor.id)},commit:function(n){n.anchor||(n.anchor={}),n.anchor.id=this.getValue()}}],setup:function(n){n.anchors.length>0?this.getElement().show():this.getElement().hide()}}],setup:function(){this.getDialog().getContentElement("info","linkType")||this.getElement().hide()}},{type:"vbox",id:"emailOptions",padding:1,children:[{type:"text",id:"emailAddress",label:n.lang.link.emailAddress,validate:function(){var t=this.getDialog(),i;return!t.getContentElement("info","linkType")||t.getValueOf("info","linkType")!="email"?!0:(i=CKEDITOR.dialog.validate.notEmpty(n.lang.link.noEmail),i.apply(this))},setup:function(n){n.email&&this.setValue(n.email.address);var t=this.getDialog().getContentElement("info","linkType");t&&t.getValue()=="email"&&this.select()},commit:function(n){n.email||(n.email={}),n.email.address=this.getValue()}},{type:"text",id:"emailSubject",label:n.lang.link.emailSubject,setup:function(n){n.email&&this.setValue(n.email.subject)},commit:function(n){n.email||(n.email={}),n.email.subject=this.getValue()}},{type:"textarea",id:"emailBody",label:n.lang.link.emailBody,rows:3,"default":"",setup:function(n){n.email&&this.setValue(n.email.body)},commit:function(n){n.email||(n.email={}),n.email.body=this.getValue()}}],setup:function(){this.getDialog().getContentElement("info","linkType")||this.getElement().hide()}}]},{id:"target",label:n.lang.link.target,title:n.lang.link.target,elements:[{type:"hbox",widths:["50%","50%"],children:[{type:"select",id:"linkTargetType",label:n.lang.link.target,"default":"notSet",style:"width : 100%;",items:[[n.lang.link.targetNotSet,"notSet"],[n.lang.link.targetFrame,"frame"],[n.lang.link.targetPopup,"popup"],[n.lang.link.targetNew,"_blank"],[n.lang.link.targetTop,"_top"],[n.lang.link.targetSelf,"_self"],[n.lang.link.targetParent,"_parent"]],onChange:l,setup:function(n){n.target&&this.setValue(n.target.type)},commit:function(n){n.target||(n.target={}),n.target.type=this.getValue()}},{type:"text",id:"linkTargetName",label:n.lang.link.targetFrameName,"default":"",setup:function(n){n.target&&this.setValue(n.target.name)},commit:function(n){n.target||(n.target={}),n.target.name=this.getValue()}}]},{type:"vbox",width:260,align:"center",padding:2,id:"popupFeatures",children:[{type:"html",html:CKEDITOR.tools.htmlEncode(n.lang.link.popupFeatures)},{type:"hbox",children:[{type:"checkbox",id:"resizable",label:n.lang.link.popupResizable,setup:t,commit:i},{type:"checkbox",id:"status",label:n.lang.link.popupStatusBar,setup:t,commit:i}]},{type:"hbox",children:[{type:"checkbox",id:"location",label:n.lang.link.popupLocationBar,setup:t,commit:i},{type:"checkbox",id:"toolbar",label:n.lang.link.popupToolbar,setup:t,commit:i}]},{type:"hbox",children:[{type:"checkbox",id:"menubar",label:n.lang.link.popupMenuBar,setup:t,commit:i},{type:"checkbox",id:"fullscreen",label:n.lang.link.popupFullScreen,setup:t,commit:i}]},{type:"hbox",children:[{type:"checkbox",id:"scrollbars",label:n.lang.link.popupScrollBars,setup:t,commit:i},{type:"checkbox",id:"dependent",label:n.lang.link.popupDependent,setup:t,commit:i}]},{type:"hbox",children:[{type:"text",widths:["30%","70%"],labelLayout:"horizontal",label:n.lang.link.popupWidth,id:"width",setup:t,commit:i},{type:"text",labelLayout:"horizontal",widths:["55%","45%"],label:n.lang.link.popupLeft,id:"left",setup:t,commit:i}]},{type:"hbox",children:[{type:"text",labelLayout:"horizontal",widths:["30%","70%"],label:n.lang.link.popupHeight,id:"height",setup:t,commit:i},{type:"text",labelLayout:"horizontal",label:n.lang.link.popupTop,widths:["55%","45%"],id:"top",setup:t,commit:i}]}]}]},{id:"upload",label:n.lang.link.upload,title:n.lang.link.upload,hidden:!0,filebrowser:"uploadButton",elements:[{type:"file",id:"upload",label:n.lang.common.upload,style:"height:40px",size:29},{type:"fileButton",id:"uploadButton",label:n.lang.common.uploadSubmit,filebrowser:"info:url","for":["upload","upload"]}]},{id:"advanced",label:n.lang.link.advanced,title:n.lang.link.advanced,elements:[{type:"vbox",padding:1,children:[{type:"hbox",widths:["45%","35%","20%"],children:[{type:"text",id:"advId",label:n.lang.link.id,setup:r,commit:u},{type:"select",id:"advLangDir",label:n.lang.link.langDir,"default":"",style:"width:110px",items:[[n.lang.link.langDirNotSet,""],[n.lang.link.langDirLTR,"ltr"],[n.lang.link.langDirRTL,"rtl"]],setup:r,commit:u},{type:"text",id:"advAccessKey",width:"80px",label:n.lang.link.acccessKey,maxLength:1,setup:r,commit:u}]},{type:"hbox",widths:["45%","35%","20%"],children:[{type:"text",label:n.lang.link.name,id:"advName",setup:r,commit:u},{type:"text",label:n.lang.link.langCode,id:"advLangCode",width:"110px","default":"",setup:r,commit:u},{type:"text",label:n.lang.link.tabIndex,id:"advTabIndex",width:"80px",maxLength:5,setup:r,commit:u}]}]},{type:"vbox",padding:1,children:[{type:"hbox",widths:["45%","55%"],children:[{type:"text",label:n.lang.link.advisoryTitle,"default":"",id:"advTitle",setup:r,commit:u},{type:"text",label:n.lang.link.advisoryContentType,"default":"",id:"advContentType",setup:r,commit:u}]},{type:"hbox",widths:["45%","55%"],children:[{type:"text",label:n.lang.link.cssClasses,"default":"",id:"advCSSClasses",setup:r,commit:u},{type:"text",label:n.lang.link.charset,"default":"",id:"advCharset",setup:r,commit:u}]},{type:"hbox",children:[{type:"text",label:n.lang.link.styles,"default":"",id:"advStyles",setup:r,commit:u}]}]}]}],onShow:function(){var t=this,u;t.fakeObj=!1;var i=t.getParentEditor(),r=i.getSelection(),f=r.getRanges(),n=null,e=t;f.length==1&&(u=f[0].getCommonAncestor(!0),n=u.getAscendant("a",!0),n&&n.getAttribute("href")?r.selectElement(n):(n=u.getAscendant("img",!0))&&n.getAttribute("_cke_real_element_type")&&n.getAttribute("_cke_real_element_type")=="anchor"?(t.fakeObj=n,n=i.restoreRealElement(t.fakeObj),r.selectElement(t.fakeObj)):n=null),t.setupContent(it.apply(t,[i,n]))},onOk:function(){var t={href:"javascript:void(0)/*"+CKEDITOR.tools.getNextNumber()+"*/"},p=[],n={href:t.href},lt=this,s=this.getParentEditor(),it,w,ft,et,h,o,b,g,u,r,v,a,nt,tt,d,i,y;this.commitContent(n);switch(n.type||"url"){case"url":it=n.url&&n.url.protocol!=undefined?n.url.protocol:"https://",w=n.url&&n.url.url||"",t._cke_saved_href=w.indexOf("/")===0?w:it+w;break;case"anchor":ft=n.anchor&&n.anchor.name,et=n.anchor&&n.anchor.id,t._cke_saved_href="#"+(ft||et||"");break;case"email":o=n.email,b=o.address;switch(f){case"":case"encode":var ot=encodeURIComponent(o.subject||""),st=encodeURIComponent(o.body||""),e=[];ot&&e.push("subject="+ot),st&&e.push("body="+st),e=e.length?"?"+e.join("&"):"",f=="encode"?(h=["javascript:void(location.href='mailto:'+",ut(b)],e&&h.push("+'",c(e),"'"),h.push(")")):h=["mailto:",b,e];break;default:g=b.split("@",2),o.name=g[0],o.domain=g[1],h=["javascript:",rt(o)]}t._cke_saved_href=h.join("")}if(n.target)if(n.target.type=="popup"){var ht=["window.open(this.href, '",n.target.name||"","', '"],l=["resizable","status","location","toolbar","menubar","fullscreen","scrollbars","dependent"],ct=l.length,k=function(t){n.target[t]&&l.push(t+"="+n.target[t])};for(u=0;u<ct;u++)l[u]=l[u]+(n.target[l[u]]?"=yes":"=no");k("width"),k("left"),k("height"),k("top"),ht.push(l.join(","),"'); return false;"),t._cke_pa_onclick=ht.join("")}else n.target.type!="notSet"&&n.target.name?t.target=n.target.name:p.push("target"),p.push("_cke_pa_onclick","onclick");if(n.adv&&(r=function(i,r){var u=n.adv[i];u?t[r]=u:p.push(r)},this._.selectedElement&&r("advId","id"),r("advLangDir","dir"),r("advAccessKey","accessKey"),r("advName","name"),r("advLangCode","lang"),r("advTabIndex","tabindex"),r("advTitle","title"),r("advContentType","type"),r("advCSSClasses","class"),r("advCharset","charset"),r("advStyles","style")),this._.selectedElement)i=this._.selectedElement,CKEDITOR.env.ie&&t.name!=i.getAttribute("name")&&(y=new CKEDITOR.dom.element('<a name="'+CKEDITOR.tools.htmlEncode(t.name)+'">',s.document),v=s.getSelection(),i.moveChildren(y),i.copyAttributes(y,{name:1}),y.replace(i),i=y,v.selectElement(i)),i.setAttributes(t),i.removeAttributes(p),i.getAttribute("name")?i.addClass("cke_anchor"):i.removeClass("cke_anchor"),this.fakeObj&&s.createFakeElement(i,"cke_anchor","anchor").replace(this.fakeObj),delete this._.selectedElement;else if(v=s.getSelection(),a=v.getRanges(),a.length==1&&a[0].collapsed&&(nt=new CKEDITOR.dom.text(t._cke_saved_href,s.document),a[0].insertNode(nt),a[0].selectNodeContents(nt),v.selectRanges(a)),tt=new CKEDITOR.style({element:"a",attributes:t}),tt.type=CKEDITOR.STYLE_INLINE,tt.apply(s.document),n.adv&&n.adv.advId)for(d=this.getParentEditor().document.$.getElementsByTagName("a"),u=0;u<d.length;u++)if(d[u].href==t.href){d[u].id=n.adv.advId;break}},onLoad:function(){n.config.linkShowAdvancedTab||this.hidePage("advanced"),n.config.linkShowTargetTab||this.hidePage("target")}}});