(function(a){a.fn.popeye=function(d){var b=a.extend({},a.fn.popeye.defaults,d);function c(a,c){if(window.console&&window.console.log&&b.debug)if(c=="info"&&window.console.info)window.console.info(a);else if(c=="warn"&&window.console.warn)window.console.warn(a);else window.console.log(a)}return this.each(function(){a(this).addClass("ppy-active");for(var d=a(this),o=d.find(".ppy-imglist > li > a > img"),p=d.find(".ppy-imglist > li > a"),g=o.length,F=g==1?true:false,s=false,i=false,e=0,E="ppy-expanded",w="ppy-loading",W="ppy-single-image",G=a('<div class="ppy-placeholder"></div>'),j=a('<div class="ppy-stagewrap"></div>'),r=a('<div class="ppy-captionwrap"></div>'),B=d.find(".ppy-outer"),f=d.find(".ppy-stage"),x=d.find(".ppy-nav"),J=d.find(".ppy-prev"),I=d.find(".ppy-next"),z=d.find(".ppy-switch-enlarge"),y=d.find(".ppy-switch-compact").addClass("ppy-hidden"),n=d.find(".ppy-play"),v=d.find(".ppy-pause").addClass("ppy-hidden"),h=d.find(".ppy-caption"),V=d.find(".ppy-text"),P=d.find(".ppy-counter"),Q=d.find(".ppy-current"),S=d.find(".ppy-total"),U={position:"absolute",width:"auto",height:"auto",margin:0,top:0,left:b.direction=="right"?0:"auto",right:b.direction=="left"?0:"auto"},R={height:f.height(),width:f.width()},O={height:h.height()},N={height:b.caption=="hover"||false?B.outerHeight():d.outerHeight(),width:b.caption=="hover"||false?B.outerWidth():d.outerWidth(),"float":a("body").attr("dir")=="ltr"?"left":"right","margin-top":d.css("margin-top"),"margin-right":d.css("margin-right"),"margin-bottom":d.css("margin-bottom"),"margin-left":d.css("margin-left")},l=[],q=0;q<o.length;q++){var K=d.find(".ppy-imglist li").eq(q).find(".ppy-extcaption");l[q]=K.length>0?K.html():o[q].alt}if(!f.length||!x.length||!B.length)c("$.fn.popeye: Incorrect HTML structure","warn");else if(g===0)c("$.fn.popeye: No images found","warn");else{F?c("$.fn.popeye -> SingleImageMode started"):c("$.fn.popeye -> "+g+" thumbnails found.");X()}function k(g,n){n=n||false;g=g||e;var r={backgroundImage:"url("+o[g].src+")"},u={height:"+=0"};if(i){m();f.fadeTo(b.duration/2,0).animate(R,{queue:false,duration:b.duration,easing:b.easing,complete:function(){i=false;c("$.fn.showThumb: Entering COMPACT MODE","info");d.removeClass(E);d.css("z-index","").parent().css("z-index","");z.removeClass("ppy-hidden");y.addClass("ppy-hidden");k();a(this).fadeTo(b.duration/2,1)}})}else{if(n){j.addClass(w);f.fadeTo(b.duration/2,0);var h=new Image;h.onload=function(){c("$.fn.popeye.showThumb: Thumbnail "+g+" loaded","info");j.removeClass(w);f.animate(u,1,"linear",function(){f.css(r);a(this).fadeTo(b.duration/2,1);if(b.caption=="hover"&&s)t(l[g]);else b.caption=="permanent"&&H(l[g]);A()});h.onload=function(){}};h.src=o[g].src}else{f.css(r);A();t(l[g],true)}var q=new Image;q.onload=function(){c("$.fn.popeye.showThumb: Image "+g+" loaded","info");q.onload=function(){}};q.src=p[g].href}}function u(g){g=g||e;j.addClass(w);f.fadeTo(b.duration/2,0);var k=a("."+E);k.css("z-index",b.zindex-1);d.css("z-index",b.zindex).parent().css("z-index",b.zindex);var h=new Image;h.onload=function(){j.removeClass(w);var k={width:h.width,height:h.height},e={backgroundImage:"url("+p[g].href+")",backgroundPosition:"left top"};m();f.animate(k,{queue:false,duration:b.duration,easing:b.easing,complete:function(){b.navigation=="hover"&&s&&D();i=true;c("$.fn.popeye.showImage: Entering ENLARGED MODE","info");d.addClass(E);y.removeClass("ppy-hidden");z.addClass("ppy-hidden");A();a(this).css(e).fadeTo(b.duration/2,1);t(l[g]);M()}})};h.src=p[g].href}function A(a){a=a||e;S.text(g);Q.text(a+1);c("$.fn.popeye.updateCounter: Displaying image "+(a+1)+" of "+g)}function M(b){b=b||e;var c=new Image,d=new Image,a=b;if(a<g-1)a++;else a=0;c.src=p[a].href;a=b;if(a<=0)a=g-1;else a--;d.src=p[a].href}function D(){x.stop().fadeTo(150,b.opacity)}function C(){x.stop().fadeTo(150,0)}function H(a){b.caption&&V.html(a)}function t(a,e){if(a&&b.caption){H(a);c("$.fn.popeye.showCaption -> ppyCaptionWrap.outerHeight(true): "+r.outerHeight(true));var d={visibility:"visible"};h.css(d);if(b.caption==="permanent"&&!i)h.css(O);else h.animate({height:r.outerHeight(true)},{queue:false,duration:90,easing:b.easing})}else!a&&!e&&m()}function m(){var a={visibility:"hidden",overflow:"hidden"};h.animate({height:"0px"},{queue:false,duration:90,easing:b.easing,complete:function(){h.css(a)}})}function T(){if(e<=0)e=g-1;else e--;if(i)u(e);else k(e,true);return e}function L(){if(e<g-1)e++;else e=0;if(i)u(e);else k(e,true);return e}function X(){G.css(N);d.css(U);d.wrap(G);j=f.wrap(j).parent();r=h.wrapInner(r).children().eq(0);k();if(b.navigation=="hover"){C();d.hover(function(){D()},function(){C()});x.hover(function(){D()},function(){C()})}if(!F){J.click(function(a){a.stopPropagation();T()});I.click(function(a){a.stopPropagation();L()})}else{d.addClass(W);J.remove();I.remove();n.remove();v.remove();P.remove()}if(b.caption=="hover"){m();d.hover(function(){t(l[e])},function(){m(true)})}z.click(function(a){a.stopPropagation();u();return false});y.click(function(a){a.stopPropagation();k(e);return false});f.click(function(){if(i)k(e);else u()});n.click(function(a){a.stopPropagation();v.removeClass("ppy-hidden");n.addClass("ppy-hidden");slideshow=window.setInterval(function(){L()},b.slidespeed);return false});v.click(function(a){a.stopPropagation();n.removeClass("ppy-hidden");v.addClass("ppy-hidden");window.clearInterval(slideshow);return false});d.mouseenter(function(){s=true}).mouseleave(function(){s=false});b.autoslide&&n.trigger("click")}})};a.fn.popeye.defaults={navigation:"hover",caption:"hover",zindex:1e4,direction:a("body").attr("dir")=="ltr"?"right":"left",duration:240,opacity:.8,easing:"swing",slidespeed:2e3,autoslide:false,debug:false}})(jQuery);jQuery("head").append('<style type="text/css"> .ppy-imglist { position: absolute; top: -1000em; left: -1000em; } </style>');