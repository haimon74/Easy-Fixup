(function(){function n(n,t,i){t.is&&t.getCustomData("block_processed")||(t.is&&CKEDITOR.dom.element.setMarker(i,t,"block_processed",!0),n.push(t))}function t(t,i){function e(n){for(var i=new CKEDITOR.dom.elementPath(n).elements,r,t=0;t<i.length;t++)if(i[t].getName()in u){r=i[t];break}return r}function o(){this.foreach(function(n){/^(?!vbox|hbox)/.test(n.type)&&(n.setup||(n.setup=function(t){n.setValue(t.getAttribute(n.id)||"")}),n.commit||(n.commit=function(t){var i=this.getValue();("dir"!=n.id||t.getComputedStyle("direction")!=i)&&(i?t.setAttribute(n.id,i):t.removeAttribute(n.id))}))})}function s(t){for(var w=[],h={},v=[],s,y=t.document.getSelection(),b=y.getRanges(),d=y.createBookmarks(),k,nt=t.config.enterMode==CKEDITOR.ENTER_DIV?"div":"p",i,p,o,l,a,e,g,r=0;r<b.length;r++)for(k=b[r].createIterator();s=k.getNextParagraph();)if(s.getName()in u)for(p=s.getChildren(),i=0;i<p.count();i++)n(v,p.getItem(i),h);else{while(!f[s.getName()]&&s.getName()!="body")s=s.getParent();n(v,s,h)}for(CKEDITOR.dom.element.clearAllMarkers(h),o=c(v),r=0;r<o.length;r++){for(e=o[r][0],l=e.getParent(),i=1;i<o[r].length;i++)l=l.getCommonAncestor(o[r][i]);for(a=new CKEDITOR.dom.element("div",t.document),i=0;i<o[r].length;i++){for(e=o[r][i];!e.getParent().equals(l);)e=e.getParent();o[r][i]=e}for(g=null,i=0;i<o[r].length;i++)e=o[r][i],e.getCustomData&&e.getCustomData("block_processed")||(e.is&&CKEDITOR.dom.element.setMarker(h,e,"block_processed",!0),i||a.insertBefore(e),a.append(e));CKEDITOR.dom.element.clearAllMarkers(h),w.push(a)}return y.selectBookmarks(d),w}function h(n){var i=new CKEDITOR.dom.elementPath(n.getSelection().getStartElement()),t=i.blockLimit;return t&&t.getAscendant("div",!0)}function c(n){for(var t=[],f=null,r,u,i=0;i<n.length;i++)r=n[i],u=e(r),u.equals(f)||(f=u,t.push([])),t[t.length-1].push(r);return t}var u=function(){var n=CKEDITOR.tools.extend({},CKEDITOR.dtd.$blockLimit);return delete n.div,t.config.div_wrapTable&&(delete n.td,delete n.th),n}(),f=CKEDITOR.dtd.div,r=[];return{title:t.lang.div.title,minWidth:400,minHeight:165,contents:[{id:"info",label:t.lang.common.generalTab,title:t.lang.common.generalTab,elements:[{type:"hbox",widths:["50%","50%"],children:[{id:"elementStyle",type:"select",style:"width: 100%;",label:t.lang.div.styleSelectLabel,"default":"",items:[],setup:function(n){this.setValue(n.$.style.cssText||"")},commit:function(n){this.getValue()?n.$.style.cssText=this.getValue():n.removeAttribute("style")}},{id:"class",type:"text",label:t.lang.common.cssClass,"default":""}]}]},{id:"advanced",label:t.lang.common.advancedTab,title:t.lang.common.advancedTab,elements:[{type:"vbox",padding:1,children:[{type:"hbox",widths:["50%","50%"],children:[{type:"text",id:"id",label:t.lang.common.id,"default":""},{type:"text",id:"lang",label:t.lang.link.langCode,"default":""}]},{type:"hbox",children:[{type:"text",id:"style",style:"width: 100%;",label:t.lang.common.cssStyle,"default":""}]},{type:"hbox",children:[{type:"text",id:"title",style:"width: 100%;",label:t.lang.common.advisoryTitle,"default":""}]},{type:"select",id:"dir",style:"width: 100%;",label:t.lang.common.langDir,"default":"",items:[[t.lang.common.langDirLtr,"ltr"],[t.lang.common.langDirRtl,"rtl"]]}]}]}],onLoad:function(){o.call(this)},onShow:function(){if(i=="editdiv"){var n=h(t);n&&this.setupContent(this._element=n)}},onOk:function(){r=i=="editdiv"?[this._element]:s(t,!0);for(var n=0;n<r.length;n++)this.commitContent(r[n]);this.hide()}}}CKEDITOR.dialog.add("creatediv",function(n){return t(n,"creatediv")}),CKEDITOR.dialog.add("editdiv",function(n){return t(n,"editdiv")})})();