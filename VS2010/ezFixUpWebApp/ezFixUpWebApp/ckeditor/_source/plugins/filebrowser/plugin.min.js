(function(){function t(n,t){var r=[],i;if(t)for(i in t)r.push(i+"="+encodeURIComponent(t[i]));else return n;return n+(n.indexOf("?")!=-1?"&":"?")+r.join("&")}function n(n){n+="";var t=n.charAt(0).toUpperCase();return t+n.substr(1)}function u(){var u=this.getDialog(),i=u.getParentEditor(),f;i._.filebrowserSe=this;var e=i.config["filebrowser"+n(u.getName())+"WindowWidth"]||i.config.filebrowserWindowWidth||"80%",o=i.config["filebrowser"+n(u.getName())+"WindowHeight"]||i.config.filebrowserWindowHeight||"70%",r=this.filebrowser.params||{};r.CKEditor=i.name,r.CKEditorFuncNum=i._.filebrowserFn,r.langCode||(r.langCode=i.langCode),f=t(this.filebrowser.url,r),i.popup(f,e,o)}function f(){var n=this.getDialog(),t=n.getParentEditor();return(t._.filebrowserSe=this,!n.getContentElement(this["for"][0],this["for"][1]).getInputElement().$.value)?!1:n.getContentElement(this["for"][0],this["for"][1]).getAction()?!0:!1}function e(n,i,r){var u=r.params||{};u.CKEditor=n.name,u.CKEditorFuncNum=n._.filebrowserFn,u.langCode||(u.langCode=n.langCode),i.action=t(r.url,u),i.filebrowser=r}function i(t,r,o,s){var h,l,a,c;for(l in s)(h=s[l],(h.type=="hbox"||h.type=="vbox")&&i(t,r,o,h.children),h.filebrowser)&&(typeof h.filebrowser=="string"&&(a={action:h.type=="fileButton"?"QuickUpload":"Browse",target:h.filebrowser},h.filebrowser=a),h.filebrowser.action=="Browse"?(c=h.filebrowser.url||t.config["filebrowser"+n(r)+"BrowseUrl"]||t.config.filebrowserBrowseUrl,c&&(h.onClick=u,h.filebrowser.url=c,h.hidden=!1)):h.filebrowser.action=="QuickUpload"&&h["for"]&&(c=h.filebrowser.url||t.config["filebrowser"+n(r)+"UploadUrl"]||t.config.filebrowserUploadUrl,c&&(h.onClick=f,h.filebrowser.url=c,h.hidden=!1,e(t,o.getContents(h["for"][0]).get(h["for"][1]),h.filebrowser))))}function o(n,t){var u=t.getDialog(),f=t.filebrowser.target||null,i,r;n=n.replace(/#/g,"%23"),f&&(i=f.split(":"),r=u.getContentElement(i[0],i[1]),r&&(r.setValue(n),u.selectPage(i[0])))}function r(n,t,i){var f,u;if(i.indexOf(";")!==-1){for(f=i.split(";"),u=0;u<f.length;u++)if(r(n,t,f[u]))return!0;return!1}return n.getContents(t).get(i).filebrowser&&n.getContents(t).get(i).filebrowser.url}function s(n,t){var u=this._.filebrowserSe.getDialog(),i=this._.filebrowserSe["for"],r=this._.filebrowserSe.filebrowser.onSelect;(i&&u.getContentElement(i[0],i[1]).reset(),r&&r.call(this._.filebrowserSe,n,t)===!1)||(typeof t=="string"&&t&&alert(t),n&&o(n,this._.filebrowserSe))}CKEDITOR.plugins.add("filebrowser",{init:function(n){n._.filebrowserFn=CKEDITOR.tools.addFunction(s,n);CKEDITOR.on("dialogDefinition",function(n){for(var t in n.data.definition.contents)i(n.editor,n.data.name,n.data.definition,n.data.definition.contents[t].elements),n.data.definition.contents[t].hidden&&n.data.definition.contents[t].filebrowser&&(n.data.definition.contents[t].hidden=!r(n.data.definition,n.data.definition.contents[t].id,n.data.definition.contents[t].filebrowser))})}})})();