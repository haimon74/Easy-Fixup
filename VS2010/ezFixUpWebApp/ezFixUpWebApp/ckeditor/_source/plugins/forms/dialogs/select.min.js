CKEDITOR.dialog.add("select",function(n){function i(n,i,r,u,f){n=t(n);var e;if(e=u?u.createElement("OPTION"):document.createElement("OPTION"),n&&e&&e.getName()=="option")CKEDITOR.env.ie?(isNaN(parseInt(f,10))?n.$.options.add(e.$):n.$.options.add(e.$,f),e.$.innerHTML=i.length>0?i:"",e.$.value=r):(f!==null&&f<n.getChildCount()?n.getChild(f<0?0:f).insertBeforeMe(e):n.append(e),e.setText(i.length>0?i:""),e.setValue(r));else return!1;return e}function s(n){var u,i;for(n=t(n),u=r(n),i=n.getChildren().count()-1;i>=0;i--)n.getChild(i).$.selected&&n.getChild(i).remove();f(n,u)}function h(n,i,r,u){if(n=t(n),i<0)return!1;var f=n.getChild(i);return f.setText(r),f.setValue(u),f}function e(n){for(n=t(n);n.getChild(0)&&n.getChild(0).remove(););}function u(n,u,e){var s,o;if((n=t(n),s=r(n),s<0)||(o=s+u,o=o<0?0:o,o=o>=n.getChildCount()?n.getChildCount()-1:o,s==o))return!1;var h=n.getChild(s),c=h.getText(),l=h.getValue();return h.remove(),h=i(n,c,l,e?e:null,o),f(n,o),h}function r(n){return n=t(n),n?n.$.selectedIndex:-1}function f(n,i){if(n=t(n),i<0)return null;var r=n.getChildren().count();return n.$.selectedIndex=i>=r?r-1:i,n}function o(n){return n=t(n),n?n.getChildren():!1}function t(n){return n&&n.domId&&n.getInputElement().$?n.getInputElement():n&&n.$?n:!1}return{title:n.lang.select.title,minWidth:CKEDITOR.env.ie?460:395,minHeight:CKEDITOR.env.ie?320:300,onShow:function(){var n,i,t;if(delete this.selectBox,this.setupContent("clear"),n=this.getParentEditor().getSelection().getSelectedElement(),n&&n.getName()=="select")for(this.selectBox=n,this.setupContent(n.getName(),n),i=o(n),t=0;t<i.count();t++)this.setupContent("option",i.getItem(t))},onOk:function(){var t=this.getParentEditor(),n=this.selectBox,r=!n,i,u;r&&(n=t.document.createElement("select")),this.commitContent(n),r&&(t.insertElement(n),CKEDITOR.env.ie&&(i=t.getSelection(),u=i.createBookmarks(),setTimeout(function(){i.selectBookmarks(u)},0)))},contents:[{id:"info",label:n.lang.select.selectInfo,title:n.lang.select.selectInfo,accessKey:"",elements:[{id:"txtName",type:"text",widths:["25%","75%"],labelLayout:"horizontal",label:n.lang.common.name,"default":"",accessKey:"N",align:"center",style:"width:350px",setup:function(n,t){n=="clear"?this.setValue(""):n=="select"&&this.setValue(t.getAttribute("_cke_saved_name")||t.getAttribute("name")||"")},commit:function(n){this.getValue()?n.setAttribute("_cke_saved_name",this.getValue()):(n.removeAttribute("_cke_saved_name"),n.removeAttribute("name"))}},{id:"txtValue",type:"text",widths:["25%","75%"],labelLayout:"horizontal",label:n.lang.select.value,style:"width:350px","default":"",className:"cke_disabled",onLoad:function(){this.getInputElement().setAttribute("readOnly",!0)},setup:function(n,t){n=="clear"?this.setValue(""):n=="option"&&t.getAttribute("selected")&&this.setValue(t.$.value)}},{type:"hbox",widths:["175px","170px"],align:"center",children:[{id:"txtSize",type:"text",align:"center",labelLayout:"horizontal",label:n.lang.select.size,"default":"",accessKey:"S",style:"width:175px",validate:function(){var t=CKEDITOR.dialog.validate.integer(n.lang.common.validateNumberFailed);return this.getValue()===""||t.apply(this)},setup:function(n,t){n=="select"&&this.setValue(t.getAttribute("size")||""),CKEDITOR.env.webkit&&this.getInputElement().setStyle("width","86px")},commit:function(n){this.getValue()?n.setAttribute("size",this.getValue()):n.removeAttribute("size")}},{type:"html",html:"<span>"+CKEDITOR.tools.htmlEncode(n.lang.select.lines)+"<\/span>"}]},{type:"html",html:"<span>"+CKEDITOR.tools.htmlEncode(n.lang.select.opAvail)+"<\/span>"},{type:"hbox",widths:["115px","115px","100px"],align:"top",children:[{type:"vbox",children:[{id:"txtOptName",type:"text",label:n.lang.select.opText,style:"width:115px",setup:function(n){n=="clear"&&this.setValue("")}},{type:"select",id:"cmbName",label:"",title:"",size:5,style:"width:115px;height:75px",items:[],onChange:function(){var n=this.getDialog(),t=n.getContentElement("info","cmbValue"),i=n.getContentElement("info","txtOptName"),u=n.getContentElement("info","txtOptValue"),e=r(this);f(t,e),i.setValue(this.getValue()),u.setValue(t.getValue())},setup:function(n,t){n=="clear"?e(this):n=="option"&&i(this,t.getText(),t.getText(),this.getDialog().getParentEditor().document)},commit:function(n){var r=this.getDialog(),f=o(this),s=o(r.getContentElement("info","cmbValue")),h=r.getContentElement("info","txtValue").getValue(),t,u;for(e(n),t=0;t<f.count();t++)u=i(n,f.getItem(t).getValue(),s.getItem(t).getValue(),r.getParentEditor().document),s.getItem(t).getValue()==h&&(u.setAttribute("selected","selected"),u.selected=!0)}}]},{type:"vbox",children:[{id:"txtOptValue",type:"text",label:n.lang.select.opValue,style:"width:115px",setup:function(n){n=="clear"&&this.setValue("")}},{type:"select",id:"cmbValue",label:"",size:5,style:"width:115px;height:75px",items:[],onChange:function(){var n=this.getDialog(),t=n.getContentElement("info","cmbName"),i=n.getContentElement("info","txtOptName"),u=n.getContentElement("info","txtOptValue"),e=r(this);f(t,e),i.setValue(t.getValue()),u.setValue(this.getValue())},setup:function(n,t){if(n=="clear")e(this);else if(n=="option"){var r=t.getValue();i(this,r,r,this.getDialog().getParentEditor().document),t.getAttribute("selected")=="selected"&&this.getDialog().getContentElement("info","txtValue").setValue(r)}}}]},{type:"vbox",padding:5,children:[{type:"button",style:"",label:n.lang.select.btnAdd,title:n.lang.select.btnAdd,style:"width:100%;",onClick:function(){var n=this.getDialog(),e=n.getParentEditor(),t=n.getContentElement("info","txtOptName"),r=n.getContentElement("info","txtOptValue"),u=n.getContentElement("info","cmbName"),f=n.getContentElement("info","cmbValue");i(u,t.getValue(),t.getValue(),n.getParentEditor().document),i(f,r.getValue(),r.getValue(),n.getParentEditor().document),t.setValue(""),r.setValue("")}},{type:"button",label:n.lang.select.btnModify,title:n.lang.select.btnModify,style:"width:100%;",onClick:function(){var n=this.getDialog(),i=n.getContentElement("info","txtOptName"),u=n.getContentElement("info","txtOptValue"),f=n.getContentElement("info","cmbName"),e=n.getContentElement("info","cmbValue"),t=r(f);t>=0&&(h(f,t,i.getValue(),i.getValue()),h(e,t,u.getValue(),u.getValue()))}},{type:"button",style:"width:100%;",label:n.lang.select.btnUp,title:n.lang.select.btnUp,onClick:function(){var n=this.getDialog(),t=n.getContentElement("info","cmbName"),i=n.getContentElement("info","cmbValue");u(t,-1,n.getParentEditor().document),u(i,-1,n.getParentEditor().document)}},{type:"button",style:"width:100%;",label:n.lang.select.btnDown,title:n.lang.select.btnDown,onClick:function(){var n=this.getDialog(),t=n.getContentElement("info","cmbName"),i=n.getContentElement("info","cmbValue");u(t,1,n.getParentEditor().document),u(i,1,n.getParentEditor().document)}}]}]},{type:"hbox",widths:["40%","20%","40%"],children:[{type:"button",label:n.lang.select.btnSetValue,title:n.lang.select.btnSetValue,onClick:function(){var n=this.getDialog(),t=n.getContentElement("info","cmbValue"),i=n.getContentElement("info","txtValue");i.setValue(t.getValue())}},{type:"button",label:n.lang.select.btnDelete,title:n.lang.select.btnDelete,onClick:function(){var n=this.getDialog(),t=n.getContentElement("info","cmbName"),i=n.getContentElement("info","cmbValue"),r=n.getContentElement("info","txtOptName"),u=n.getContentElement("info","txtOptValue");s(t),s(i),r.setValue(""),u.setValue("")}},{id:"chkMulti",type:"checkbox",label:n.lang.select.chkMulti,"default":"",accessKey:"M",value:"checked",setup:function(n,t){n=="select"&&this.setValue(t.getAttribute("multiple")),CKEDITOR.env.webkit&&this.getElement().getParent().setStyle("vertical-align","middle")},commit:function(n){this.getValue()?n.setAttribute("multiple",this.getValue()):n.removeAttribute("multiple")}}]}]}]}});