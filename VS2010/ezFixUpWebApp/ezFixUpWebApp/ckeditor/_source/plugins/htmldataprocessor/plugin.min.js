(function(){function o(n){for(var i=n.children.length,t=n.children[i-1];t&&t.type==CKEDITOR.NODE_TEXT&&!CKEDITOR.tools.trim(t.value);)t=n.children[--i];return t}function s(n,t){var r=n.children,i=o(n);i&&((t||!CKEDITOR.env.ie)&&i.type==CKEDITOR.NODE_ELEMENT&&i.name=="br"&&r.pop(),i.type==CKEDITOR.NODE_TEXT&&l.test(i.value)&&r.pop())}function h(n){var t=o(n);return!t||t.type==CKEDITOR.NODE_ELEMENT&&t.name=="br"}function a(n){s(n,!0),h(n)&&(CKEDITOR.env.ie?n.add(new CKEDITOR.htmlParser.text(" ")):n.add(new CKEDITOR.htmlParser.element("br",{})))}function v(n){s(n),h(n)&&n.add(new CKEDITOR.htmlParser.text(" "))}function g(n){return n.replace(y,"$& _cke_saved_$1")}function nt(n){return n.replace(p,function(n){return"<cke:encoded>"+encodeURIComponent(n)+"<\/cke:encoded>"})}function tt(n){return n.replace(w,function(n,t){return decodeURIComponent(t)})}function it(n){return n.replace(b,"$1cke:$2")}function rt(n){return n.replace(k,"$1$2")}function ut(n){return n.replace(d,"<cke:$1$2><\/cke:$1>")}function ft(t){return t.replace(/<!--(?!{cke_protected})[\s\S]+?-->/g,function(t){return"<!--"+n+"{C}"+encodeURIComponent(t).replace(/--/g,"%2D%2D")+"-->"})}function et(n){return n.replace(/<!--\{cke_protected\}\{C\}([\s\S]+?)-->/g,function(n,t){return decodeURIComponent(t)})}function ot(t,i){var r=[],f=/<\!--\{cke_temp(comment)?\}(\d*?)-->/g,e=[/<script[\s\S]*?<\/script>/gi,/<noscript[\s\S]*?<\/noscript>/gi].concat(i),u;for(t=t.replace(/<!--[\s\S]*?-->/g,function(n){return"<!--{cke_tempcomment}"+(r.push(n)-1)+"-->"}),u=0;u<e.length;u++)t=t.replace(e[u],function(n){return n=n.replace(f,function(n,t,i){return r[i]}),"<!--{cke_temp}"+(r.push(n)-1)+"-->"});return t.replace(f,function(t,i,u){return"<!--"+n+(i?"{C}":"")+encodeURIComponent(r[u]).replace(/--/g,"%2D%2D")+"-->"})}var l=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,n="{cke_protected}",r=CKEDITOR.dtd,i=CKEDITOR.tools.extend({},r.$block,r.$listItem,r.$tableContent),t,c,u,f,e;for(t in i)"br"in r[t]||delete i[t];delete i.pre,c={attributeNames:[[/^on/,"_cke_pa_on"]]},u={elements:{}};for(t in i)u.elements[t]=a;f={elementNames:[[/^cke:/,""],[/^\?xml:namespace$/,""]],attributeNames:[[/^_cke_(saved|pa)_/,""],[/^_cke.*/,""],["hidefocus",""]],elements:{$:function(n){var i=n.attributes,r,u,t;if(i){if(i.cke_temp)return!1;for(r=["name","href","src"],t=0;t<r.length;t++)u="_cke_saved_"+r[t],u in i&&delete i[r[t]]}return n},embed:function(n){var t=n.parent,i,r;t&&t.name=="object"&&(i=t.attributes.width,r=t.attributes.height,i&&(n.attributes.width=i),r&&(n.attributes.height=r))},param:function(n){return n.children=[],n.isEmpty=!0,n},a:function(n){if(!(n.children.length||n.attributes.name||n.attributes._cke_saved_name))return!1},body:function(n){delete n.attributes.spellcheck,delete n.attributes.contenteditable},style:function(n){var t=n.children[0];t&&t.value&&(t.value=CKEDITOR.tools.trim(t.value)),n.attributes.type||(n.attributes.type="text/css")}},attributes:{"class":function(n){return CKEDITOR.tools.ltrim(n.replace(/(?:^|\s+)cke_[^\s]*/g,""))||!1}},comment:function(t){return t.substr(0,n.length)==n?(t=t.substr(n.length,3)=="{C}"?t.substr(n.length+3):t.substr(n.length),new CKEDITOR.htmlParser.cdata(decodeURIComponent(t))):t}},e={elements:{}};for(t in i)e.elements[t]=v;CKEDITOR.env.ie&&(f.attributes.style=function(n){return n.toLowerCase()});var y=/<(?:a|area|img|input)[\s\S]*?\s((?:href|src|name)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+)))/gi,p=/(?:<style(?=[ >])[^>]*>[\s\S]*<\/style>)|(?:<(:?link|meta|base)[^>]*>)/gi,w=/<cke:encoded>([^<]*)<\/cke:encoded>/gi,b=/(<\/?)((?:object|embed|param|html|body|head|title)[^>]*>)/gi,k=/(<\/?)cke:((?:html|body|head|title)[^>]*>)/gi,d=/<cke:(param|embed)([^>]*?)\/?>(?!\s*<\/cke:\1)/gi;CKEDITOR.plugins.add("htmldataprocessor",{requires:["htmlwriter"],init:function(n){var t=n.dataProcessor=new CKEDITOR.htmlDataProcessor(n);t.writer.forceSimpleAmpersand=n.config.forceSimpleAmpersand,t.dataFilter.addRules(c),t.dataFilter.addRules(u),t.htmlFilter.addRules(f),t.htmlFilter.addRules(e)}}),CKEDITOR.htmlDataProcessor=function(n){this.editor=n,this.writer=new CKEDITOR.htmlWriter,this.dataFilter=new CKEDITOR.htmlParser.filter,this.htmlFilter=new CKEDITOR.htmlParser.filter},CKEDITOR.htmlDataProcessor.prototype={toHtml:function(n,t){var i,u,r;return n=ot(n,this.editor.config.protectedSource),n=g(n),n=nt(n),n=it(n),n=ut(n),i=new CKEDITOR.dom.element("div"),i.setHtml("a"+n),n=i.getHtml().substr(1),n=rt(n),n=tt(n),n=et(n),u=CKEDITOR.htmlParser.fragment.fromHtml(n,t),r=new CKEDITOR.htmlParser.basicWriter,u.writeHtml(r,this.dataFilter),n=r.getHtml(!0),ft(n)},toDataFormat:function(n,t){var i=this.writer,r=CKEDITOR.htmlParser.fragment.fromHtml(n,t);return i.reset(),r.writeHtml(i,this.htmlFilter),i.getHtml(!0)}}})(),CKEDITOR.config.forceSimpleAmpersand=!1;