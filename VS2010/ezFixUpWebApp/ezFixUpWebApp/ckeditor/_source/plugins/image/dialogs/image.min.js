(function(){function p(){var t=arguments,n=this.getContentElement("advanced","txtdlgGenStyle");n&&n.commit.apply(n,t),this.foreach(function(n){n.commit&&n.id!="txtdlgGenStyle"&&n.commit.apply(n,t)})}function u(t){var i,r,e,f,u;if(!h){if(h=1,i=this.getDialog(),r=i.imageElement,r)for(this.commit(n,r),t=[].concat(t),e=t.length,u=0;u<e;u++)f=i.getContentElement.apply(i,t[u].split(":")),f&&f.setup(n,r);h=0}}var n=1,f=2,r=4,i=8,e=/^\s*(\d+)((px)|\%)?\s*$/i,c=/(^\s*(\d+)((px)|\%)?\s*$)|^$/i,s=/^\d+px$/,l=function(){var n=this.getValue(),i=this.getDialog(),u=n.match(e),r;u&&(u[2]=="%"&&o(i,!1),n=u[1]),i.lockRatio&&(r=i.originalElement,r.getCustomData("isReady")=="true"&&(this.id=="txtHeight"?(n&&n!="0"&&(n=Math.round(r.$.width*(n/r.$.height))),isNaN(n)||i.setValueOf("info","txtWidth",n)):(n&&n!="0"&&(n=Math.round(r.$.height*(n/r.$.width))),isNaN(n)||i.setValueOf("info","txtHeight",n)))),t(i)},t=function(n){return!n.originalElement||!n.preview?1:(n.commitContent(r,n.preview),0)},h,o=function(n,t){var i=n.originalElement,r=CKEDITOR.document.getById("btnLockSizes");if(i.getCustomData("isReady")=="true")if(t=="check"){var u=n.getValueOf("info","txtWidth"),f=n.getValueOf("info","txtHeight"),e=i.$.width*1e3/i.$.height,o=u*1e3/f;n.lockRatio=!1,u||f?isNaN(e)||isNaN(o)||Math.round(e)==Math.round(o)&&(n.lockRatio=!0):n.lockRatio=!0}else n.lockRatio=t!=undefined?t:!n.lockRatio;else t!="check"&&(n.lockRatio=!1);return n.lockRatio?r.removeClass("cke_btn_unlocked"):r.addClass("cke_btn_unlocked"),n.lockRatio},a=function(n){var i=n.originalElement;i.getCustomData("isReady")=="true"&&(n.setValueOf("info","txtWidth",i.$.width),n.setValueOf("info","txtHeight",i.$.height)),t(n)},v=function(t,i){function u(n,t){var i=n.match(e);return i?(i[2]=="%"&&(i[1]+="%",o(h,!1)),i[1]):t}if(t==n){var h=this.getDialog(),r="",f=this.id=="txtWidth"?"width":"height",s=i.getAttribute(f);s&&(r=u(s,r)),r=u(i.getStyle(f),r),this.setValue(r)}},y=function(h,y){var k,b=function(){var n=this.originalElement;n.setCustomData("isReady","true"),n.removeListener("load",b),n.removeListener("error",w),n.removeListener("abort",w),CKEDITOR.document.getById("ImagePreviewLoader").setStyle("display","none"),this.dontResetSize||a(this),this.firstLoad&&CKEDITOR.tools.setTimeout(function(){o(this,"check")},0,this),this.firstLoad=!1,this.dontResetSize=!1},w=function(){var n=this.originalElement,t;n.removeListener("load",b),n.removeListener("error",w),n.removeListener("abort",w),t=CKEDITOR.getUrl(h.skinPath+"images/noimage.png"),this.preview&&this.preview.setAttribute("src",t),CKEDITOR.document.getById("ImagePreviewLoader").setStyle("display","none"),o(this,!1)};return{title:y=="image"?h.lang.image.title:h.lang.image.titleButton,minWidth:420,minHeight:310,onShow:function(){var r,e;this.imageElement=!1,this.linkElement=!1,this.imageEditMode=!1,this.linkEditMode=!1,this.lockRatio=!0,this.dontResetSize=!1,this.firstLoad=!0,this.addLink=!1;var u=this.getParentEditor(),s=this.getParentEditor().getSelection(),t=s.getSelectedElement(),i=t&&t.getAscendant("a");CKEDITOR.document.getById("ImagePreviewLoader").setStyle("display","none"),k=new CKEDITOR.dom.element("img",u.document),this.preview=CKEDITOR.document.getById("previewImage"),this.originalElement=u.document.createElement("img"),this.originalElement.setAttribute("alt",""),this.originalElement.setCustomData("isReady","false"),i&&(this.linkElement=i,this.linkEditMode=!0,r=i.getChildren(),r.count()==1&&(e=r.getItem(0).getName(),(e=="img"||e=="input")&&(this.imageElement=r.getItem(0),this.imageElement.getName()=="img"?this.imageEditMode="img":this.imageElement.getName()=="input"&&(this.imageEditMode="input"))),y=="image"&&this.setupContent(f,i)),(t&&t.getName()=="img"&&!t.getAttribute("_cke_realelement")||t&&t.getName()=="input"&&t.getAttribute("type")=="image")&&(this.imageEditMode=t.getName(),this.imageElement=t),this.imageEditMode?(this.cleanImageElement=this.imageElement,this.imageElement=this.cleanImageElement.clone(!0,!0),this.setupContent(n,this.imageElement),o(this,!0)):this.imageElement=u.document.createElement("img"),CKEDITOR.tools.trim(this.getValueOf("info","txtUrl"))||(this.preview.removeAttribute("src"),this.preview.setStyle("display","none"))},onOk:function(){if(this.imageEditMode){var t=this.imageEditMode;y=="image"&&t=="input"&&confirm(h.lang.image.button2Img)?(t="img",this.imageElement=h.document.createElement("img"),this.imageElement.setAttribute("alt",""),h.insertElement(this.imageElement)):y!="image"&&t=="img"&&confirm(h.lang.image.img2Button)?(t="input",this.imageElement=h.document.createElement("input"),this.imageElement.setAttributes({type:"image",alt:""}),h.insertElement(this.imageElement)):(this.imageElement=this.cleanImageElement,delete this.cleanImageElement)}else y=="image"?this.imageElement=h.document.createElement("img"):(this.imageElement=h.document.createElement("input"),this.imageElement.setAttribute("type","image")),this.imageElement.setAttribute("alt","");this.linkEditMode||(this.linkElement=h.document.createElement("a")),this.commitContent(n,this.imageElement),this.commitContent(f,this.linkElement),this.imageElement.getAttribute("style")||this.imageElement.removeAttribute("style"),this.imageEditMode?!this.linkEditMode&&this.addLink?(h.insertElement(this.linkElement),this.imageElement.appendTo(this.linkElement)):this.linkEditMode&&!this.addLink&&(h.getSelection().selectElement(this.linkElement),h.insertElement(this.imageElement)):this.addLink?this.linkEditMode?h.insertElement(this.imageElement):(h.insertElement(this.linkElement),this.linkElement.append(this.imageElement,!1)):h.insertElement(this.imageElement)},onLoad:function(){y!="image"&&this.hidePage("Link");var n=this._.element.getDocument();this.addFocusable(n.getById("btnResetSize"),5),this.addFocusable(n.getById("btnLockSizes"),5),this.commitContent=p},onHide:function(){this.preview&&this.commitContent(i,this.preview),this.originalElement&&(this.originalElement.removeListener("load",b),this.originalElement.removeListener("error",w),this.originalElement.removeListener("abort",w),this.originalElement.remove(),this.originalElement=!1),delete this.imageElement},contents:[{id:"info",label:h.lang.image.infoTab,accessKey:"I",elements:[{type:"vbox",padding:0,children:[{type:"html",html:"<span>"+CKEDITOR.tools.htmlEncode(h.lang.image.url)+"<\/span>"},{type:"hbox",widths:["280px","110px"],align:"right",children:[{id:"txtUrl",type:"text",label:"",onChange:function(){var n=this.getDialog(),r=this.getValue(),i,u;if(r.length>0){n=this.getDialog(),i=n.originalElement,n.preview.removeStyle("display"),i.setCustomData("isReady","false"),u=CKEDITOR.document.getById("ImagePreviewLoader"),u&&u.setStyle("display","");i.on("load",b,n);i.on("error",w,n);i.on("abort",w,n);i.setAttribute("src",r),k.setAttribute("src",r),n.preview.setAttribute("src",k.$.src),t(n)}else n.preview&&(n.preview.removeAttribute("src"),n.preview.setStyle("display","none"))},setup:function(t,i){if(t==n){var u=i.getAttribute("_cke_saved_src")||i.getAttribute("src"),r=this;this.getDialog().dontResetSize=!0,r.setValue(u),r.setInitValue(),r.focus()}},commit:function(t,r){t==n&&(this.getValue()||this.isChanged())?(r.setAttribute("_cke_saved_src",decodeURI(this.getValue())),r.setAttribute("src",decodeURI(this.getValue()))):t==i&&(r.setAttribute("src",""),r.removeAttribute("src"))},validate:CKEDITOR.dialog.validate.notEmpty(h.lang.image.urlMissing)},{type:"button",id:"browse",align:"center",label:h.lang.common.browseServer,hidden:!0,filebrowser:"info:txtUrl"}]}]},{id:"txtAlt",type:"text",label:h.lang.image.alt,accessKey:"A","default":"",onChange:function(){t(this.getDialog())},setup:function(t,i){t==n&&this.setValue(i.getAttribute("alt"))},commit:function(t,u){t==n?(this.getValue()||this.isChanged())&&u.setAttribute("alt",this.getValue()):t==r?u.setAttribute("alt",this.getValue()):t==i&&u.removeAttribute("alt")}},{type:"hbox",widths:["140px","240px"],children:[{type:"vbox",padding:10,children:[{type:"hbox",widths:["70%","30%"],children:[{type:"vbox",padding:1,children:[{type:"text",width:"40px",id:"txtWidth",labelLayout:"horizontal",label:h.lang.image.width,onKeyUp:l,onChange:function(){u.call(this,"advanced:txtdlgGenStyle")},validate:function(){var n=this.getValue().match(c);return n||alert(h.lang.common.validateNumberFailed),!!n},setup:v,commit:function(t,u,f){var o=this.getValue(),h,s;t==n?(o?u.setStyle("width",CKEDITOR.tools.cssLength(o)):!o&&this.isChanged()&&u.removeStyle("width"),f||u.removeAttribute("width")):t==r?(h=o.match(e),h?u.setStyle("width",o+"px"):(s=this.getDialog().originalElement,s.getCustomData("isReady")=="true"&&u.setStyle("width",s.$.width+"px"))):t==i&&(u.removeAttribute("width"),u.removeStyle("width"))}},{type:"text",id:"txtHeight",width:"40px",labelLayout:"horizontal",label:h.lang.image.height,onKeyUp:l,onChange:function(){u.call(this,"advanced:txtdlgGenStyle")},validate:function(){var n=this.getValue().match(c);return n||alert(h.lang.common.validateNumberFailed),!!n},setup:v,commit:function(t,u,f){var o=this.getValue(),h,s;t==n?(o?u.setStyle("height",CKEDITOR.tools.cssLength(o)):!o&&this.isChanged()&&u.removeStyle("height"),f||t!=n||u.removeAttribute("height")):t==r?(h=o.match(e),h?u.setStyle("height",o+"px"):(s=this.getDialog().originalElement,s.getCustomData("isReady")=="true"&&u.setStyle("height",s.$.height+"px"))):t==i&&(u.removeAttribute("height"),u.removeStyle("height"))}}]},{type:"html",style:"margin-top:10px;width:40px;height:40px;",onLoad:function(){var n=CKEDITOR.document.getById("btnResetSize"),i=CKEDITOR.document.getById("btnLockSizes");if(n){n.on("click",function(){a(this)},this.getDialog());n.on("mouseover",function(){this.addClass("cke_btn_over")},n);n.on("mouseout",function(){this.removeClass("cke_btn_over")},n)}if(i){i.on("click",function(){var u=o(this),n=this.originalElement,r=this.getValueOf("info","txtWidth"),i;n.getCustomData("isReady")=="true"&&r&&(i=n.$.height/n.$.width*r,isNaN(i)||(this.setValueOf("info","txtHeight",Math.round(i)),t(this)))},this.getDialog());i.on("mouseover",function(){this.addClass("cke_btn_over")},i);i.on("mouseout",function(){this.removeClass("cke_btn_over")},i)}},html:'<div><a href="javascript:void(0)" tabindex="-1" title="'+h.lang.image.lockRatio+'" class="cke_btn_locked" id="btnLockSizes"><\/a><a href="javascript:void(0)" tabindex="-1" title="'+h.lang.image.resetSize+'" class="cke_btn_reset" id="btnResetSize"><\/a><\/div>'}]},{type:"vbox",padding:1,children:[{type:"text",id:"txtBorder",width:"60px",labelLayout:"horizontal",label:h.lang.image.border,"default":"",onKeyUp:function(){t(this.getDialog())},onChange:function(){u.call(this,"advanced:txtdlgGenStyle")},validate:function(){var n=CKEDITOR.dialog.validate.integer(h.lang.common.validateNumberFailed);return n.apply(this)},setup:function(t,i){if(t==n){var u,r=i.getStyle("border-width");r=r&&r.match(/^(\d+px)(?: \1 \1 \1)?$/),u=r&&parseInt(r[1],10),u||(u=i.getAttribute("border")),this.setValue(u)}},commit:function(t,u,f){var e=parseInt(this.getValue(),10);t==n||t==r?(e?(u.setStyle("border-width",CKEDITOR.tools.cssLength(e)),u.setStyle("border-style","solid")):!e&&this.isChanged()&&(u.removeStyle("border-width"),u.removeStyle("border-style"),u.removeStyle("border-color")),f||t!=n||u.removeAttribute("border")):t==i&&(u.removeAttribute("border"),u.removeStyle("border-width"),u.removeStyle("border-style"),u.removeStyle("border-color"))}},{type:"text",id:"txtHSpace",width:"60px",labelLayout:"horizontal",label:h.lang.image.hSpace,"default":"",onKeyUp:function(){t(this.getDialog())},onChange:function(){u.call(this,"advanced:txtdlgGenStyle")},validate:function(){var n=CKEDITOR.dialog.validate.integer(h.lang.common.validateNumberFailed);return n.apply(this)},setup:function(t,i){if(t==n){var r,e,o,u=i.getStyle("margin-left"),f=i.getStyle("margin-right");u=u&&u.match(s),f=f&&f.match(s),e=parseInt(u,10),o=parseInt(f,10),r=e==o&&e,r||(r=i.getAttribute("hspace")),this.setValue(r)}},commit:function(t,u,f){var e=parseInt(this.getValue(),10);t==n||t==r?(e?(u.setStyle("margin-left",CKEDITOR.tools.cssLength(e)),u.setStyle("margin-right",CKEDITOR.tools.cssLength(e))):!e&&this.isChanged()&&(u.removeStyle("margin-left"),u.removeStyle("margin-right")),f||t!=n||u.removeAttribute("hspace")):t==i&&(u.removeAttribute("hspace"),u.removeStyle("margin-left"),u.removeStyle("margin-right"))}},{type:"text",id:"txtVSpace",width:"60px",labelLayout:"horizontal",label:h.lang.image.vSpace,"default":"",onKeyUp:function(){t(this.getDialog())},onChange:function(){u.call(this,"advanced:txtdlgGenStyle")},validate:function(){var n=CKEDITOR.dialog.validate.integer(h.lang.common.validateNumberFailed);return n.apply(this)},setup:function(t,i){if(t==n){var r,e,o,u=i.getStyle("margin-top"),f=i.getStyle("margin-bottom");u=u&&u.match(s),f=f&&f.match(s),e=parseInt(u,10),o=parseInt(f,10),r=e==o&&e,r||(r=i.getAttribute("vspace")),this.setValue(r)}},commit:function(t,u,f){var e=parseInt(this.getValue(),10);t==n||t==r?(e?(u.setStyle("margin-top",CKEDITOR.tools.cssLength(e)),u.setStyle("margin-bottom",CKEDITOR.tools.cssLength(e))):!e&&this.isChanged()&&(u.removeStyle("margin-top"),u.removeStyle("margin-bottom")),f||t!=n||u.removeAttribute("vspace")):t==i&&(u.removeAttribute("vspace"),u.removeStyle("margin-top"),u.removeStyle("margin-bottom"))}},{id:"cmbAlign",type:"select",labelLayout:"horizontal",widths:["35%","65%"],style:"width:90px",label:h.lang.image.align,"default":"",items:[[h.lang.common.notSet,""],[h.lang.image.alignLeft,"left"],[h.lang.image.alignRight,"right"]],onChange:function(){t(this.getDialog()),u.call(this,"advanced:txtdlgGenStyle")},setup:function(t,i){if(t==n){var r=i.getStyle("float");switch(r){case"inherit":case"none":r=""}r||(r=(i.getAttribute("align")||"").toLowerCase()),this.setValue(r)}},commit:function(t,u,f){var e=this.getValue();if(t==n||t==r){if(e?u.setStyle("float",e):!e&&this.isChanged()&&u.removeStyle("float"),!f&&t==n){e=(u.getAttribute("align")||"").toLowerCase();switch(e){case"left":case"right":u.removeAttribute("align")}}}else t==i&&u.removeStyle("float")}}]}]},{type:"vbox",height:"250px",children:[{type:"html",style:"width:95%;",html:"<div>"+CKEDITOR.tools.htmlEncode(h.lang.image.preview)+'<br><div id="ImagePreviewLoader" style="display:none"><div class="loading">&nbsp;<\/div><\/div><div id="ImagePreviewBox"><a href="javascript:void(0)" target="_blank" onclick="return false;" id="previewLink"><img id="previewImage" alt="" /><\/a>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Maecenas feugiat consequat diam. Maecenas metus. Vivamus diam purus, cursus a, commodo non, facilisis vitae, nulla. Aenean dictum lacinia tortor. Nunc iaculis, nibh non iaculis aliquam, orci felis euismod neque, sed ornare massa mauris sed velit. Nulla pretium mi et risus. Fusce mi pede, tempor id, cursus ac, ullamcorper nec, enim. Sed tortor. Curabitur molestie. Duis velit augue, condimentum at, ultrices a, luctus ut, orci. Donec pellentesque egestas eros. Integer cursus, augue in cursus faucibus, eros pede bibendum sem, in tempus tellus justo quis ligula. Etiam eget tortor. Vestibulum rutrum, est ut placerat elementum, lectus nisl aliquam velit, tempor aliquam eros nunc nonummy metus. In eros metus, gravida a, gravida sed, lobortis id, turpis. Ut ultrices, ipsum at venenatis fringilla, sem nulla lacinia tellus, eget aliquet turpis mauris non enim. Nam turpis. Suspendisse lacinia. Curabitur ac tortor ut ipsum egestas elementum. Nunc imperdiet gravida mauris.<\/div><\/div>'}]}]}]},{id:"Link",label:h.lang.link.title,padding:0,elements:[{id:"txtUrl",type:"text",label:h.lang.image.url,style:"width: 100%","default":"",setup:function(n,t){if(n==f){var i=t.getAttribute("_cke_saved_href");i||(i=t.getAttribute("href")),this.setValue(i)}},commit:function(n,t){n==f&&(this.getValue()||this.isChanged())&&(t.setAttribute("_cke_saved_href",decodeURI(this.getValue())),t.setAttribute("href","javascript:void(0)/*"+CKEDITOR.tools.getNextNumber()+"*/"),(this.getValue()||!h.config.image_removeLinkByEmptyURL)&&(this.getDialog().addLink=!0))}},{type:"button",id:"browse",filebrowser:"Link:txtUrl",style:"float:right",hidden:!0,label:h.lang.common.browseServer},{id:"cmbTarget",type:"select",label:h.lang.link.target,"default":"",items:[[h.lang.link.targetNotSet,""],[h.lang.link.targetNew,"_blank"],[h.lang.link.targetTop,"_top"],[h.lang.link.targetSelf,"_self"],[h.lang.link.targetParent,"_parent"]],setup:function(n,t){n==f&&this.setValue(t.getAttribute("target"))},commit:function(n,t){n==f&&(this.getValue()||this.isChanged())&&t.setAttribute("target",this.getValue())}}]},{id:"Upload",hidden:!0,filebrowser:"uploadButton",label:h.lang.image.upload,elements:[{type:"file",id:"upload",label:h.lang.image.btnUpload,style:"height:40px",size:38},{type:"fileButton",id:"uploadButton",filebrowser:"info:txtUrl",label:h.lang.image.btnUpload,"for":["Upload","upload"]}]},{id:"advanced",label:h.lang.common.advancedTab,elements:[{type:"hbox",widths:["50%","25%","25%"],children:[{type:"text",id:"linkId",label:h.lang.common.id,setup:function(t,i){t==n&&this.setValue(i.getAttribute("id"))},commit:function(t,i){t==n&&(this.getValue()||this.isChanged())&&i.setAttribute("id",this.getValue())}},{id:"cmbLangDir",type:"select",style:"width : 100px;",label:h.lang.common.langDir,"default":"",items:[[h.lang.common.notSet,""],[h.lang.common.langDirLtr,"ltr"],[h.lang.common.langDirRtl,"rtl"]],setup:function(t,i){t==n&&this.setValue(i.getAttribute("dir"))},commit:function(t,i){t==n&&(this.getValue()||this.isChanged())&&i.setAttribute("dir",this.getValue())}},{type:"text",id:"txtLangCode",label:h.lang.common.langCode,"default":"",setup:function(t,i){t==n&&this.setValue(i.getAttribute("lang"))},commit:function(t,i){t==n&&(this.getValue()||this.isChanged())&&i.setAttribute("lang",this.getValue())}}]},{type:"text",id:"txtGenLongDescr",label:h.lang.common.longDescr,setup:function(t,i){t==n&&this.setValue(i.getAttribute("longDesc"))},commit:function(t,i){t==n&&(this.getValue()||this.isChanged())&&i.setAttribute("longDesc",this.getValue())}},{type:"hbox",widths:["50%","50%"],children:[{type:"text",id:"txtGenClass",label:h.lang.common.cssClass,"default":"",setup:function(t,i){t==n&&this.setValue(i.getAttribute("class"))},commit:function(t,i){t==n&&(this.getValue()||this.isChanged())&&i.setAttribute("class",this.getValue())}},{type:"text",id:"txtGenTitle",label:h.lang.common.advisoryTitle,"default":"",onChange:function(){t(this.getDialog())},setup:function(t,i){t==n&&this.setValue(i.getAttribute("title"))},commit:function(t,u){t==n?(this.getValue()||this.isChanged())&&u.setAttribute("title",this.getValue()):t==r?u.setAttribute("title",this.getValue()):t==i&&u.removeAttribute("title")}}]},{type:"text",id:"txtdlgGenStyle",label:h.lang.common.cssStyle,"default":"",setup:function(t,i){var r;if(t==n){r=i.getAttribute("style"),!r&&i.$.style.cssText&&(r=i.$.style.cssText),this.setValue(r);var u=i.$.style.height,f=i.$.style.width,o=(u?u:"").match(e),s=(f?f:"").match(e);this.attributesInStyle={height:!!o,width:!!s}}},onChange:function(){u.call(this,["info:cmbFloat","info:cmbAlign","info:txtVSpace","info:txtHSpace","info:txtBorder","info:txtWidth","info:txtHeight"]),t(this)},commit:function(t,i){t==n&&(this.getValue()||this.isChanged())&&i.setAttribute("style",this.getValue())}}]}]}};CKEDITOR.dialog.add("image",function(n){return y(n,"image")}),CKEDITOR.dialog.add("imagebutton",function(n){return y(n,"imagebutton")})})();