(function(){function n(n,t){n.getCommand(this.name).setState(t)}function r(i){for(var e=i.data.path.elements,a,f,r=i.editor,l,s,o,h,c,u=0;u<e.length;u++){if(e[u].getName()=="li"){f=e[u];continue}if(t[e[u].getName()]){a=e[u];break}}if(a){if(this.name=="outdent")return n.call(this,r,CKEDITOR.TRISTATE_OFF);while(f&&(f=f.getPrevious(CKEDITOR.dom.walker.whitespaces(!0))))if(f.getName&&f.getName()=="li")return n.call(this,r,CKEDITOR.TRISTATE_OFF);return n.call(this,r,CKEDITOR.TRISTATE_DISABLED)}return!this.useIndentClasses&&this.name=="indent"?n.call(this,r,CKEDITOR.TRISTATE_OFF):(l=i.data.path,s=l.block||l.blockLimit,!s)?n.call(this,r,CKEDITOR.TRISTATE_DISABLED):this.useIndentClasses?(o=s.$.className.match(this.classNameRegex),h=0,o&&(o=o[1],h=this.indentClassMap[o]),this.name=="outdent"&&!h||this.name=="indent"&&h==r.config.indentClasses.length)?n.call(this,r,CKEDITOR.TRISTATE_DISABLED):n.call(this,r,CKEDITOR.TRISTATE_OFF):(c=parseInt(s.getStyle(this.indentCssProperty),10),isNaN(c)&&(c=0),c<=0)?n.call(this,r,CKEDITOR.TRISTATE_DISABLED):n.call(this,r,CKEDITOR.TRISTATE_OFF)}function u(n,i,r){for(var f=i.startContainer,e=i.endContainer,c,u,v,k,p,s;f&&!f.getParent().equals(r);)f=f.getParent();while(e&&!e.getParent().equals(r))e=e.getParent();if(f&&e){for(var a=f,h=[],d=!1;!d;)a.equals(e)&&(d=!0),h.push(a),a=a.getNext();if(!(h.length<1)){for(c=r.getParents(!0),u=0;u<c.length;u++)if(c[u].getName&&t[c[u].getName()]){r=c[u];break}var g=this.name=="indent"?1:-1,tt=h[0],w=h[h.length-1],b={},o=CKEDITOR.plugins.list.listToArray(r,b),it=o[w.getCustomData("listarray_index")].indent;for(u=tt.getCustomData("listarray_index");u<=w.getCustomData("listarray_index");u++)o[u].indent+=g;for(u=w.getCustomData("listarray_index")+1;u<o.length&&o[u].indent>it;u++)o[u].indent+=g;if(v=CKEDITOR.plugins.list.arrayToList(o,b,null,n.config.enterMode,0),this.name=="outdent"&&(k=r.getParent())&&k.is("li")){var nt=v.listNode.getChildren(),l=[],rt=nt.count(),y;for(u=rt-1;u>=0;u--)(y=nt.getItem(u))&&y.is&&y.is("li")&&l.push(y)}if(v&&v.listNode.replace(r),l&&l.length)for(u=0;u<l.length;u++){for(p=l[u],s=p;(s=s.getNext())&&s.is&&s.getName()in t;)p.append(s);p.insertAfter(k)}CKEDITOR.dom.element.clearAllMarkers(b)}}}function f(n,t){var e=t.createIterator(),s=n.config.enterMode,u,f,i,o,r;for(e.enforceRealBlocks=!0,e.enlargeBr=s!=CKEDITOR.ENTER_BR;u=e.getNextParagraph();)this.useIndentClasses?(f=u.$.className.match(this.classNameRegex),i=0,f&&(f=f[1],i=this.indentClassMap[f]),this.name=="outdent"?i--:i++,i=Math.min(i,n.config.indentClasses.length),i=Math.max(i,0),o=CKEDITOR.tools.ltrim(u.$.className.replace(this.classNameRegex,"")),i<1?u.$.className=o:u.addClass(n.config.indentClasses[i-1])):(r=parseInt(u.getStyle(this.indentCssProperty),10),isNaN(r)&&(r=0),r+=(this.name=="indent"?1:-1)*n.config.indentOffset,r=Math.max(r,0),r=Math.ceil(r/n.config.indentOffset)*n.config.indentOffset,u.setStyle(this.indentCssProperty,r?r+n.config.indentUnit:""),u.getAttribute("style")===""&&u.removeAttribute("style"))}function i(n,t){if(this.name=t,this.useIndentClasses=n.config.indentClasses&&n.config.indentClasses.length>0,this.useIndentClasses){this.classNameRegex=new RegExp("(?:^|\\s+)("+n.config.indentClasses.join("|")+")(?=$|\\s)"),this.indentClassMap={};for(var i=0;i<n.config.indentClasses.length;i++)this.indentClassMap[n.config.indentClasses[i]]=i+1}else this.indentCssProperty=n.config.contentsLangDirection=="ltr"?"margin-left":"margin-right"}var t={ol:1,ul:1};i.prototype={exec:function(n){var r=n.getSelection(),e=r&&r.getRanges()[0],o,i;if(r&&e){for(o=r.createBookmarks(!0),i=e.getCommonAncestor();i&&!(i.type==CKEDITOR.NODE_ELEMENT&&t[i.getName()]);)i=i.getParent();i?u.call(this,n,e,i):f.call(this,n,e),n.focus(),n.forceNextSelectionCheck(),r.selectBookmarks(o)}}},CKEDITOR.plugins.add("indent",{init:function(n){var t=new i(n,"indent"),u=new i(n,"outdent");n.addCommand("indent",t),n.addCommand("outdent",u),n.ui.addButton("Indent",{label:n.lang.indent,command:"indent"}),n.ui.addButton("Outdent",{label:n.lang.outdent,command:"outdent"});n.on("selectionChange",CKEDITOR.tools.bind(r,t));n.on("selectionChange",CKEDITOR.tools.bind(r,u))},requires:["domiterator","list"]})})(),CKEDITOR.tools.extend(CKEDITOR.config,{indentOffset:40,indentUnit:"px",indentClasses:null});