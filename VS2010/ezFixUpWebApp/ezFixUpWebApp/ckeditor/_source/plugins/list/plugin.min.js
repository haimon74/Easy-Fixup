(function(){function r(n,t){n.getCommand(this.name).setState(t)}function s(t){for(var f=t.data.path,o=f.blockLimit,u=f.elements,e,i=0;i<u.length&&(e=u[i])&&!e.equals(o);i++)if(n[u[i].getName()])return r.call(this,t.editor,this.type==u[i].getName()?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF);return r.call(this,t.editor,CKEDITOR.TRISTATE_OFF)}function c(n,t,i,r){for(var h=CKEDITOR.plugins.list.listToArray(t.root,i),o=[],f,c,l,e,s,a,u=0;u<t.contents.length;u++)(f=t.contents[u],f=f.getAscendant("li",!0),f&&!f.getCustomData("list_item_processed"))&&(o.push(f),CKEDITOR.dom.element.setMarker(i,f,"list_item_processed",!0));for(c=t.root.getDocument().createElement(this.type),u=0;u<o.length;u++)l=o[u].getCustomData("listarray_index"),h[l].parent=c;for(e=CKEDITOR.plugins.list.arrayToList(h,i,null,n.config.enterMode),a=e.listNode.getChildCount(),u=0;u<a&&(s=e.listNode.getChild(u));u++)s.getName()==this.type&&r.push(s);e.listNode.replace(t.root)}function l(n,t,i){var r=t.contents,l=t.root.getDocument(),f=[],s,e,u,h,a,v,o,y,c;for(r.length==1&&r[0].equals(t.root)&&(s=l.createElement("div"),r[0].moveChildren&&r[0].moveChildren(s),r[0].append(s),r[0]=s),e=t.contents[0].getParent(),u=0;u<r.length;u++)e=e.getCommonAncestor(r[u].getParent());for(u=0;u<r.length;u++)for(h=r[u];a=h.getParent();){if(a.equals(e)){f.push(h);break}h=a}if(!(f.length<1)){for(v=f[f.length-1].getNext(),o=l.createElement(this.type),i.push(o);f.length;)y=f.shift(),c=l.createElement("li"),y.moveChildren(c),y.remove(),c.appendTo(o),CKEDITOR.env.ie||c.appendBogus();v?o.insertBefore(v):o.appendTo(e)}}function a(n,t,i){function p(i){!(e=c[i?"getFirst":"getLast"]())||e.is&&e.isBlockBoundary()||!(l=t.root[i?"getPrevious":"getNext"](CKEDITOR.dom.walker.whitespaces(!0)))||l.is&&l.isBlockBoundary({br:1})||n.document.createElement("br")[i?"insertBefore":"insertAfter"](e)}for(var u=CKEDITOR.plugins.list.listToArray(t.root,i),o=[],f,s,h,a,v,y,c,e,l,r=0;r<t.contents.length;r++)(f=t.contents[r],f=f.getAscendant("li",!0),f&&!f.getCustomData("list_item_processed"))&&(o.push(f),CKEDITOR.dom.element.setMarker(i,f,"list_item_processed",!0));for(s=null,r=0;r<o.length;r++)h=o[r].getCustomData("listarray_index"),u[h].indent=-1,s=h;for(r=s+1;r<u.length;r++)if(u[r].indent>u[r-1].indent+1){for(a=u[r-1].indent+1-u[r].indent,v=u[r].indent;u[r]&&u[r].indent>=v;)u[r].indent+=a,r++;r--}y=CKEDITOR.plugins.list.arrayToList(u,i,null,n.config.enterMode),c=y.listNode,p(!0),p(),c.replace(t.root)}function u(n,t){this.name=n,this.type=t}function v(n,t){for(var r,u=n.children,f=u.length,i=0;i<f;i++)if(r=u[i],r.name&&r.name in t)return i;return f}function h(n){return function(i){var e=i.children,s=v(i,t.$list),h=e[s],r=h&&h.previous,o,u;r&&(r.name&&r.name=="br"||r.value&&(o=r.value.match(f)))&&(u=r,o&&o.index||u!=e[0]?u.name=="br"?e.splice(s-1,1):u.value=u.value.replace(f,""):e[0]=n||CKEDITOR.env.ie?new CKEDITOR.htmlParser.text("Â "):new CKEDITOR.htmlParser.element("br",{}))}}var n={ol:1,ul:1},t,f,e,i,o;CKEDITOR.plugins.list={listToArray:function(t,i,r,u,f){var h,l,o,e,c,a,s;if(!n[t.getName()])return[];for(u||(u=0),r||(r=[]),h=0,l=t.getChildCount();h<l;h++)if(o=t.getChild(h),o.$.nodeName.toLowerCase()=="li")for(e={parent:t,indent:u,contents:[]},f?e.grandparent=f:(e.grandparent=t.getParent(),e.grandparent&&e.grandparent.$.nodeName.toLowerCase()=="li"&&(e.grandparent=e.grandparent.getParent())),i&&CKEDITOR.dom.element.setMarker(i,o,"listarray_index",r.length),r.push(e),c=0,a=o.getChildCount();c<a;c++)s=o.getChild(c),s.type==CKEDITOR.NODE_ELEMENT&&n[s.getName()]?CKEDITOR.plugins.list.listToArray(s,i,r,u+1,e.grandparent):e.contents.push(s);return r},arrayToList:function(t,i,r,u){var o,s,y,p,w,b,l;if(r||(r=0),!t||t.length<r+1)return null;for(var h=t[r].parent.getDocument(),a=new CKEDITOR.dom.documentFragment(h),c=null,e=r,v=Math.max(t[r].indent,0),f=null,k=u==CKEDITOR.ENTER_P?"p":"div";;){if(o=t[e],o.indent==v){for(c&&t[e].parent.getName()==c.getName()||(c=t[e].parent.clone(!1,!0),a.append(c)),f=c.append(h.createElement("li")),s=0;s<o.contents.length;s++)f.append(o.contents[s].clone(!0,!0));e++}else if(o.indent==Math.max(v,0)+1)y=CKEDITOR.plugins.list.arrayToList(t,null,e,u),f.append(y.listNode),e=y.nextIndex;else if(o.indent==-1&&!r&&o.grandparent){for(f,f=n[o.grandparent.getName()]?h.createElement("li"):u!=CKEDITOR.ENTER_BR&&o.grandparent.getName()!="td"?h.createElement(k):new CKEDITOR.dom.documentFragment(h),s=0;s<o.contents.length;s++)f.append(o.contents[s].clone(!0,!0));f.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT&&e!=t.length-1&&(f.getLast()&&f.getLast().type==CKEDITOR.NODE_ELEMENT&&f.getLast().getAttribute("type")=="_moz"&&f.getLast().remove(),f.appendBogus()),f.type==CKEDITOR.NODE_ELEMENT&&f.getName()==k&&f.$.firstChild&&(f.trim(),p=f.getFirst(),p.type==CKEDITOR.NODE_ELEMENT&&p.isBlockBoundary()&&(w=new CKEDITOR.dom.documentFragment(h),f.moveChildren(w),f=w)),b=f.$.nodeName.toLowerCase(),CKEDITOR.env.ie||b!="div"&&b!="p"||f.appendBogus(),a.append(f),c=null,e++}else return null;if(t.length<=e||Math.max(t[e].indent,0)<v)break}if(i)for(l=a.getFirst();l;)l.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dom.element.clearMarkers(i,l),l=l.getNextSourceNode();return{listNode:a,nextIndex:e}}},u.prototype={exec:function(t){var b,o,f,k,tt,s,e,i,p,w,ht,ct;t.focus();var nt=t.document,v=t.getSelection(),u=v&&v.getRanges();if(u&&!(u.length<1)){this.state==CKEDITOR.TRISTATE_OFF&&(b=nt.getBody(),b.trim(),b.getFirst()?(f=u.length==1&&u[0],k=f&&f.getEnclosedNode(),k&&k.is&&this.type==k.getName()&&r.call(this,t,CKEDITOR.TRISTATE_ON)):(o=nt.createElement(t.config.enterMode==CKEDITOR.ENTER_P?"p":t.config.enterMode==CKEDITOR.ENTER_DIV?"div":"br"),o.appendTo(b),u=[new CKEDITOR.dom.range(nt)],o.is("br")?(u[0].setStartBefore(o),u[0].setEndAfter(o)):u[0].selectNodeContents(o),v.selectRanges(u)));for(var lt=v.createBookmarks(!0),d=[],y={};u.length>0;){f=u.shift();var g=f.getBoundaryNodes(),ut=g.startNode,ft=g.endNode;for(ut.type==CKEDITOR.NODE_ELEMENT&&ut.getName()=="td"&&f.setStartAt(g.startNode,CKEDITOR.POSITION_AFTER_START),ft.type==CKEDITOR.NODE_ELEMENT&&ft.getName()=="td"&&f.setEndAt(g.endNode,CKEDITOR.POSITION_BEFORE_END),tt=f.createIterator(),tt.forceBrBreak=this.state==CKEDITOR.TRISTATE_OFF;s=tt.getNextParagraph();){var et=new CKEDITOR.dom.elementPath(s),ot=et.elements,at=ot.length,it=null,st=!1,rt=et.blockLimit,h;for(e=at-1;e>=0&&(h=ot[e]);e--)if(n[h.getName()]&&rt.contains(h)){rt.removeCustomData("list_group_object"),i=h.getCustomData("list_group_object"),i?i.contents.push(s):(i={root:h,contents:[s]},d.push(i),CKEDITOR.dom.element.setMarker(y,h,"list_group_object",i)),st=!0;break}st||(p=rt,p.getCustomData("list_group_object")?p.getCustomData("list_group_object").contents.push(s):(i={root:p,contents:[s]},CKEDITOR.dom.element.setMarker(y,p,"list_group_object",i),d.push(i)))}}for(w=[];d.length>0;)i=d.shift(),this.state==CKEDITOR.TRISTATE_OFF?n[i.root.getName()]?c.call(this,t,i,y,w):l.call(this,t,i,w):this.state==CKEDITOR.TRISTATE_ON&&n[i.root.getName()]&&a.call(this,t,i,y);for(e=0;e<w.length;e++)it=w[e],ct=this,(ht=function(n){var t=it[n?"getPrevious":"getNext"](CKEDITOR.dom.walker.whitespaces(!0));t&&t.getName&&t.getName()==ct.type&&(t.remove(),t.moveChildren(it,n?!0:!1))})(),ht(!0);CKEDITOR.dom.element.clearAllMarkers(y),v.selectBookmarks(lt),t.focus()}}},t=CKEDITOR.dtd,f=/[\t\r\n ]*(?:&nbsp;|\xa0)$/,e={elements:{}};for(i in t.$listItem)e.elements[i]=h();o={elements:{}};for(i in t.$listItem)o.elements[i]=h(!0);CKEDITOR.plugins.add("list",{init:function(n){var t=new u("numberedlist","ol"),i=new u("bulletedlist","ul");n.addCommand("numberedlist",t),n.addCommand("bulletedlist",i),n.ui.addButton("NumberedList",{label:n.lang.numberedlist,command:"numberedlist"}),n.ui.addButton("BulletedList",{label:n.lang.bulletedlist,command:"bulletedlist"});n.on("selectionChange",CKEDITOR.tools.bind(s,t));n.on("selectionChange",CKEDITOR.tools.bind(s,i))},afterInit:function(n){var t=n.dataProcessor;t&&(t.dataFilter.addRules(e),t.htmlFilter.addRules(o))},requires:["domiterator"]})})();