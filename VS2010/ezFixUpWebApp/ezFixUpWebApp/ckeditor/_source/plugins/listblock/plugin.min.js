CKEDITOR.plugins.add("listblock",{requires:["panel"],onLoad:function(){CKEDITOR.ui.panel.prototype.addListBlock=function(n,t){return this.addBlock(n,new CKEDITOR.ui.listBlock(this.getHolderElement(),t))},CKEDITOR.ui.listBlock=CKEDITOR.tools.createClass({base:CKEDITOR.ui.panel.block,$:function(n,t){this.base(n),this.multiSelect=!!t;var i=this.keys;i[40]="next",i[9]="next",i[38]="prev",i[CKEDITOR.SHIFT+9]="prev",i[32]="click",this._.pendingHtml=[],this._.items={},this._.groups={}},_:{close:function(){this._.started&&(this._.pendingHtml.push("<\/ul>"),delete this._.started)},getClick:function(){return this._.click||(this._.click=CKEDITOR.tools.addFunction(function(n){var t=!0;if(this.multiSelect?t=this.toggle(n):this.mark(n),this.onClick)this.onClick(n,t)},this)),this._.click}},proto:{add:function(n,t,i){var r=this._.pendingHtml,u="cke_"+CKEDITOR.tools.getNextNumber();this._.started||(r.push("<ul class=cke_panel_list>"),this._.started=1),this._.items[n]=u,r.push("<li id=",u,' class=cke_panel_listItem><a _cke_focus=1 hidefocus=true title="',i||n,'" href="javascript:void(\'',n,'\')" onclick="CKEDITOR.tools.callFunction(',this._.getClick(),",'",n,"'); return false;\">",t||n,"<\/a><\/li>")},startGroup:function(n){this._.close();var t="cke_"+CKEDITOR.tools.getNextNumber();this._.groups[n]=t,this._.pendingHtml.push("<h1 id=",t," class=cke_panel_grouptitle>",n,"<\/h1>")},commit:function(){this._.close(),this.element.appendHtml(this._.pendingHtml.join("")),this._.pendingHtml=[]},toggle:function(n){var t=this.isMarked(n);return t?this.unmark(n):this.mark(n),!t},hideGroup:function(n){var t=this.element.getDocument().getById(this._.groups[n]),i=t&&t.getNext();t&&(t.setStyle("display","none"),i&&i.getName()=="ul"&&i.setStyle("display","none"))},hideItem:function(n){this.element.getDocument().getById(this._.items[n]).setStyle("display","none")},showAll:function(){var i=this._.items,r=this._.groups,u=this.element.getDocument(),f,e,t,n;for(f in i)u.getById(i[f]).setStyle("display","");for(e in r)t=u.getById(r[e]),n=t.getNext(),t.setStyle("display",""),n&&n.getName()=="ul"&&n.setStyle("display","")},mark:function(n){this.multiSelect||this.unmarkAll(),this.element.getDocument().getById(this._.items[n]).addClass("cke_selected")},unmark:function(n){this.element.getDocument().getById(this._.items[n]).removeClass("cke_selected")},unmarkAll:function(){var n=this._.items,i=this.element.getDocument(),t;for(t in n)i.getById(n[t]).removeClass("cke_selected")},isMarked:function(n){return this.element.getDocument().getById(this._.items[n]).hasClass("cke_selected")},focus:function(n){if(this._.focusIndex=-1,n){for(var t=this.element.getDocument().getById(this._.items[n]).getFirst(),u=this.element.getElementsByTag("a"),i,r=-1;i=u.getItem(++r);)if(i.equals(t)){this._.focusIndex=r;break}setTimeout(function(){t.focus()},0)}}}})}});