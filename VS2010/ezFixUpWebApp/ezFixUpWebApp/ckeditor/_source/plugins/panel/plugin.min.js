CKEDITOR.plugins.add("panel",{beforeInit:function(n){n.ui.addHandler(CKEDITOR.UI_PANEL,CKEDITOR.ui.panel.handler)}}),CKEDITOR.UI_PANEL=2,CKEDITOR.ui.panel=function(n,t){t&&CKEDITOR.tools.extend(this,t),CKEDITOR.tools.extend(this,{className:"",css:[]}),this.id=CKEDITOR.tools.getNextNumber(),this.document=n,this._={blocks:{}}},CKEDITOR.ui.panel.handler={create:function(n){return new CKEDITOR.ui.panel(n)}},CKEDITOR.ui.panel.prototype={renderHtml:function(n){var t=[];return this.render(n,t),t.join("")},render:function(n,t){var i="cke_"+this.id;return t.push('<div class="',n.skinClass,'" lang="',n.langCode,'" style="display:none;z-index:'+(n.config.baseFloatZIndex+1)+'"><div id=',i," dir=",n.lang.dir,' class="cke_panel cke_',n.lang.dir),this.className&&t.push(" ",this.className),t.push('">'),(this.forceIFrame||this.css.length)&&(t.push('<iframe id="',i,'_frame" frameborder="0" src="javascript:void('),t.push(CKEDITOR.env.isCustomDomain()?"(function(){document.open();document.domain='"+document.domain+"';document.close();})()":"0"),t.push(')"><\/iframe>')),t.push("<\/div><\/div>"),i},getHolderElement:function(){var t=this._.holder,e,o;if(!t){if(this.forceIFrame||this.css.length){var r=this.document.getById("cke_"+this.id+"_frame"),i=r.getParent(),u=i.getAttribute("dir"),f=i.getParent().getAttribute("class"),s=i.getParent().getAttribute("lang"),n=r.getFrameDocument();n.$.open(),CKEDITOR.env.isCustomDomain()&&(n.$.domain=document.domain),e=CKEDITOR.tools.addFunction(CKEDITOR.tools.bind(function(){this.isLoaded=!0,this.onLoad&&this.onLoad()},this)),n.$.write('<!DOCTYPE html><html dir="'+u+'" class="'+f+'_container" lang="'+s+'"><head><style>.'+f+'_container{visibility:hidden}<\/style><\/head><body class="cke_'+u+" cke_panel_frame "+CKEDITOR.env.cssClass+'" style="margin:0;padding:0" onload="( window.CKEDITOR || window.parent.CKEDITOR ).tools.callFunction('+e+');"><\/body>'+CKEDITOR.tools.buildStyleHtml(this.css)+"<\/html>"),n.$.close(),o=n.getWindow(),o.$.CKEDITOR=CKEDITOR;n.on("keydown",function(n){var t=n.data.getKeystroke();if(this._.onKeyDown&&this._.onKeyDown(t)===!1){n.data.preventDefault();return}t==27&&this.onEscape&&this.onEscape()},this);t=n.getBody()}else t=this.document.getById("cke_"+this.id);this._.holder=t}return t},addBlock:function(n,t){return t=this._.blocks[n]=t||new CKEDITOR.ui.panel.block(this.getHolderElement()),this._.currentBlock||this.showBlock(n),t},getBlock:function(n){return this._.blocks[n]},showBlock:function(n){var r=this._.blocks,t=r[n],i=this._.currentBlock;return i&&i.hide(),this._.currentBlock=t,t._.focusIndex=-1,this._.onKeyDown=t.onKeyDown&&CKEDITOR.tools.bind(t.onKeyDown,t),t.show(),t},destroy:function(){this.element&&this.element.remove()}},CKEDITOR.ui.panel.block=CKEDITOR.tools.createClass({$:function(n){this.element=n.append(n.getDocument().createElement("div",{attributes:{"class":"cke_panel_block"},styles:{display:"none"}})),this.keys={},this._.focusIndex=-1,this.element.disableContextMenu()},_:{},proto:{show:function(){this.element.setStyle("display","")},hide:function(){this.onHide&&this.onHide.call(this)===!0||this.element.setStyle("display","none")},onKeyDown:function(n){var u=this.keys[n],i,r,t;switch(u){case"next":for(i=this._.focusIndex,r=this.element.getElementsByTag("a");t=r.getItem(++i);)if(t.getAttribute("_cke_focus")&&t.$.offsetWidth){this._.focusIndex=i,t.focus();break}return!1;case"prev":for(i=this._.focusIndex,r=this.element.getElementsByTag("a");i>0&&(t=r.getItem(--i));)if(t.getAttribute("_cke_focus")&&t.$.offsetWidth){this._.focusIndex=i,t.focus();break}return!1;case"click":return i=this._.focusIndex,(t=i>=0&&this.element.getElementsByTag("a").getItem(i))&&(t.$.click?t.$.click():t.$.onclick()),!1}return!0}}});