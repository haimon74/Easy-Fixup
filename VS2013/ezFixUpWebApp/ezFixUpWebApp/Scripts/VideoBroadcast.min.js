var newEventsTimer,fetchNewEventsLock=false;function KeyHandler(a){if(window.event)keynum=a.keyCode;else if(a.which)keynum=a.which;if(keynum==13){SendMessage();a.returnValue=false;a.cancel=true;return false}}function FetchNewEventsForVideoBroadcast(){if(fetchNewEventsLock)return;var b=$get("hidVideoGuid"),a=$get("hidCurrentUser");fetchNewEventsLock=true;ezFixUp.Services.OnlineCheck.FetchNewEventsForVideoBroadcast(b.value,a.value,OnFetchNewEventsSucceeded,OnFetchNewEventsFailed)}function OnFetchNewEventsFailed(){fetchNewEventsLock=false}function OnFetchNewEventsSucceeded(a){try{if(a){$get("userswatching").innerHTML=a.UsersWatchingString;if(!a.IsBroadcastAlive){if($get("tblVideoBroadcast")!=null)$get("tblVideoBroadcast").style.display="none";if($get("divBroadcastEndMessage")!=null)$get("divBroadcastEndMessage").style.display="";newEventsTimer&&window.clearInterval(newEventsTimer);return}if(a.Messages){var b=$get("videomessages"),c="",d,e=$get("hidViewedUser")==null?$get("hidCurrentUser").value:$get("hidViewedUser").value;for(i=0;i<a.Messages.length;i++){isBroadcaster=a.Messages[i].Username==e;if(isBroadcaster)d=a.Messages[i].Username;else d='<a href="'+a.Messages[i].ProfileURL+'" target="_blank" class="user-name" onmouseover="showUserPreview(\''+a.Messages[i].Username+'\')" onmouseout="hideUserPreview()">'+a.Messages[i].Username+"</a>";c=c+(isBroadcaster?"<b>":"")+"<nobr>["+a.Messages[i].TimestampString+"]&nbsp;"+d+":</nobr>&nbsp;"+a.Messages[i].Message+(isBroadcaster?"</b>":"")+'<div class="clear"></div>'}if(c!=""){b.innerHTML=c;b.scrollTop=b.scrollHeight;b.scrollTop=b.scrollHeight}}}}finally{fetchNewEventsLock=false}}function SendMessage(){var a=$get("txtSendMessage"),c=$get("hidVideoGuid"),b=$get("hidCurrentUser");if(a.value=="")return;ezFixUp.Services.OnlineCheck.SendMessageForVideoBroadcast(c.value,a.value,b.value,OnSendMessageForVideoBroadcastSucceeded,OnSendMessageForVideoBroadcastFailed);a.value=""}function OnSendMessageForVideoBroadcastSucceeded(){}function OnSendMessageForVideoBroadcastFailed(a){alert(a.get_message())};