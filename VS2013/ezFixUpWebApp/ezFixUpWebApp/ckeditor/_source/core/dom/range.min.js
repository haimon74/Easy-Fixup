CKEDITOR.dom.range=function(n){this.startContainer=null,this.startOffset=null,this.endContainer=null,this.endOffset=null,this.collapsed=!0,this.document=n},function(){function i(n){var t=!1,i=CKEDITOR.dom.walker.bookmark(!0);return function(r){if(i(r))return!0;if(r.type==CKEDITOR.NODE_TEXT){if(CKEDITOR.tools.trim(r.getText()).length)return!1}else if(r.type==CKEDITOR.NODE_ELEMENT&&!u[r.getName()]){if(n||CKEDITOR.env.ie||r.getName()!="br"||t)return!1;t=!0}return!0}}function f(n){return n.type!=CKEDITOR.NODE_TEXT&&n.getName()in CKEDITOR.dtd.$removeEmpty||!CKEDITOR.tools.trim(n.getText())||n.getParent().hasAttribute("_fck_bookmark")}function r(n){return!e(n)&&!o(n)}var n=function(n){n.collapsed=n.startContainer&&n.endContainer&&n.startContainer.equals(n.endContainer)&&n.startOffset==n.endOffset},t=function(n,t,i){var s,y,h,k,c,e,o,d,r,g,p,l,v,a,tt;n.optimizeBookmark();var u=n.startContainer,f=n.endContainer,w=n.startOffset,nt=n.endOffset,b,it;for(f.type==CKEDITOR.NODE_TEXT?f=f.split(nt):f.getChildCount()>0&&(nt>=f.getChildCount()?(f=f.append(n.document.createText("")),it=!0):f=f.getChild(nt)),u.type==CKEDITOR.NODE_TEXT?(u.split(w),u.equals(f)&&(f=u.getNext())):w?w>=u.getChildCount()?(u=u.append(n.document.createText("")),b=!0):u=u.getChild(w).getPrevious():(u=u.getFirst().insertBeforeMe(n.document.createText("")),b=!0),s=u.getParents(),y=f.getParents(),h=0;h<s.length;h++)if(k=s[h],c=y[h],!k.equals(c))break;for(e=i,p=h;p<s.length;p++){for(o=s[p],e&&!o.equals(u)&&(d=e.append(o.clone())),r=o.getNext();r;){if(r.equals(y[p])||r.equals(f))break;g=r.getNext(),t==2?e.append(r.clone(!0)):(r.remove(),t==1&&e.append(r)),r=g}e&&(e=d)}for(e=i,l=h;l<y.length;l++){if(o=y[l],t>0&&!o.equals(f)&&(d=e.append(o.clone())),!s[l]||o.$.parentNode!=s[l].$.parentNode)for(r=o.getPrevious();r;){if(r.equals(s[l])||r.equals(u))break;g=r.getPrevious(),t==2?e.$.insertBefore(r.$.cloneNode(!0),e.$.firstChild):(r.remove(),t==1&&e.$.insertBefore(r.$,e.$.firstChild)),r=g}e&&(e=d)}t==2?(v=n.startContainer,v.type==CKEDITOR.NODE_TEXT&&(v.$.data+=v.$.nextSibling.data,v.$.parentNode.removeChild(v.$.nextSibling)),a=n.endContainer,a.type==CKEDITOR.NODE_TEXT&&a.$.nextSibling&&(a.$.data+=a.$.nextSibling.data,a.$.parentNode.removeChild(a.$.nextSibling))):(k&&c&&(u.$.parentNode!=k.$.parentNode||f.$.parentNode!=c.$.parentNode)&&(tt=c.getIndex(),b&&c.$.parentNode==u.$.parentNode&&tt--,n.setStart(c.getParent(),tt)),n.collapse(!0)),b&&u.remove(),it&&f.$.parentNode&&f.remove()},u={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},e=new CKEDITOR.dom.walker.whitespaces,o=new CKEDITOR.dom.walker.bookmark;CKEDITOR.dom.range.prototype={clone:function(){var n=new CKEDITOR.dom.range(this.document);return n.startContainer=this.startContainer,n.startOffset=this.startOffset,n.endContainer=this.endContainer,n.endOffset=this.endOffset,n.collapsed=this.collapsed,n},collapse:function(n){n?(this.endContainer=this.startContainer,this.endOffset=this.startOffset):(this.startContainer=this.endContainer,this.startOffset=this.endOffset),this.collapsed=!0},cloneContents:function(){var n=new CKEDITOR.dom.documentFragment(this.document);return this.collapsed||t(this,2,n),n},deleteContents:function(){this.collapsed||t(this,0)},extractContents:function(){var n=new CKEDITOR.dom.documentFragment(this.document);return this.collapsed||t(this,1,n),n},createBookmark:function(n){var t,i,u,r;return t=this.document.createElement("span"),t.setAttribute("_fck_bookmark",1),t.setStyle("display","none"),t.setHtml("&nbsp;"),n&&(u="cke_bm_"+CKEDITOR.tools.getNextNumber(),t.setAttribute("id",u+"S")),this.collapsed||(i=t.clone(),i.setHtml("&nbsp;"),n&&i.setAttribute("id",u+"E"),r=this.clone(),r.collapse(),r.insertNode(i)),r=this.clone(),r.collapse(!0),r.insertNode(t),i?(this.setStartAfter(t),this.setEndBefore(i)):this.moveToPosition(t,CKEDITOR.POSITION_AFTER_END),{startNode:n?u+"S":t,endNode:n?u+"E":i,serializable:n}},createBookmark2:function(n){var i=this.startContainer,r=this.endContainer,f=this.startOffset,e=this.endOffset,t,u;if(!i||!r)return{start:0,end:0};if(n){for(i.type==CKEDITOR.NODE_ELEMENT&&(t=i.getChild(f),t&&t.type==CKEDITOR.NODE_TEXT&&f>0&&t.getPrevious().type==CKEDITOR.NODE_TEXT&&(i=t,f=0));i.type==CKEDITOR.NODE_TEXT&&(u=i.getPrevious())&&u.type==CKEDITOR.NODE_TEXT;)i=u,f+=u.getLength();if(!this.isCollapsed)for(r.type==CKEDITOR.NODE_ELEMENT&&(t=r.getChild(e),t&&t.type==CKEDITOR.NODE_TEXT&&e>0&&t.getPrevious().type==CKEDITOR.NODE_TEXT&&(r=t,e=0));r.type==CKEDITOR.NODE_TEXT&&(u=r.getPrevious())&&u.type==CKEDITOR.NODE_TEXT;)r=u,e+=u.getLength()}return{start:i.getAddress(n),end:this.isCollapsed?null:r.getAddress(n),startOffset:f,endOffset:e,normalized:n,is2:!0}},moveToBookmark:function(n){if(n.is2){var f=this.document.getByAddress(n.start,n.normalized),e=n.startOffset,i=n.end&&this.document.getByAddress(n.end,n.normalized),o=n.endOffset;this.setStart(f,e),i?this.setEnd(i,o):this.collapse(!0)}else{var r=n.serializable,u=r?this.document.getById(n.startNode):n.startNode,t=r?this.document.getById(n.endNode):n.endNode;this.setStartBefore(u),u.remove(),t?(this.setEndBefore(t),t.remove()):this.collapse(!0)}},getBoundaryNodes:function(){var n=this.startContainer,t=this.endContainer,r=this.startOffset,u=this.endOffset,i;if(n.type==CKEDITOR.NODE_ELEMENT)if(i=n.getChildCount(),i>r)n=n.getChild(r);else if(i<1)n=n.getPreviousSourceNode();else{for(n=n.$;n.lastChild;)n=n.lastChild;n=new CKEDITOR.dom.node(n),n=n.getNextSourceNode()||n}if(t.type==CKEDITOR.NODE_ELEMENT)if(i=t.getChildCount(),i>u)t=t.getChild(u).getPreviousSourceNode(!0);else if(i<1)t=t.getPreviousSourceNode();else{for(t=t.$;t.lastChild;)t=t.lastChild;t=new CKEDITOR.dom.node(t)}return n.getPosition(t)&CKEDITOR.POSITION_FOLLOWING&&(n=t),{startNode:n,endNode:t}},getCommonAncestor:function(n,t){var i=this.startContainer,u=this.endContainer,r;return r=i.equals(u)?n&&i.type==CKEDITOR.NODE_ELEMENT&&this.startOffset==this.endOffset-1?i.getChild(this.startOffset):i:i.getCommonAncestor(u),t&&!r.is?r.getParent():r},optimize:function(){var n=this.startContainer,t=this.startOffset;n.type!=CKEDITOR.NODE_ELEMENT&&(t?t>=n.getLength()&&this.setStartAfter(n):this.setStartBefore(n)),n=this.endContainer,t=this.endOffset,n.type!=CKEDITOR.NODE_ELEMENT&&(t?t>=n.getLength()&&this.setEndAfter(n):this.setEndBefore(n))},optimizeBookmark:function(){var t=this.startContainer,n=this.endContainer;t.is&&t.is("span")&&t.hasAttribute("_fck_bookmark")&&this.setStartAt(t,CKEDITOR.POSITION_BEFORE_START),n&&n.is&&n.is("span")&&n.hasAttribute("_fck_bookmark")&&this.setEndAt(n,CKEDITOR.POSITION_AFTER_END)},trim:function(n,t){var r=this.startContainer,f=this.startOffset,e=this.collapsed,o,i,u;(!n||e)&&r&&r.type==CKEDITOR.NODE_TEXT&&(f?f>=r.getLength()?(f=r.getIndex()+1,r=r.getParent()):(o=r.split(f),f=r.getIndex()+1,r=r.getParent(),!e&&this.startContainer.equals(this.endContainer)&&this.setEnd(o,this.endOffset-this.startOffset)):(f=r.getIndex(),r=r.getParent()),this.setStart(r,f),e&&this.collapse(!0)),i=this.endContainer,u=this.endOffset,t||e||!i||i.type!=CKEDITOR.NODE_TEXT||(u?u>=i.getLength()?(u=i.getIndex()+1,i=i.getParent()):(i.split(u),u=i.getIndex()+1,i=i.getParent()):(u=i.getIndex(),i=i.getParent()),this.setEnd(i,u))},enlarge:function(n){var b,k,d,a,h;switch(n){case CKEDITOR.ENLARGE_ELEMENT:if(this.collapsed)return;var v=this.getCommonAncestor(),c=this.document.getBody(),y,p,i,t,o,u=!1,s,f,r=this.startContainer,l=this.startOffset;for(r.type==CKEDITOR.NODE_TEXT?(l&&(r=!CKEDITOR.tools.trim(r.substring(0,l)).length&&r,u=!!r),r&&((t=r.getPrevious())||(i=r.getParent()))):(l&&(t=r.getChild(l-1)||r.getLast()),t||(i=r));i||t;){if(i&&!t){if(!o&&i.equals(v)&&(o=!0),!c.contains(i))break;u&&i.getComputedStyle("display")=="inline"||(u=!1,o?y=i:this.setStartBefore(i)),t=i.getPrevious()}while(t){if(s=!1,t.type==CKEDITOR.NODE_TEXT)f=t.getText(),/[^\s\ufeff]/.test(f)&&(t=null),s=/[\s\ufeff]$/.test(f);else if(t.$.offsetWidth>0&&!t.getAttribute("_fck_bookmark"))if(u&&CKEDITOR.dtd.$removeEmpty[t.getName()]){if(f=t.getText(),/[^\s\ufeff]/.test(f)){for(b=t.$.all||t.$.getElementsByTagName("*"),k=0;d=b[k++];)if(!CKEDITOR.dtd.$removeEmpty[d.nodeName.toLowerCase()]){t=null;break}}else t=null;t&&(s=!!f.length)}else t=null;if(s&&(u?o?y=i:i&&this.setStartBefore(i):u=!0),t){if(a=t.getPrevious(),!i&&!a){i=t,t=null;break}t=a}else i=null}i&&(i=i.getParent())}for(r=this.endContainer,l=this.endOffset,i=t=null,o=u=!1,r.type==CKEDITOR.NODE_TEXT?(r=!CKEDITOR.tools.trim(r.substring(l)).length&&r,u=!(r&&r.getLength()),r&&((t=r.getNext())||(i=r.getParent()))):(t=r.getChild(l),t||(i=r));i||t;){if(i&&!t){if(!o&&i.equals(v)&&(o=!0),!c.contains(i))break;u&&i.getComputedStyle("display")=="inline"||(u=!1,o?p=i:i&&this.setEndAfter(i)),t=i.getNext()}while(t){if(s=!1,t.type==CKEDITOR.NODE_TEXT)f=t.getText(),/[^\s\ufeff]/.test(f)&&(t=null),s=/^[\s\ufeff]/.test(f);else if(t.$.offsetWidth>0&&!t.getAttribute("_fck_bookmark"))if(u&&CKEDITOR.dtd.$removeEmpty[t.getName()]){if(f=t.getText(),/[^\s\ufeff]/.test(f)){for(b=t.$.all||t.$.getElementsByTagName("*"),k=0;d=b[k++];)if(!CKEDITOR.dtd.$removeEmpty[d.nodeName.toLowerCase()]){t=null;break}}else t=null;t&&(s=!!f.length)}else t=null;if(s&&u&&(o?p=i:this.setEndAfter(i)),t){if(a=t.getNext(),!i&&!a){i=t,t=null;break}t=a}else i=null}i&&(i=i.getParent())}y&&p&&(v=y.contains(p)?p:y,this.setStartBefore(v),this.setEndAfter(v));break;case CKEDITOR.ENLARGE_BLOCK_CONTENTS:case CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS:h=new CKEDITOR.dom.range(this.document),c=this.document.getBody(),h.setStartAt(c,CKEDITOR.POSITION_AFTER_START),h.setEnd(this.startContainer,this.startOffset);var w=new CKEDITOR.dom.walker(h),e,g,tt=CKEDITOR.dom.walker.blockBoundary(n==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:null),nt=function(n){var t=tt(n);return t||(e=n),t},it=function(n){var t=nt(n);return!t&&n.is&&n.is("br")&&(g=n),t};w.guard=nt,i=w.lastBackward(),e=e||c,this.setStartAt(e,!e.is("br")&&(!i&&this.checkStartOfBlock()||i&&e.contains(i))?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_AFTER_END),h=this.clone(),h.collapse(),h.setEndAt(c,CKEDITOR.POSITION_BEFORE_END),w=new CKEDITOR.dom.walker(h),w.guard=n==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS?it:nt,e=null,i=w.lastForward(),e=e||c,this.setEndAt(e,!i&&this.checkEndOfBlock()||i&&e.contains(i)?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_BEFORE_START),g&&this.setEndAfter(g)}},insertNode:function(n){this.optimizeBookmark(),this.trim(!1,!0);var t=this.startContainer,r=this.startOffset,i=t.getChild(r);i?n.insertBefore(i):t.append(n),n.getParent().equals(this.endContainer)&&this.endOffset++,this.setStartBefore(n)},moveToPosition:function(n,t){this.setStartAt(n,t),this.collapse(!0)},selectNodeContents:function(n){this.setStart(n,0),this.setEnd(n,n.type==CKEDITOR.NODE_TEXT?n.getLength():n.getChildCount())},setStart:function(t,i){this.startContainer=t,this.startOffset=i,this.endContainer||(this.endContainer=t,this.endOffset=i),n(this)},setEnd:function(t,i){this.endContainer=t,this.endOffset=i,this.startContainer||(this.startContainer=t,this.startOffset=i),n(this)},setStartAfter:function(n){this.setStart(n.getParent(),n.getIndex()+1)},setStartBefore:function(n){this.setStart(n.getParent(),n.getIndex())},setEndAfter:function(n){this.setEnd(n.getParent(),n.getIndex()+1)},setEndBefore:function(n){this.setEnd(n.getParent(),n.getIndex())},setStartAt:function(t,i){switch(i){case CKEDITOR.POSITION_AFTER_START:this.setStart(t,0);break;case CKEDITOR.POSITION_BEFORE_END:t.type==CKEDITOR.NODE_TEXT?this.setStart(t,t.getLength()):this.setStart(t,t.getChildCount());break;case CKEDITOR.POSITION_BEFORE_START:this.setStartBefore(t);break;case CKEDITOR.POSITION_AFTER_END:this.setStartAfter(t)}n(this)},setEndAt:function(t,i){switch(i){case CKEDITOR.POSITION_AFTER_START:this.setEnd(t,0);break;case CKEDITOR.POSITION_BEFORE_END:t.type==CKEDITOR.NODE_TEXT?this.setEnd(t,t.getLength()):this.setEnd(t,t.getChildCount());break;case CKEDITOR.POSITION_BEFORE_START:this.setEndBefore(t);break;case CKEDITOR.POSITION_AFTER_END:this.setEndAfter(t)}n(this)},fixBlock:function(n,t){var r=this.createBookmark(),i=this.document.createElement(t);return this.collapse(n),this.enlarge(CKEDITOR.ENLARGE_BLOCK_CONTENTS),this.extractContents().appendTo(i),i.trim(),CKEDITOR.env.ie||i.appendBogus(),this.insertNode(i),this.moveToBookmark(r),i},splitBlock:function(n){var e=new CKEDITOR.dom.elementPath(this.startContainer),o=new CKEDITOR.dom.elementPath(this.endContainer),s=e.blockLimit,h=o.blockLimit,t=e.block,i=o.block,r=null,u,f;return s.equals(h)?(n!="br"&&(t||(t=this.fixBlock(!0,n),i=new CKEDITOR.dom.elementPath(this.endContainer).block),i||(i=this.fixBlock(!1,n))),u=t&&this.checkStartOfBlock(),f=i&&this.checkEndOfBlock(),this.deleteContents(),t&&t.equals(i)&&(f?(r=new CKEDITOR.dom.elementPath(this.startContainer),this.moveToPosition(i,CKEDITOR.POSITION_AFTER_END),i=null):u?(r=new CKEDITOR.dom.elementPath(this.startContainer),this.moveToPosition(t,CKEDITOR.POSITION_BEFORE_START),t=null):(i=this.splitElement(t),CKEDITOR.env.ie||t.is("ul","ol")||t.appendBogus())),{previousBlock:t,nextBlock:i,wasStartOfBlock:u,wasEndOfBlock:f,elementPath:r}):null},splitElement:function(n){if(!this.collapsed)return null;this.setEndAt(n,CKEDITOR.POSITION_BEFORE_END);var i=this.extractContents(),t=n.clone(!1);return i.appendTo(t),t.insertAfter(n),this.moveToPosition(n,CKEDITOR.POSITION_AFTER_END),t},checkBoundaryOfElement:function(n,t){var r=this.clone(),i,u;return r[t==CKEDITOR.START?"setStartAt":"setEndAt"](n,t==CKEDITOR.START?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_END),i=new CKEDITOR.dom.walker(r),u=!1,i.evaluator=f,i[t==CKEDITOR.START?"checkBackward":"checkForward"]()},checkStartOfBlock:function(){var u=this.startContainer,f=this.startOffset,e,t,n,r;return f&&u.type==CKEDITOR.NODE_TEXT&&(e=CKEDITOR.tools.ltrim(u.substring(0,f)),e.length)?!1:(this.trim(),t=new CKEDITOR.dom.elementPath(this.startContainer),n=this.clone(),n.collapse(!0),n.setStartAt(t.block||t.blockLimit,CKEDITOR.POSITION_AFTER_START),r=new CKEDITOR.dom.walker(n),r.evaluator=i(!0),r.checkBackward())},checkEndOfBlock:function(){var u=this.endContainer,e=this.endOffset,f,t,n,r;return u.type==CKEDITOR.NODE_TEXT&&(f=CKEDITOR.tools.rtrim(u.substring(e)),f.length)?!1:(this.trim(),t=new CKEDITOR.dom.elementPath(this.endContainer),n=this.clone(),n.collapse(!1),n.setEndAt(t.block||t.blockLimit,CKEDITOR.POSITION_BEFORE_END),r=new CKEDITOR.dom.walker(n),r.evaluator=i(!1),r.checkForward())},moveToElementEditablePosition:function(n,t){for(var i;n&&n.type==CKEDITOR.NODE_ELEMENT;){if(i=n.isEditable(),i)this.moveToPosition(n,t?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_AFTER_START);else if(CKEDITOR.dtd.$inline[n.getName()])return this.moveToPosition(n,t?CKEDITOR.POSITION_AFTER_END:CKEDITOR.POSITION_BEFORE_START),!0;if(n=CKEDITOR.dtd.$empty[n.getName()]?n[t?"getPrevious":"getNext"](r):n[t?"getLast":"getFirst"](r),n&&n.type==CKEDITOR.NODE_TEXT)return this.moveToPosition(n,t?CKEDITOR.POSITION_AFTER_END:CKEDITOR.POSITION_BEFORE_START),!0}return i},moveToElementEditStart:function(n){return this.moveToElementEditablePosition(n)},moveToElementEditEnd:function(n){return this.moveToElementEditablePosition(n,!0)},getEnclosedNode:function(){var i=this.clone(),t=new CKEDITOR.dom.walker(i),r=CKEDITOR.dom.walker.bookmark(!0),u=CKEDITOR.dom.walker.whitespaces(!0),f=function(n){return u(n)&&r(n)},n;return i.evaluator=f,n=t.next(),t.reset(),n&&n.equals(t.previous())?n:null},getTouchedStartNode:function(){var n=this.startContainer;return this.collapsed||n.type!=CKEDITOR.NODE_ELEMENT?n:n.getChild(this.startOffset)||n},getTouchedEndNode:function(){var n=this.endContainer;return this.collapsed||n.type!=CKEDITOR.NODE_ELEMENT?n:n.getChild(this.endOffset-1)||n}}}(),CKEDITOR.POSITION_AFTER_START=1,CKEDITOR.POSITION_BEFORE_END=2,CKEDITOR.POSITION_BEFORE_START=3,CKEDITOR.POSITION_AFTER_END=4,CKEDITOR.ENLARGE_ELEMENT=1,CKEDITOR.ENLARGE_BLOCK_CONTENTS=2,CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS=3,CKEDITOR.START=1,CKEDITOR.END=2,CKEDITOR.STARTEND=3;