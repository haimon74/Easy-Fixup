CKEDITOR.plugins.add("domiterator"),function(){function n(n){arguments.length<1||(this.range=n,this.forceBrBreak=!1,this.enlargeBr=!0,this.enforceRealBlocks=!1,this._||(this._={}))}var i=/^[\r\n\t ]+$/,t=CKEDITOR.dom.walker.bookmark();n.prototype={getNextParagraph:function(n){var f,r,o,k,d,l,g,e,y,nt,ut,u,p,w,b,v,tt,et,it,h,rt,c;for(this._.lastNode||(r=this.range.clone(),r.enlarge(this.forceBrBreak||!this.enlargeBr?CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS:CKEDITOR.ENLARGE_BLOCK_CONTENTS),l=new CKEDITOR.dom.walker(r),g=CKEDITOR.dom.walker.bookmark(!0,!0),l.evaluator=g,this._.nextNode=l.next(),l=new CKEDITOR.dom.walker(r),l.evaluator=g,e=l.previous(),this._.lastNode=e.getNextSourceNode(!0),this._.lastNode&&this._.lastNode.type==CKEDITOR.NODE_TEXT&&!CKEDITOR.tools.trim(this._.lastNode.getText())&&this._.lastNode.getParent().isBlockBoundary()&&(y=new CKEDITOR.dom.range(r.document),y.moveToPosition(this._.lastNode,CKEDITOR.POSITION_AFTER_END),y.checkEndOfBlock()&&(nt=new CKEDITOR.dom.elementPath(y.endContainer),ut=nt.block||nt.blockLimit,this._.lastNode=ut.getNextSourceNode(!0))),this._.lastNode||(this._.lastNode=this._.docEndMarker=r.document.createText(""),this._.lastNode.insertAfter(e)),r=null),u=this._.nextNode,e=this._.lastNode,this._.nextNode=null;u;){var a=!1,s=u.type!=CKEDITOR.NODE_ELEMENT,ft=!1;if(s)u.type==CKEDITOR.NODE_TEXT&&i.test(u.getText())&&(s=!1);else if(p=u.getName(),u.isBlockBoundary(this.forceBrBreak&&{br:1})){if(p=="br")s=!0;else if(!r&&!u.getChildCount()&&p!="hr"){f=u,o=u.equals(e);break}r&&(r.setEndAt(u,CKEDITOR.POSITION_BEFORE_START),p!="br"&&(this._.nextNode=u)),a=!0}else{if(u.getFirst()){r||(r=new CKEDITOR.dom.range(this.range.document),r.setStartAt(u,CKEDITOR.POSITION_BEFORE_START)),u=u.getFirst();continue}s=!0}if(s&&!r&&(r=new CKEDITOR.dom.range(this.range.document),r.setStartAt(u,CKEDITOR.POSITION_BEFORE_START)),o=(!a||s)&&u.equals(e),r&&!a)while(!u.getNext()&&!o){if(w=u.getParent(),w.isBlockBoundary(this.forceBrBreak&&{br:1})){a=!0,o=o||w.equals(e);break}u=w,s=!0,o=u.equals(e),ft=!0}if(s&&r.setEndAt(u,CKEDITOR.POSITION_AFTER_END),u=u.getNextSourceNode(ft,null,e),o=!u,(a||o)&&r)if(b=r.getBoundaryNodes(),v=new CKEDITOR.dom.elementPath(r.startContainer),b.startNode.getParent().equals(v.blockLimit)&&t(b.startNode)&&t(b.endNode))r=null,this._.nextNode=null;else break;if(o)break}if(!f){if(!r)return this._.docEndMarker&&this._.docEndMarker.remove(),this._.nextNode=null,null;v=new CKEDITOR.dom.elementPath(r.startContainer),tt=v.blockLimit,et={div:1,th:1,td:1},f=v.block,!f&&!this.enforceRealBlocks&&et[tt.getName()]&&r.checkStartOfBlock()&&r.checkEndOfBlock()?f=tt:!f||this.enforceRealBlocks&&f.getName()=="li"?(f=this.range.document.createElement(n||"p"),r.extractContents().appendTo(f),f.trim(),r.insertNode(f),k=d=!0):f.getName()!="li"?r.checkStartOfBlock()&&r.checkEndOfBlock()||(f=f.clone(!1),r.extractContents().appendTo(f),f.trim(),it=r.splitBlock(),k=!it.wasStartOfBlock,d=!it.wasEndOfBlock,r.insertNode(f)):o||(this._.nextNode=f.equals(e)?null:r.getBoundaryNodes().endNode.getNextSourceNode(!0,null,e))}return k&&(h=f.getPrevious(),h&&h.type==CKEDITOR.NODE_ELEMENT&&(h.getName()=="br"?h.remove():h.getLast()&&h.getLast().$.nodeName.toLowerCase()=="br"&&h.getLast().remove())),d&&(rt=CKEDITOR.dom.walker.bookmark(!1,!0),c=f.getLast(),c&&c.type==CKEDITOR.NODE_ELEMENT&&c.getName()=="br"&&(CKEDITOR.env.ie||c.getPrevious(rt)||c.getNext(rt))&&c.remove()),this._.nextNode||(this._.nextNode=o||f.equals(e)?null:f.getNextSourceNode(!0,null,e)),f}},CKEDITOR.dom.range.prototype.createIterator=function(){return new n(this)}}();