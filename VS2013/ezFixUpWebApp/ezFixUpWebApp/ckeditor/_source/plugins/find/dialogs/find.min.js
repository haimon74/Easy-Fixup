(function(){function u(n){return n.type==CKEDITOR.NODE_TEXT&&n.getLength()>0}function f(n){var t=CKEDITOR.dtd;return n.isBlockBoundary(CKEDITOR.tools.extend({},t.$empty,t.$nonEditable))}function e(n){var u,f,e,o,r,s;for(u=n==="find"?1:0,f=1-u,s=t.length,r=0;r<s;r++)e=this.getContentElement(i[u],t[r][u]),o=this.getContentElement(i[f],t[r][f]),o.setValue(e.getValue())}var n=function(){return{textNode:this.textNode,offset:this.offset,character:this.textNode?this.textNode.getText().charAt(this.offset):null,hitMatchBoundary:this._.matchBoundary}},i=["find","replace"],t=[["txtFindFind","txtFindReplace"],["txtFindCaseChk","txtReplaceCaseChk"],["txtFindWordChk","txtReplaceWordChk"],["txtFindCyclic","txtReplaceCyclic"]],r=function(t,i){function a(n,i){var r=new CKEDITOR.dom.range;return r.setStart(n.textNode,i?n.offset:n.offset+1),r.setEndAt(t.document.getBody(),CKEDITOR.POSITION_BEFORE_END),r}function w(n){var i=new CKEDITOR.dom.range;return i.setStartAt(t.document.getBody(),CKEDITOR.POSITION_AFTER_START),i.setEnd(n.textNode,n.offset),i}function c(n){var i,r=t.getSelection(),u=t.document.getBody();return r&&!n?(i=r.getRanges()[0].clone(),i.collapse(!0)):(i=new CKEDITOR.dom.range,i.setStartAt(u,CKEDITOR.POSITION_AFTER_START)),i.setEndAt(u,CKEDITOR.POSITION_BEFORE_END),i}var l=new CKEDITOR.style(t.config.find_highlight),o=function(n,t){var i=new CKEDITOR.dom.walker(n);i[t?"guard":"evaluator"]=u,i.breakOnFalse=!0,this._={matchWord:t,walker:i,matchBoundary:!1}},s;o.prototype={next:function(){return this.move()},back:function(){return this.move(!0)},move:function(t){var i=this.textNode;if(i===null)return n.call(this);if(this._.matchBoundary=!1,i&&t&&this.offset>0)return this.offset--,n.call(this);if(i&&this.offset<i.getLength()-1)return this.offset++,n.call(this);for(i=null;!i;){if(i=this._.walker[t?"previous":"next"].call(this._.walker),this._.matchWord&&!i||this._.walker._.end)break;!i&&f(this._.walker.current)&&(this._.matchBoundary=!0)}return this.textNode=i,this.offset=i?t?i.getLength()-1:0:0,n.call(this)}},s=function(n,t){this._={walker:n,cursors:[],rangeLength:t,highlightRange:null,isMatched:!1}},s.prototype={toDomRange:function(){var n=this._.cursors;if(n.length<1)return null;var r=n[0],u=n[n.length-1],i=new CKEDITOR.dom.range(t.document);return i.setStart(r.textNode,r.offset),i.setEnd(u.textNode,u.offset+1),i},updateFromDomRange:function(n){var t,i=new o(n);this._.cursors=[];do t=i.next(),t.character&&this._.cursors.push(t);while(t.character);this._.rangeLength=this._.cursors.length},setMatched:function(){this._.isMatched=!0},clearMatched:function(){this._.isMatched=!1},isMatched:function(){return this._.isMatched},highlight:function(){var n,t;this._.cursors.length<1||(this._.highlightRange&&this.removeHighlight(),n=this.toDomRange(),l.applyToRange(n),this._.highlightRange=n,t=n.startContainer,t.type!=CKEDITOR.NODE_ELEMENT&&(t=t.getParent()),t.scrollIntoView(),this.updateFromDomRange(n))},removeHighlight:function(){this._.highlightRange&&(l.removeFromRange(this._.highlightRange),this.updateFromDomRange(this._.highlightRange),this._.highlightRange=null)},moveBack:function(){var t=this._.walker.back(),n=this._.cursors;return t.hitMatchBoundary&&(this._.cursors=n=[]),n.unshift(t),n.length>this._.rangeLength&&n.pop(),t},moveNext:function(){var t=this._.walker.next(),n=this._.cursors;return t.hitMatchBoundary&&(this._.cursors=n=[]),n.push(t),n.length>this._.rangeLength&&n.shift(),t},getEndCharacter:function(){var n=this._.cursors;return n.length<1?null:n[n.length-1].character},getNextCharacterRange:function(n){var t,i=this._.cursors;return(t=i[i.length-1])?new s(new o(a(t)),n):null},getCursors:function(){return this._.cursors}};var v=0,b=1,h=2,y=function(n,t){var r=[-1],i;for(t&&(n=n.toLowerCase()),i=0;i<n.length;i++)for(r.push(r[i]+1);r[i+1]>0&&n.charAt(i)!=n.charAt(r[i+1]-1);)r[i+1]=r[r[i+1]-1]+1;this._={overlap:r,state:0,ignoreCase:!!t,pattern:n}};y.prototype={feedCharacter:function(n){for(this._.ignoreCase&&(n=n.toLowerCase());;){if(n==this._.pattern.charAt(this._.state))return(this._.state++,this._.state==this._.pattern.length)?(this._.state=0,h):b;if(this._.state)this._.state=this._.overlap[this._.state];else return v}return null},reset:function(){this._.state=0}};var k=/[.,"'?!;: \u0085\u00a0\u1680\u280e\u2028\u2029\u202f\u205f\u3000]/,p=function(n){if(!n)return!0;var t=n.charCodeAt(0);return t>=9&&t<=13||t>=8192&&t<=8202||k.test(n)},r={searchRange:null,matchRange:null,find:function(n,t,i,r,u,f){this.matchRange?(this.matchRange.removeHighlight(),this.matchRange=this.matchRange.getNextCharacterRange(n.length)):this.matchRange=new s(new o(this.searchRange),n.length);for(var k=new y(n,!t),e=v,l="%";l!==null;){for(this.matchRange.moveNext();l=this.matchRange.getEndCharacter();){if(e=k.feedCharacter(l),e==h)break;this.matchRange.moveNext().hitMatchBoundary&&k.reset()}if(e==h){if(i){var b=this.matchRange.getCursors(),d=b[b.length-1],g=b[0],nt=new o(w(g),!0),tt=new o(a(d),!0);if(!(p(nt.back().character)&&p(tt.next().character)))continue}return this.matchRange.setMatched(),u!==!1&&this.matchRange.highlight(),!0}}return(this.matchRange.clearMatched(),this.matchRange.removeHighlight(),r&&!f)?(this.searchRange=c(!0),this.matchRange=null,arguments.callee.apply(this,Array.prototype.slice.call(arguments).concat([!0]))):!1},replaceCounter:0,replace:function(n,i,r,u,f,e,o){var h=!1,s,l,c;return this.matchRange&&this.matchRange.isMatched()&&!this.matchRange._.isReplaced?(this.matchRange.removeHighlight(),s=this.matchRange.toDomRange(),l=t.document.createText(r),o||(c=t.getSelection(),c.selectRanges([s]),t.fire("saveSnapshot")),s.deleteContents(),s.insertNode(l),o||(c.selectRanges([s]),t.fire("saveSnapshot")),this.matchRange.updateFromDomRange(s),o||this.matchRange.highlight(),this.matchRange._.isReplaced=!0,this.replaceCounter++,h=!0):h=this.find(i,u,f,e,!o),h}};return{title:t.lang.findAndReplace.title,resizable:CKEDITOR.DIALOG_RESIZE_NONE,minWidth:350,minHeight:165,buttons:[CKEDITOR.dialog.cancelButton],contents:[{id:"find",label:t.lang.findAndReplace.find,title:t.lang.findAndReplace.find,accessKey:"",elements:[{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtFindFind",label:t.lang.findAndReplace.findWhat,isChanged:!1,labelLayout:"horizontal",accessKey:"F"},{type:"button",align:"left",style:"width:100%",label:t.lang.findAndReplace.find,onClick:function(){var n=this.getDialog();r.find(n.getValueOf("find","txtFindFind"),n.getValueOf("find","txtFindCaseChk"),n.getValueOf("find","txtFindWordChk"),n.getValueOf("find","txtFindCyclic"))||alert(t.lang.findAndReplace.notFoundMsg)}}]},{type:"vbox",padding:0,children:[{type:"checkbox",id:"txtFindCaseChk",isChanged:!1,style:"margin-top:28px",label:t.lang.findAndReplace.matchCase},{type:"checkbox",id:"txtFindWordChk",isChanged:!1,label:t.lang.findAndReplace.matchWord},{type:"checkbox",id:"txtFindCyclic",isChanged:!1,"default":!0,label:t.lang.findAndReplace.matchCyclic}]}]},{id:"replace",label:t.lang.findAndReplace.replace,accessKey:"M",elements:[{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtFindReplace",label:t.lang.findAndReplace.findWhat,isChanged:!1,labelLayout:"horizontal",accessKey:"F"},{type:"button",align:"left",style:"width:100%",label:t.lang.findAndReplace.replace,onClick:function(){var n=this.getDialog();r.replace(n,n.getValueOf("replace","txtFindReplace"),n.getValueOf("replace","txtReplace"),n.getValueOf("replace","txtReplaceCaseChk"),n.getValueOf("replace","txtReplaceWordChk"),n.getValueOf("replace","txtReplaceCyclic"))||alert(t.lang.findAndReplace.notFoundMsg)}}]},{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtReplace",label:t.lang.findAndReplace.replaceWith,isChanged:!1,labelLayout:"horizontal",accessKey:"R"},{type:"button",align:"left",style:"width:100%",label:t.lang.findAndReplace.replaceAll,isChanged:!1,onClick:function(){var n=this.getDialog();for(r.replaceCounter=0,r.searchRange=c(!0),r.matchRange&&(r.matchRange.removeHighlight(),r.matchRange=null),t.fire("saveSnapshot");r.replace(n,n.getValueOf("replace","txtFindReplace"),n.getValueOf("replace","txtReplace"),n.getValueOf("replace","txtReplaceCaseChk"),n.getValueOf("replace","txtReplaceWordChk"),!1,!0););r.replaceCounter?(alert(t.lang.findAndReplace.replaceSuccessMsg.replace(/%1/,r.replaceCounter)),t.fire("saveSnapshot")):alert(t.lang.findAndReplace.notFoundMsg)}}]},{type:"vbox",padding:0,children:[{type:"checkbox",id:"txtReplaceCaseChk",isChanged:!1,label:t.lang.findAndReplace.matchCase},{type:"checkbox",id:"txtReplaceWordChk",isChanged:!1,label:t.lang.findAndReplace.matchWord},{type:"checkbox",id:"txtReplaceCyclic",isChanged:!1,"default":!0,label:t.lang.findAndReplace.matchCyclic}]}]}],onLoad:function(){var n=this,i,r,t=!1;this.on("hide",function(){t=!1});this.on("show",function(){t=!0});this.selectPage=CKEDITOR.tools.override(this.selectPage,function(u){return function(f){u.call(n,f);var o=n._.tabs[f],c,s,h;s=f==="find"?"txtFindFind":"txtFindReplace",h=f==="find"?"txtFindWordChk":"txtReplaceWordChk",i=n.getContentElement(f,s),r=n.getContentElement(f,h),o.initialized||(c=CKEDITOR.document.getById(i._.inputId),o.initialized=!0),t&&e.call(this,f)}})},onShow:function(){r.searchRange=c(),i=="replace"?this.getContentElement("replace","txtFindReplace").focus():this.getContentElement("find","txtFindFind").focus()},onHide:function(){r.matchRange&&r.matchRange.isMatched()&&(r.matchRange.removeHighlight(),t.focus(),t.getSelection().selectRanges([r.matchRange.toDomRange()])),delete r.matchRange}}};CKEDITOR.dialog.add("find",function(n){return r(n,"find")}),CKEDITOR.dialog.add("replace",function(n){return r(n,"replace")})})();