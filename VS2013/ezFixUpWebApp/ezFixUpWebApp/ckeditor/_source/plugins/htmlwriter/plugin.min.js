CKEDITOR.plugins.add("htmlwriter"),CKEDITOR.htmlWriter=CKEDITOR.tools.createClass({base:CKEDITOR.htmlParser.basicWriter,$:function(){var n,t;this.base(),this.indentationChars="\t",this.selfClosingEnd=" />",this.lineBreakChars="\n",this.forceSimpleAmpersand=!1,this.sortAttributes=!0,this._.indent=!1,this._.indentation="",this._.rules={},n=CKEDITOR.dtd;for(t in CKEDITOR.tools.extend({},n.$nonBodyContent,n.$block,n.$listItem,n.$tableContent))this.setRules(t,{indent:!0,breakBeforeOpen:!0,breakAfterOpen:!0,breakBeforeClose:!n[t]["#"],breakAfterClose:!0});this.setRules("br",{breakAfterOpen:!0}),this.setRules("title",{indent:!1,breakAfterOpen:!1}),this.setRules("style",{indent:!1,breakBeforeClose:!0}),this.setRules("pre",{indent:!1})},proto:{openTag:function(n){var t=this._.rules[n];this._.indent?this.indentation():t&&t.breakBeforeOpen&&(this.lineBreak(),this.indentation()),this._.output.push("<",n)},openTagClose:function(n,t){var i=this._.rules[n];t?this._.output.push(this.selfClosingEnd):(this._.output.push(">"),i&&i.indent&&(this._.indentation+=this.indentationChars)),i&&i.breakAfterOpen&&this.lineBreak()},attribute:function(n,t){this.forceSimpleAmpersand&&(t=t.replace(/&amp;/,"&")),this._.output.push(" ",n,'="',t,'"')},closeTag:function(n){var t=this._.rules[n];t&&t.indent&&(this._.indentation=this._.indentation.substr(this.indentationChars.length)),this._.indent?this.indentation():t&&t.breakBeforeClose&&(this.lineBreak(),this.indentation()),this._.output.push("<\/",n,">"),t&&t.breakAfterClose&&this.lineBreak()},text:function(n){this._.indent&&(this.indentation(),n=CKEDITOR.tools.ltrim(n)),this._.output.push(n)},comment:function(n){this._.indent&&this.indentation(),this._.output.push("<!--",n,"-->")},lineBreak:function(){this._.output.length>0&&this._.output.push(this.lineBreakChars),this._.indent=!0},indentation:function(){this._.output.push(this._.indentation),this._.indent=!1},setRules:function(n,t){var i=this._.rules[n];i?CKEDITOR.tools.extend(i,t,!0):this._.rules[n]=t}}});