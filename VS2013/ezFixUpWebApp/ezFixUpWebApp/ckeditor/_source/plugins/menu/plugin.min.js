CKEDITOR.plugins.add("menu",{beforeInit:function(n){for(var i=n.config.menu_groups.split(","),r={},t=0;t<i.length;t++)r[i[t]]=t+1;n._.menuGroups=r,n._.menuItems={}},requires:["floatpanel"]}),CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{addMenuGroup:function(n,t){this._.menuGroups[n]=t||100},addMenuItem:function(n,t){this._.menuGroups[t.group]&&(this._.menuItems[n]=new CKEDITOR.menuItem(this,n,t))},addMenuItems:function(n){for(var t in n)this.addMenuItem(t,n[t])},getMenuItem:function(n){return this._.menuItems[n]}}),function(){function n(n){n.sort(function(n,t){return n.group<t.group?-1:n.group>t.group?1:n.order<t.order?-1:n.order>t.order?1:0})}CKEDITOR.menu=CKEDITOR.tools.createClass({$:function(n,t){this.id="cke_"+CKEDITOR.tools.getNextNumber(),this.editor=n,this.items=[],this._.level=t||1},_:{showSubMenu:function(n){var t=this._.subMenu,f=this.items[n],r=f.getItems&&f.getItems(),u,i,e;if(!r){this._.panel.hideChild();return}t?t.removeAll():(t=this._.subMenu=new CKEDITOR.menu(this.editor,this._.level+1),t.parent=this,t.onClick=CKEDITOR.tools.bind(this.onClick,this));for(u in r)i=this.editor.getMenuItem(u),i&&(i.state=r[u],t.add(i));e=this._.panel.getBlock(this.id).element.getDocument().getById(this.id+String(n)),t.show(e,2)}},proto:{add:function(n){n.order||(n.order=this.items.length),this.items.push(n)},removeAll:function(){this.items=[]},show:function(t,i,r,u){var h=this.items,o=this.editor,f=this._.panel,c=this._.element,l,e,y,s,v;f||(f=this._.panel=new CKEDITOR.ui.floatPanel(this.editor,CKEDITOR.document.getBody(),{css:o.skin.editor.css,level:this._.level-1,className:o.skinClass+" cke_contextmenu"},this._.level),f.onEscape=CKEDITOR.tools.bind(function(){this.onEscape&&this.onEscape(),this.hide()},this),f.onHide=CKEDITOR.tools.bind(function(){this.onHide&&this.onHide()},this),l=f.addBlock(this.id),l.autoSize=!0,e=l.keys,e[40]="next",e[9]="next",e[38]="prev",e[CKEDITOR.SHIFT+9]="prev",e[32]="click",e[39]="click",c=this._.element=l.element,c.addClass(o.skinClass),y=c.getDocument(),y.getBody().setStyle("overflow","hidden"),y.getElementsByTag("html").getItem(0).setStyle("overflow","hidden"),this._.itemOverFn=CKEDITOR.tools.addFunction(function(n){clearTimeout(this._.showSubTimeout),this._.showSubTimeout=CKEDITOR.tools.setTimeout(this._.showSubMenu,o.config.menu_subMenuDelay,this,[n])},this),this._.itemOutFn=CKEDITOR.tools.addFunction(function(){clearTimeout(this._.showSubTimeout)},this),this._.itemClickFn=CKEDITOR.tools.addFunction(function(n){var t=this.items[n];if(t.state==CKEDITOR.TRISTATE_DISABLED){this.hide();return}t.getItems?this._.showSubMenu(n):this.onClick&&this.onClick(t)},this)),n(h);var a=['<div class="cke_menu">'],p=h.length,w=p&&h[0].group;for(s=0;s<p;s++)v=h[s],w!=v.group&&(a.push('<div class="cke_menuseparator"><\/div>'),w=v.group),v.render(this,s,a);a.push("<\/div>"),c.setHtml(a.join("")),this.parent?this.parent._.panel.showAsChild(f,this.id,t,i,r,u):f.showBlock(this.id,t,i,r,u),o.fire("menuShow",[f])},hide:function(){this._.panel&&this._.panel.hide()}}})}(),CKEDITOR.menuItem=CKEDITOR.tools.createClass({$:function(n,t,i){CKEDITOR.tools.extend(this,i,{order:0,className:"cke_button_"+t}),this.group=n._.menuGroups[this.group],this.editor=n,this.name=t},proto:{render:function(n,t,i){var o=n.id+String(t),r=typeof this.state=="undefined"?CKEDITOR.TRISTATE_OFF:this.state,f=" cke_"+(r==CKEDITOR.TRISTATE_ON?"on":r==CKEDITOR.TRISTATE_DISABLED?"disabled":"off"),u=this.label,e;r==CKEDITOR.TRISTATE_DISABLED&&(u=this.editor.lang.common.unavailable.replace("%1",u)),this.className&&(f+=" "+this.className),i.push('<span class="cke_menuitem"><a id="',o,'" class="',f,'" href="javascript:void(\'',(this.label||"").replace("'",""),'\')" title="',this.label,'" tabindex="-1"_cke_focus=1 hidefocus="true"'),(CKEDITOR.env.opera||CKEDITOR.env.gecko&&CKEDITOR.env.mac)&&i.push(' onkeypress="return false;"'),CKEDITOR.env.gecko&&i.push(' onblur="this.style.cssText = this.style.cssText;"'),e=(this.iconOffset||0)*-16,i.push(' onmouseover="CKEDITOR.tools.callFunction(',n._.itemOverFn,",",t,');" onmouseout="CKEDITOR.tools.callFunction(',n._.itemOutFn,",",t,');" onclick="CKEDITOR.tools.callFunction(',n._.itemClickFn,",",t,'); return false;"><span class="cke_icon_wrapper"><span class="cke_icon"'+(this.icon?' style="background-image:url('+CKEDITOR.getUrl(this.icon)+");background-position:0 "+e+'px;"':"")+'><\/span><\/span><span class="cke_label">'),this.getItems&&i.push('<span class="cke_menuarrow"><\/span>'),i.push(u,"<\/span><\/a><\/span>")}}}),CKEDITOR.config.menu_subMenuDelay=400,CKEDITOR.config.menu_groups="clipboard,form,tablecell,tablecellproperties,tablerow,tablecolumn,table,anchor,link,image,flash,checkbox,radio,textfield,hiddenfield,imagebutton,button,select,textarea,div";