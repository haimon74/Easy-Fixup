CKEDITOR.plugins.add("panelbutton",{requires:["button"],beforeInit:function(n){n.ui.addHandler(CKEDITOR.UI_PANELBUTTON,CKEDITOR.ui.panelButton.handler)}}),CKEDITOR.UI_PANELBUTTON=4,function(){var n=function(n){var t=this._;if(t.state!=CKEDITOR.TRISTATE_DISABLED){if(this.createPanel(n),t.on){t.panel.hide();return}t.panel.showBlock(this._.id,this.document.getById(this._.id),4)}};CKEDITOR.ui.panelButton=CKEDITOR.tools.createClass({base:CKEDITOR.ui.button,$:function(t){var i=t.panel;delete t.panel,this.base(t),this.document=i&&i.parent&&i.parent.getDocument()||CKEDITOR.document,this.hasArrow=!0,this.click=n,this._={panelDefinition:i}},statics:{handler:{create:function(n){return new CKEDITOR.ui.panelButton(n)}}},proto:{createPanel:function(n){var i=this._;if(!i.panel){var u=this._.panelDefinition||{},f=u.parent||CKEDITOR.document.getBody(),r=this._.panel=new CKEDITOR.ui.floatPanel(n,f,u),t=this;if(r.onShow=function(){t.className&&this.element.getFirst().addClass(t.className+"_panel"),i.oldState=t._.state,t.setState(CKEDITOR.TRISTATE_ON),i.on=1,t.onOpen&&t.onOpen()},r.onHide=function(){t.className&&this.element.getFirst().removeClass(t.className+"_panel"),t.setState(i.oldState),i.on=0,t.onClose&&t.onClose()},r.onEscape=function(){r.hide(),t.document.getById(i.id).focus()},this.onBlock)this.onBlock(r,i.id);r.getBlock(i.id).onHide=function(){i.on=0,t.setState(CKEDITOR.TRISTATE_OFF)}}}}})}();