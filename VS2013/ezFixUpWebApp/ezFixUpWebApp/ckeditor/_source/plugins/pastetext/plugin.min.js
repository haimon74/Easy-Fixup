(function(){function n(n,t){if(CKEDITOR.env.ie){var i=n.selection;i.type=="Control"&&i.clear(),i.createRange().pasteHTML(t)}else n.execCommand("inserthtml",!1,t)}function t(n,t,i,r){while(i--)CKEDITOR.plugins.enterkey[t==CKEDITOR.ENTER_BR?"enterBr":"enterBlock"](n,t,null,r)}var i={exec:function(n){var t=CKEDITOR.tools.tryThese(function(){var n=window.clipboardData.getData("Text");if(!n)throw 0;return n},function(){var i,t,n,r;return window.netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect"),i=window.Components.classes["@mozilla.org/widget/clipboard;1"].getService(window.Components.interfaces.nsIClipboard),t=window.Components.classes["@mozilla.org/widget/transferable;1"].createInstance(window.Components.interfaces.nsITransferable),t.addDataFlavor("text/unicode"),i.getData(t,i.kGlobalClipboard),n={},r={},t.getTransferData("text/unicode",n,r),n=n.value.QueryInterface(window.Components.interfaces.nsISupportsString),n.data.substring(0,r.value/2)});if(t)n.fire("paste",{text:t});else return n.openDialog("pastetext"),!1;return!0}};CKEDITOR.plugins.add("pastetext",{init:function(n){var t="pastetext",r=n.addCommand(t,i);if(n.ui.addButton("PasteText",{label:n.lang.pasteText.button,command:t}),CKEDITOR.dialog.add(t,CKEDITOR.getUrl(this.path+"dialogs/pastetext.js")),n.config.forcePasteAsPlainText)n.on("beforeCommandExec",function(t){t.data.name=="paste"&&(n.execCommand("pastetext"),t.cancel())},null,null,0)},requires:["clipboard"]}),CKEDITOR.editor.prototype.insertText=function(i){var u;this.focus(),this.fire("saveSnapshot");var e=this.getSelection().getStartElement().hasAscendant("pre",!0)?CKEDITOR.ENTER_BR:this.config.enterMode,f=e==CKEDITOR.ENTER_BR,o=this.document.$,s=this,r;i=CKEDITOR.tools.htmlEncode(i.replace(/\r\n|\r/g,"\n")),u=0,i.replace(/\n+/g,function(h,c){r=i.substring(u,c),u=c+h.length,r.length&&n(o,r);var l=h.length,a=f?0:Math.floor(l/2),v=f?l:l%2;t(s,e,a),t(s,CKEDITOR.ENTER_BR,v,f?!1:!0)}),r=i.substring(u,i.length),r.length&&n(o,r),this.fire("saveSnapshot")}})();