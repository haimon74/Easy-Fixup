CKEDITOR.plugins.add("removeformat",{requires:["selection"],init:function(n){n.addCommand("removeFormat",CKEDITOR.plugins.removeformat.commands.removeformat),n.ui.addButton("RemoveFormat",{label:n.lang.removeFormat,command:"removeFormat"})}}),CKEDITOR.plugins.removeformat={commands:{removeformat:{exec:function(n){for(var f=n._.removeFormatRegex||(n._.removeFormatRegex=new RegExp("^(?:"+n.config.removeFormatTags.replace(/,/g,"|")+")$","i")),l=n._.removeAttributes||(n._.removeAttributes=n.config.removeFormatAttributes.split(",")),e=n.getSelection().getRanges(),i,t,c,r=0;i=e[r];r++)if(!i.collapsed){i.enlarge(CKEDITOR.ENLARGE_ELEMENT);var u=i.createBookmark(),o=u.startNode,s=u.endNode,h=function(n){for(var i=new CKEDITOR.dom.elementPath(n),u=i.elements,t,r=1;t=u[r];r++){if(t.equals(i.block)||t.equals(i.blockLimit))break;f.test(t.getName())&&n.breakParent(t)}};for(h(o),h(s),t=o.getNextSourceNode(!0,CKEDITOR.NODE_ELEMENT);t;){if(t.equals(s))break;c=t.getNextSourceNode(!1,CKEDITOR.NODE_ELEMENT),t.getName()=="img"&&t.getAttribute("_cke_realelement")||(f.test(t.getName())?t.remove(!0):t.removeAttributes(l)),t=c}i.moveToBookmark(u)}n.getSelection().selectRanges(e)}}}},CKEDITOR.config.removeFormatTags="b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var",CKEDITOR.config.removeFormatAttributes="class,style,lang,width,height,align,hspace,valign";