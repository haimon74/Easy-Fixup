(function(){function f(){var n,i,t;try{if(n=this.getSelection(),!n)return;i=n.getStartElement(),t=new CKEDITOR.dom.elementPath(i),t.compare(this._.selectionPreviousPath)||(this._.selectionPreviousPath=t,this.fire("selectionChange",{selection:n,path:t,element:i}))}catch(r){}}function n(){(i=!0,t)||(r.call(this),t=CKEDITOR.tools.setTimeout(r,200,this))}function r(){t=null,i&&(CKEDITOR.tools.setTimeout(f,0,this),i=!1)}var t,i,e={exec:function(n){switch(n.mode){case"wysiwyg":n.document.$.execCommand("SelectAll",!1,null)}},canUndo:!1},u;CKEDITOR.plugins.add("selection",{init:function(t){t.on("contentDom",function(){var u=t.document,i=u.getBody(),f,r;if(CKEDITOR.env.ie){i.on("focusin",function(){if(f){try{f.select()}catch(n){}f=null}});t.window.on("focus",function(){r=!0,e()});i.on("beforedeactivate",function(){r=!1});i.on("mousedown",o);i.on("mouseup",function(){r=!0,setTimeout(function(){e(!0)},0)});i.on("keydown",o);i.on("keyup",function(){r=!0,e()});u.on("selectionchange",e);function o(){r=!1}function e(i){if(r){var o=t.document,u=o&&o.$.selection;if(i&&u&&u.type=="None"&&!o.$.queryCommandEnabled("InsertImage")){CKEDITOR.tools.setTimeout(e,50,this,!0);return}f=u&&u.createRange(),n.call(t)}}}else{u.on("mouseup",n,t);u.on("keyup",n,t)}});t.addCommand("selectAll",e),t.ui.addButton("SelectAll",{label:t.lang.selectAll,command:"selectAll"}),t.selectionChange=n}}),CKEDITOR.editor.prototype.getSelection=function(){return this.document&&this.document.getSelection()},CKEDITOR.editor.prototype.forceNextSelectionCheck=function(){delete this._.selectionPreviousPath},CKEDITOR.dom.document.prototype.getSelection=function(){var n=new CKEDITOR.dom.selection(this);return!n||n.isInvalid?null:n},CKEDITOR.SELECTION_NONE=1,CKEDITOR.SELECTION_TEXT=2,CKEDITOR.SELECTION_ELEMENT=3,CKEDITOR.dom.selection=function(n){var i=n.getCustomData("cke_locked_selection"),t;return i?i:(this.document=n,this.isLocked=!1,this._={cache:{}},CKEDITOR.env.ie&&(t=this.getNative().createRange(),(!t||t.item&&t.item(0).ownerDocument!=this.document.$||t.parentElement&&t.parentElement().ownerDocument!=this.document.$)&&(this.isInvalid=!0)),this)},u={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,th:1,thead:1,tfoot:1},CKEDITOR.dom.selection.prototype={getNative:CKEDITOR.env.ie?function(){return this._.cache.nativeSel||(this._.cache.nativeSel=this.document.$.selection)}:function(){return this._.cache.nativeSel||(this._.cache.nativeSel=this.document.getWindow().$.getSelection())},getType:CKEDITOR.env.ie?function(){var t=this._.cache,n,i,r;if(t.type)return t.type;n=CKEDITOR.SELECTION_NONE;try{i=this.getNative(),r=i.type,r=="Text"&&(n=CKEDITOR.SELECTION_TEXT),r=="Control"&&(n=CKEDITOR.SELECTION_ELEMENT),i.createRange().parentElement&&(n=CKEDITOR.SELECTION_TEXT)}catch(u){}return t.type=n}:function(){var f=this._.cache,t,i,n,r;return f.type?f.type:(t=CKEDITOR.SELECTION_TEXT,i=this.getNative(),i?i.rangeCount==1&&(n=i.getRangeAt(0),r=n.startContainer,r==n.endContainer&&r.nodeType==1&&n.endOffset-n.startOffset==1&&u[r.childNodes[n.startOffset].nodeName.toLowerCase()]&&(t=CKEDITOR.SELECTION_ELEMENT)):t=CKEDITOR.SELECTION_NONE,f.type=t)},getRanges:CKEDITOR.env.ie?function(){var n=function(n,t){var u,f,i,r,o,s,e;for(n=n.duplicate(),n.collapse(t),u=n.parentElement(),f=u.childNodes,r=0;r<f.length;r++)if(o=f[r],o.nodeType==1){if(i=n.duplicate(),i.moveToElementText(o),i.collapse(),s=i.compareEndPoints("StartToStart",n),s>0)break;else if(s===0)return{container:u,offset:r};i=null}for(i||(i=n.duplicate(),i.moveToElementText(u),i.collapse(!1)),i.setEndPoint("StartToStart",n),e=i.text.replace(/(\r\n|\r)/g,"\n").length;e>0;)e-=f[--r].nodeValue.length;return e===0?{container:u,offset:r}:{container:f[r],offset:-e}};return function(){var u=this._.cache,i,h,e;if(u.ranges)return u.ranges;var s=this.getNative(),f=s&&s.createRange(),c=this.getType(),t;if(!s)return[];if(c==CKEDITOR.SELECTION_TEXT)return t=new CKEDITOR.dom.range(this.document),i=n(f,!0),t.setStart(new CKEDITOR.dom.node(i.container),i.offset),i=n(f),t.setEnd(new CKEDITOR.dom.node(i.container),i.offset),u.ranges=[t];if(c==CKEDITOR.SELECTION_ELEMENT){for(h=this._.cache.ranges=[],e=0;e<f.length;e++){var l=f.item(e),o=l.parentNode,r=0;for(t=new CKEDITOR.dom.range(this.document);r<o.childNodes.length&&o.childNodes[r]!=l;r++);t.setStart(new CKEDITOR.dom.node(o),r),t.setEnd(new CKEDITOR.dom.node(o),r+1),h.push(t)}return h}return u.ranges=[]}}():function(){var u=this._.cache,f,t,i,n,r;if(u.ranges)return u.ranges;if(f=[],t=this.getNative(),!t)return[];for(i=0;i<t.rangeCount;i++)n=t.getRangeAt(i),r=new CKEDITOR.dom.range(this.document),r.setStart(new CKEDITOR.dom.node(n.startContainer),n.startOffset),r.setEnd(new CKEDITOR.dom.node(n.endContainer),n.endOffset),f.push(r);return u.ranges=f},getStartElement:function(){var u=this._.cache,n,f,t,i,e,r;if(u.startElement!==undefined)return u.startElement;f=this.getNative();switch(this.getType()){case CKEDITOR.SELECTION_ELEMENT:return this.getSelectedElement();case CKEDITOR.SELECTION_TEXT:if(t=this.getRanges()[0],t&&!t.collapsed){for(t.optimize();;)if(i=t.startContainer,e=t.startOffset,e!=(i.getChildCount?i.getChildCount():i.getLength())||i.isBlockBoundary())break;else t.setStartAfter(i);if(n=t.startContainer,n.type!=CKEDITOR.NODE_ELEMENT)return n.getParent();if(n=n.getChild(t.startOffset),!n||n.type!=CKEDITOR.NODE_ELEMENT)return t.startContainer;for(r=n.getFirst();r&&r.type==CKEDITOR.NODE_ELEMENT;)n=r,r=r.getFirst();return n}CKEDITOR.env.ie?(t=f.createRange(),t.collapse(!0),n=t.parentElement()):(n=f.anchorNode,n&&n.nodeType!=1&&(n=n.parentNode))}return u.startElement=n?new CKEDITOR.dom.element(n):null},getSelectedElement:function(){var t=this._.cache,n,i,r;if(t.selectedElement!==undefined)return t.selectedElement;if(this.getType()==CKEDITOR.SELECTION_ELEMENT)if(i=this.getNative(),CKEDITOR.env.ie)try{n=i.createRange().item(0)}catch(u){}else r=i.getRangeAt(0),n=r.startContainer.childNodes[r.startOffset];return t.selectedElement=n?new CKEDITOR.dom.element(n):null},lock:function(){this.getRanges(),this.getStartElement(),this.getSelectedElement(),this._.cache.nativeSel={},this.isLocked=!0,this.document.setCustomData("cke_locked_selection",this)},unlock:function(n){var r=this.document,t=r.getCustomData("cke_locked_selection"),i,u;t&&(r.setCustomData("cke_locked_selection",null),n&&(i=t.getSelectedElement(),u=!i&&t.getRanges(),this.isLocked=!1,this.reset(),r.getBody().focus(),i?this.selectElement(i):this.selectRanges(u))),t&&n||(this.isLocked=!1,this.reset())},reset:function(){this._.cache={}},selectElement:function(n){var t,i;if(this.isLocked){t=new CKEDITOR.dom.range(this.document),t.setStartBefore(n),t.setEndAfter(n),this._.cache.selectedElement=n,this._.cache.startElement=n,this._.cache.ranges=[t],this._.cache.type=CKEDITOR.SELECTION_ELEMENT;return}if(CKEDITOR.env.ie){this.getNative().empty();try{t=this.document.$.body.createControlRange(),t.addElement(n.$),t.select()}catch(r){t=this.document.$.body.createTextRange(),t.moveToElementText(n.$),t.select()}this.reset()}else t=this.document.$.createRange(),t.selectNode(n.$),i=this.getNative(),i.removeAllRanges(),i.addRange(t),this.reset()},selectRanges:function(n){var u,i;if(this.isLocked){this._.cache.selectedElement=null,this._.cache.startElement=n[0].getTouchedStartNode(),this._.cache.ranges=n,this._.cache.type=CKEDITOR.SELECTION_TEXT;return}if(CKEDITOR.env.ie)n[0]&&n[0].select(),this.reset();else{for(u=this.getNative(),u.removeAllRanges(),i=0;i<n.length;i++){var t=n[i],f=this.document.$.createRange(),r=t.startContainer;t.collapsed&&CKEDITOR.env.gecko&&CKEDITOR.env.version<10900&&r.type==CKEDITOR.NODE_ELEMENT&&!r.getChildCount()&&r.appendText(""),f.setStart(r.$,t.startOffset),f.setEnd(t.endContainer.$,t.endOffset),u.addRange(f)}this.reset()}},createBookmarks:function(n){for(var s=[],f=this.getRanges(),h=f.length,t,e,o,u,r=0;r<h;r++)for(s.push(t=f[r].createBookmark(n,!0)),n=t.serializable,e=n?this.document.getById(t.startNode):t.startNode,o=n?this.document.getById(t.endNode):t.endNode,u=r+1;u<h;u++){var i=f[u],c=i.startContainer,l=i.endContainer;c.equals(e.getParent())&&i.startOffset++,c.equals(o.getParent())&&i.startOffset++,l.equals(e.getParent())&&i.endOffset++,l.equals(o.getParent())&&i.endOffset++}return s},createBookmarks2:function(n){for(var i=[],r=this.getRanges(),t=0;t<r.length;t++)i.push(r[t].createBookmark2(n));return i},selectBookmarks:function(n){for(var r=[],i,t=0;t<n.length;t++)i=new CKEDITOR.dom.range(this.document),i.moveToBookmark(n[t]),r.push(i);return this.selectRanges(r),this},getCommonAncestor:function(){var n=this.getRanges(),t=n[0].startContainer,i=n[n.length-1].endContainer;return t.getCommonAncestor(i)},scrollIntoView:function(){var n=this.getStartElement();n.scrollIntoView()}}})(),function(){var n=CKEDITOR.dom.walker.whitespaces(!0),t=/\ufeff|\u00a0/;CKEDITOR.dom.range.prototype.select=CKEDITOR.env.ie?function(i){var c=this.collapsed,s,e,l=this.createBookmark(),r=l.startNode,f,u,h,o;c||(f=l.endNode),u=this.document.$.body.createTextRange(),u.moveToElementText(r.$),u.moveStart("character",1),f?(h=this.document.$.body.createTextRange(),h.moveToElementText(f.$),u.setEndPoint("EndToEnd",h),u.moveEnd("character",-1)):(o=r.getNext(n),s=!(o&&o.getText&&o.getText().match(t))&&(i||!r.hasPrevious()||r.getPrevious().is&&r.getPrevious().is("br")),e=this.document.createElement("span"),e.setHtml("&#65279;"),e.insertBefore(r),s&&this.document.createText("ï»¿").insertBefore(r)),this.setStartBefore(r),r.remove(),c?(s?(u.moveStart("character",-1),u.select(),this.document.$.selection.clear()):u.select(),e.remove()):(this.setEndBefore(f),f.remove(),u.select())}:function(){var t=this.startContainer,n,i;this.collapsed&&t.type==CKEDITOR.NODE_ELEMENT&&!t.getChildCount()&&t.append(new CKEDITOR.dom.text("")),n=this.document.$.createRange(),n.setStart(t.$,this.startOffset);try{n.setEnd(this.endContainer.$,this.endOffset)}catch(r){if(r.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0)this.collapse(!0),n.setEnd(this.endContainer.$,this.endOffset);else throw r;}i=this.document.getSelection().getNative(),i.removeAllRanges(),i.addRange(n)}}();