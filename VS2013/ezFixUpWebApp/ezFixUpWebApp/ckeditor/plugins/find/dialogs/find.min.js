(function(){function u(n){return n.type==CKEDITOR.NODE_TEXT&&n.getLength()>0}function f(n){var t=CKEDITOR.dtd;return n.isBlockBoundary(CKEDITOR.tools.extend({},t.$empty,t.$nonEditable))}function e(n){var u,f,e,o,r,s;for(u=n==="find"?1:0,f=1-u,s=t.length,r=0;r<s;r++)e=this.getContentElement(i[u],t[r][u]),o=this.getContentElement(i[f],t[r][f]),o.setValue(e.getValue())}var n=function(){var n=this;return{textNode:n.textNode,offset:n.offset,character:n.textNode?n.textNode.getText().charAt(n.offset):null,hitMatchBoundary:n._.matchBoundary}},i=["find","replace"],t=[["txtFindFind","txtFindReplace"],["txtFindCaseChk","txtReplaceCaseChk"],["txtFindWordChk","txtReplaceWordChk"],["txtFindCyclic","txtReplaceCyclic"]],r=function(t,i){function a(n,i){var r=new CKEDITOR.dom.range;return r.setStart(n.textNode,i?n.offset:n.offset+1),r.setEndAt(t.document.getBody(),CKEDITOR.POSITION_BEFORE_END),r}function w(n){var i=new CKEDITOR.dom.range;return i.setStartAt(t.document.getBody(),CKEDITOR.POSITION_AFTER_START),i.setEnd(n.textNode,n.offset),i}function c(n){var i,r=t.getSelection(),u=t.document.getBody();return r&&!n?(i=r.getRanges()[0].clone(),i.collapse(!0)):(i=new CKEDITOR.dom.range,i.setStartAt(u,CKEDITOR.POSITION_AFTER_START)),i.setEndAt(u,CKEDITOR.POSITION_BEFORE_END),i}var l=new CKEDITOR.style(t.config.find_highlight),o=function(n,t){var i=new CKEDITOR.dom.walker(n);i[t?"guard":"evaluator"]=u,i.breakOnFalse=!0,this._={matchWord:t,walker:i,matchBoundary:!1}},s;o.prototype={next:function(){return this.move()},back:function(){return this.move(!0)},move:function(t){var i=this,r=i.textNode;if(r===null)return n.call(i);if(i._.matchBoundary=!1,r&&t&&i.offset>0)return i.offset--,n.call(i);if(r&&i.offset<r.getLength()-1)return i.offset++,n.call(i);for(r=null;!r;){if(r=i._.walker[t?"previous":"next"].call(i._.walker),i._.matchWord&&!r||i._.walker._.end)break;!r&&f(i._.walker.current)&&(i._.matchBoundary=!0)}return i.textNode=r,i.offset=r?t?r.getLength()-1:0:0,n.call(i)}},s=function(n,t){this._={walker:n,cursors:[],rangeLength:t,highlightRange:null,isMatched:!1}},s.prototype={toDomRange:function(){var n=this._.cursors;if(n.length<1)return null;var r=n[0],u=n[n.length-1],i=new CKEDITOR.dom.range(t.document);return i.setStart(r.textNode,r.offset),i.setEnd(u.textNode,u.offset+1),i},updateFromDomRange:function(n){var t=this,i,r=new o(n);t._.cursors=[];do i=r.next(),i.character&&t._.cursors.push(i);while(i.character);t._.rangeLength=t._.cursors.length},setMatched:function(){this._.isMatched=!0},clearMatched:function(){this._.isMatched=!1},isMatched:function(){return this._.isMatched},highlight:function(){var n=this,t,i;n._.cursors.length<1||(n._.highlightRange&&n.removeHighlight(),t=n.toDomRange(),l.applyToRange(t),n._.highlightRange=t,i=t.startContainer,i.type!=CKEDITOR.NODE_ELEMENT&&(i=i.getParent()),i.scrollIntoView(),n.updateFromDomRange(t))},removeHighlight:function(){var n=this;n._.highlightRange&&(l.removeFromRange(n._.highlightRange),n.updateFromDomRange(n._.highlightRange),n._.highlightRange=null)},moveBack:function(){var n=this,i=n._.walker.back(),t=n._.cursors;return i.hitMatchBoundary&&(n._.cursors=t=[]),t.unshift(i),t.length>n._.rangeLength&&t.pop(),i},moveNext:function(){var n=this,i=n._.walker.next(),t=n._.cursors;return i.hitMatchBoundary&&(n._.cursors=t=[]),t.push(i),t.length>n._.rangeLength&&t.shift(),i},getEndCharacter:function(){var n=this._.cursors;return n.length<1?null:n[n.length-1].character},getNextCharacterRange:function(n){var t,i=this._.cursors;return(t=i[i.length-1])?new s(new o(a(t)),n):null},getCursors:function(){return this._.cursors}};var v=0,b=1,h=2,y=function(n,t){var r=[-1],i;for(t&&(n=n.toLowerCase()),i=0;i<n.length;i++)for(r.push(r[i]+1);r[i+1]>0&&n.charAt(i)!=n.charAt(r[i+1]-1);)r[i+1]=r[r[i+1]-1]+1;this._={overlap:r,state:0,ignoreCase:!!t,pattern:n}};y.prototype={feedCharacter:function(n){var t=this;for(t._.ignoreCase&&(n=n.toLowerCase());;){if(n==t._.pattern.charAt(t._.state))return(t._.state++,t._.state==t._.pattern.length)?(t._.state=0,h):b;if(t._.state)t._.state=t._.overlap[t._.state];else return v}return null},reset:function(){this._.state=0}};var k=/[.,"'?!;: \u0085\u00a0\u1680\u280e\u2028\u2029\u202f\u205f\u3000]/,p=function(n){if(!n)return!0;var t=n.charCodeAt(0);return t>=9&&t<=13||t>=8192&&t<=8202||k.test(n)},r={searchRange:null,matchRange:null,find:function(n,t,i,r,u,f){var e=this;e.matchRange?(e.matchRange.removeHighlight(),e.matchRange=e.matchRange.getNextCharacterRange(n.length)):e.matchRange=new s(new o(e.searchRange),n.length);for(var d=new y(n,!t),l=v,b="%";b!==null;){for(e.matchRange.moveNext();b=e.matchRange.getEndCharacter();){if(l=d.feedCharacter(b),l==h)break;e.matchRange.moveNext().hitMatchBoundary&&d.reset()}if(l==h){if(i){var k=e.matchRange.getCursors(),g=k[k.length-1],nt=k[0],tt=new o(w(nt),!0),it=new o(a(g),!0);if(!(p(tt.back().character)&&p(it.next().character)))continue}return e.matchRange.setMatched(),u!==!1&&e.matchRange.highlight(),!0}}return(e.matchRange.clearMatched(),e.matchRange.removeHighlight(),r&&!f)?(e.searchRange=c(!0),e.matchRange=null,arguments.callee.apply(e,Array.prototype.slice.call(arguments).concat([!0]))):!1},replaceCounter:0,replace:function(n,i,r,u,f,e,o){var s=this,c=!1,h,a,l;return s.matchRange&&s.matchRange.isMatched()&&!s.matchRange._.isReplaced?(s.matchRange.removeHighlight(),h=s.matchRange.toDomRange(),a=t.document.createText(r),o||(l=t.getSelection(),l.selectRanges([h]),t.fire("saveSnapshot")),h.deleteContents(),h.insertNode(a),o||(l.selectRanges([h]),t.fire("saveSnapshot")),s.matchRange.updateFromDomRange(h),o||s.matchRange.highlight(),s.matchRange._.isReplaced=!0,s.replaceCounter++,c=!0):c=s.find(i,u,f,e,!o),c}};return{title:t.lang.findAndReplace.title,resizable:CKEDITOR.DIALOG_RESIZE_NONE,minWidth:350,minHeight:165,buttons:[CKEDITOR.dialog.cancelButton],contents:[{id:"find",label:t.lang.findAndReplace.find,title:t.lang.findAndReplace.find,accessKey:"",elements:[{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtFindFind",label:t.lang.findAndReplace.findWhat,isChanged:!1,labelLayout:"horizontal",accessKey:"F"},{type:"button",align:"left",style:"width:100%",label:t.lang.findAndReplace.find,onClick:function(){var n=this.getDialog();r.find(n.getValueOf("find","txtFindFind"),n.getValueOf("find","txtFindCaseChk"),n.getValueOf("find","txtFindWordChk"),n.getValueOf("find","txtFindCyclic"))||alert(t.lang.findAndReplace.notFoundMsg)}}]},{type:"vbox",padding:0,children:[{type:"checkbox",id:"txtFindCaseChk",isChanged:!1,style:"margin-top:28px",label:t.lang.findAndReplace.matchCase},{type:"checkbox",id:"txtFindWordChk",isChanged:!1,label:t.lang.findAndReplace.matchWord},{type:"checkbox",id:"txtFindCyclic",isChanged:!1,"default":!0,label:t.lang.findAndReplace.matchCyclic}]}]},{id:"replace",label:t.lang.findAndReplace.replace,accessKey:"M",elements:[{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtFindReplace",label:t.lang.findAndReplace.findWhat,isChanged:!1,labelLayout:"horizontal",accessKey:"F"},{type:"button",align:"left",style:"width:100%",label:t.lang.findAndReplace.replace,onClick:function(){var n=this.getDialog();r.replace(n,n.getValueOf("replace","txtFindReplace"),n.getValueOf("replace","txtReplace"),n.getValueOf("replace","txtReplaceCaseChk"),n.getValueOf("replace","txtReplaceWordChk"),n.getValueOf("replace","txtReplaceCyclic"))||alert(t.lang.findAndReplace.notFoundMsg)}}]},{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtReplace",label:t.lang.findAndReplace.replaceWith,isChanged:!1,labelLayout:"horizontal",accessKey:"R"},{type:"button",align:"left",style:"width:100%",label:t.lang.findAndReplace.replaceAll,isChanged:!1,onClick:function(){var n=this.getDialog();for(r.replaceCounter=0,r.searchRange=c(!0),r.matchRange&&(r.matchRange.removeHighlight(),r.matchRange=null),t.fire("saveSnapshot");r.replace(n,n.getValueOf("replace","txtFindReplace"),n.getValueOf("replace","txtReplace"),n.getValueOf("replace","txtReplaceCaseChk"),n.getValueOf("replace","txtReplaceWordChk"),!1,!0););r.replaceCounter?(alert(t.lang.findAndReplace.replaceSuccessMsg.replace(/%1/,r.replaceCounter)),t.fire("saveSnapshot")):alert(t.lang.findAndReplace.notFoundMsg)}}]},{type:"vbox",padding:0,children:[{type:"checkbox",id:"txtReplaceCaseChk",isChanged:!1,label:t.lang.findAndReplace.matchCase},{type:"checkbox",id:"txtReplaceWordChk",isChanged:!1,label:t.lang.findAndReplace.matchWord},{type:"checkbox",id:"txtReplaceCyclic",isChanged:!1,"default":!0,label:t.lang.findAndReplace.matchCyclic}]}]}],onLoad:function(){var n=this,i,r,t=!1;this.on("hide",function(){t=!1});this.on("show",function(){t=!0});this.selectPage=CKEDITOR.tools.override(this.selectPage,function(u){return function(f){u.call(n,f);var o=n._.tabs[f],c,s,h;s=f==="find"?"txtFindFind":"txtFindReplace",h=f==="find"?"txtFindWordChk":"txtReplaceWordChk",i=n.getContentElement(f,s),r=n.getContentElement(f,h),o.initialized||(c=CKEDITOR.document.getById(i._.inputId),o.initialized=!0),t&&e.call(this,f)}})},onShow:function(){r.searchRange=c(),i=="replace"?this.getContentElement("replace","txtFindReplace").focus():this.getContentElement("find","txtFindFind").focus()},onHide:function(){r.matchRange&&r.matchRange.isMatched()&&(r.matchRange.removeHighlight(),t.focus(),t.getSelection().selectRanges([r.matchRange.toDomRange()])),delete r.matchRange}}};CKEDITOR.dialog.add("find",function(n){return r(n,"find")}),CKEDITOR.dialog.add("replace",function(n){return r(n,"replace")})})();